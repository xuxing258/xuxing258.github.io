import{_ as n,c as a,a as e,o as p}from"./app-BD3X-Yt7.js";const t={};function l(i,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="importlib模块" tabindex="-1"><a class="header-anchor" href="#importlib模块"><span>importlib模块</span></a></h1><ul><li><p>notify文件夹</p><ul><li><strong>init</strong>.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># __init__.py</span></span>
<span class="line"><span class="token keyword">import</span> importlib</span>
<span class="line"><span class="token keyword">import</span> setttings</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">send_all</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 循环遍历settings.py中的列表</span></span>
<span class="line">    <span class="token keyword">for</span> path_str <span class="token keyword">in</span> setttings<span class="token punctuation">.</span>NOTIFY_LIST<span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># path_str: &#39;notify.email.Email&#39;,</span></span>
<span class="line">        module_path<span class="token punctuation">,</span> class_name <span class="token operator">=</span> path_str<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">,</span> maxsplit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># module_path: &#39;notify.email&#39;, class_name:&#39;Email&#39;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 1.利用字符串导入模块</span></span>
<span class="line">        module <span class="token operator">=</span> importlib<span class="token punctuation">.</span>import_module<span class="token punctuation">(</span>module_path<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># getattr(字符串形式的函数, 对象):可以通过对象获取类中的函数</span></span>
<span class="line">        <span class="token comment"># getattr(模块, 字符串形式的类名):获取指定模块中的类</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 2.利于反射获取类名</span></span>
<span class="line">        cls <span class="token operator">=</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> class_name<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 3.生成类的对象</span></span>
<span class="line">        obj <span class="token operator">=</span> cls<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 4.对象调用send方法(多态)</span></span>
<span class="line">        obj<span class="token punctuation">.</span>send<span class="token punctuation">(</span>content<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>email.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">Email</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;邮箱通知:&#39;</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>qq.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">Qq</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;qq通知:&#39;</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>wechat.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">WeChat</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;微信通知:&#39;</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>settings.py</p></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 定义路径</span></span>
<span class="line">NOTIFY_LIST <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&#39;notify.email.Email&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;notify.wechat.WeChat&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;notify.qq.Qq&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>start.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 导入notify文件夹会默认导入文件夹中的__init__.py</span></span>
<span class="line"><span class="token keyword">import</span> notify</span>
<span class="line"></span>
<span class="line">notify<span class="token punctuation">.</span>send_all<span class="token punctuation">(</span><span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="auth模块" tabindex="-1"><a class="header-anchor" href="#auth模块"><span>auth模块</span></a></h1><p>直接进行数据库迁移就会产生django项目需要的很多表,其中有一张叫做auth_user表.</p><p>django启动之后默认会有个路由admin,这个路由进去需要输入用户名和密码就是基于auth_user表</p><h2 id="创建超级用户" tabindex="-1"><a class="header-anchor" href="#创建超级用户"><span>创建超级用户</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">python manage<span class="token punctuation">.</span>py createsuperuser</span>
<span class="line"></span>
<span class="line">Username <span class="token punctuation">(</span>leave blank to use <span class="token string">&#39;qing2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">:</span> qingqing <span class="token comment"># 用户名</span></span>
<span class="line">Email address<span class="token punctuation">:</span>   <span class="token comment"># 邮箱地址可以不用输入</span></span>
<span class="line">Password<span class="token punctuation">:</span>   <span class="token comment"># 密码不会显示出来</span></span>
<span class="line">Password <span class="token punctuation">(</span>again<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># 确认密码一定要和密码一致</span></span>
<span class="line">This password <span class="token keyword">is</span> too short<span class="token punctuation">.</span> It must contain at least <span class="token number">8</span> characters<span class="token punctuation">.</span></span>
<span class="line">This password <span class="token keyword">is</span> too common<span class="token punctuation">.</span></span>
<span class="line">This password <span class="token keyword">is</span> entirely numeric<span class="token punctuation">.</span></span>
<span class="line">Bypass password validation <span class="token keyword">and</span> create user anyway? <span class="token punctuation">[</span>y<span class="token operator">/</span>N<span class="token punctuation">]</span><span class="token punctuation">:</span> y  <span class="token comment"># 密码太简单了,依然要创建输入y</span></span>
<span class="line">Superuser created successfully<span class="token punctuation">.</span>  <span class="token comment"># 创建成功</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="后台管理" tabindex="-1"><a class="header-anchor" href="#后台管理"><span>后台管理</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 默认情况下通过路由admin进入后台管理页面,只会有users的管理</span></span>
<span class="line"><span class="token comment"># 如果想要对其他的模型类进行管理,需要在应用文件夹中的admin.py中注册模型类</span></span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin</span>
<span class="line"><span class="token keyword">from</span> app01 <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Register your models here.</span></span>
<span class="line">admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>models<span class="token punctuation">.</span>Student<span class="token punctuation">)</span></span>
<span class="line">admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>models<span class="token punctuation">.</span>Book<span class="token punctuation">)</span></span>
<span class="line">admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>models<span class="token punctuation">.</span>Publisher<span class="token punctuation">)</span></span>
<span class="line">admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>models<span class="token punctuation">.</span>Author<span class="token punctuation">)</span></span>
<span class="line">admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>models<span class="token punctuation">.</span>AuthorDetail<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># models.py</span></span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create your models here.</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;名字&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;年龄&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;书名&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    price <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span></span>
<span class="line">                                decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">                                verbose_name<span class="token operator">=</span><span class="token string">&#39;价格&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span></span>
<span class="line">                                blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># blank=True:后台管理页面字段允许为空</span></span>
<span class="line">    <span class="token comment"># null=True:数据库字段允许为空</span></span>
<span class="line">    publish <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Publisher&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;出版社&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span></span>
<span class="line">    authors <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Author&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;作者&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Publisher</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;出版社名&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    addr <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;出版社地址&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;作者名&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    addr <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;作者地址&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    author_detail <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;AuthorDetail&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;作者详情&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">AuthorDetail</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    phone <span class="token operator">=</span> models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;手机号&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="基于auth模块用户相关功能" tabindex="-1"><a class="header-anchor" href="#基于auth模块用户相关功能"><span>基于auth模块用户相关功能</span></a></h2><ul><li>auth.authenticate(request, username, password)</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token number">1.</span>自动查找auth_user表</span>
<span class="line"><span class="token number">2.</span>自动给传入的密码进行加密再比对</span>
<span class="line"><span class="token number">3.</span>返回值</span>
<span class="line">	如果找到了<span class="token punctuation">:</span>对象</span>
<span class="line">    如果没找到<span class="token punctuation">:</span><span class="token boolean">None</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>auth.login(request, user_obj)</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">类似于将当前登录的对象的信息保存到session中</span>
<span class="line">之后在所有地方都可以通过request<span class="token punctuation">.</span>user拿到拿到当前登录的用户</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>request.user</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">如果用户登录了<span class="token punctuation">,</span>那么可以获取到当前登录的用户对象</span>
<span class="line">如果用户没有登录<span class="token punctuation">,</span>那么返回的是匿名用户<span class="token punctuation">(</span>AnonymousUser<span class="token punctuation">)</span></span>
<span class="line">不能通过request<span class="token punctuation">.</span>user判断当前用户是否登录</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>request.user.is_authenticated</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">判断用户是否登录<span class="token punctuation">,</span>返回值为布尔类型</span>
<span class="line">用户登录返回<span class="token boolean">True</span></span>
<span class="line">未登录返回<span class="token boolean">False</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>登录认证装饰器</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 局部配置:直接在语法糖指定登录的路由,当用户未登录时自动跳转到改地址</span></span>
<span class="line"><span class="token decorator annotation punctuation">@login_required</span><span class="token punctuation">(</span>login_url<span class="token operator">=</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> 视图函数<span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 全局配置:去settings.py中写入</span></span>
<span class="line"><span class="token comment"># 进行全局配置,局部不写,默认所有的登录认证都会跳转到该地址</span></span>
<span class="line">LOGIN_URL <span class="token operator">=</span> <span class="token string">&#39;/login/&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>修改密码 <ul><li>request.user.check_password(旧密码):自动加密进行比对返回布尔值</li><li>request.user.set_password(新密码):修改对象的密码属性</li></ul></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token decorator annotation punctuation">@login_required</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">set_password</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        old_password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;old_password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        new_password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;new_password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        re_password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;re_password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 两次密码是否一致</span></span>
<span class="line">        <span class="token keyword">if</span> new_password <span class="token operator">==</span> re_password<span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 校验旧密码是否正确</span></span>
<span class="line">            is_right <span class="token operator">=</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>check_password<span class="token punctuation">(</span>old_password<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> is_right<span class="token punctuation">:</span></span>
<span class="line">                <span class="token comment"># 将新密码修改到数据库</span></span>
<span class="line">                request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>new_password<span class="token punctuation">)</span>  <span class="token comment"># 修改对象的属性</span></span>
<span class="line">                request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 保存到数据库</span></span>
<span class="line">                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;旧密码错误&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;两次密码不一致&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;set_password.html&#39;</span><span class="token punctuation">,</span> <span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>auth.logout(request):注销登录</p><p>会去到session表中将session记录删除</p></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    auth<span class="token punctuation">.</span>logout<span class="token punctuation">(</span>request<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>注册功能</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User</span>
<span class="line">user_obj <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create_user<span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># create_user能够将密码进行加密保存到数据库,但是是普通用户</span></span>
<span class="line"><span class="token comment"># create_superuser()可以创建超级用户,但是一般超级用户会在终端中创建</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自定义user表" tabindex="-1"><a class="header-anchor" href="#自定义user表"><span>自定义user表</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 1.在models.py自定义模型类继承AbstractUser(或者User)</span></span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AbstractUser</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>AbstractUser<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 会有auth_user表的其他字段</span></span>
<span class="line">     phone <span class="token operator">=</span> models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 可以新增其他字段</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2.在settings.py中指明user表使用自定义的</span></span>
<span class="line">AUTH_USER_MODEL <span class="token operator">=</span> <span class="token string">&#39;app01.User&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,32)])])}const o=n(t,[["render",l]]),u=JSON.parse('{"path":"/django/19-auth%E6%A8%A1%E5%9D%97.html","title":"importlib模块","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"创建超级用户","slug":"创建超级用户","link":"#创建超级用户","children":[]},{"level":2,"title":"后台管理","slug":"后台管理","link":"#后台管理","children":[]},{"level":2,"title":"基于auth模块用户相关功能","slug":"基于auth模块用户相关功能","link":"#基于auth模块用户相关功能","children":[]},{"level":2,"title":"自定义user表","slug":"自定义user表","link":"#自定义user表","children":[]}],"git":{},"filePathRelative":"django/19-auth模块.md"}');export{o as comp,u as data};
