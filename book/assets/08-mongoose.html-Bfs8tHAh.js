import{_ as s,c as a,a as p,o as e}from"./app-DWS4XIiF.js";const t={};function l(o,n){return e(),a("div",null,[...n[0]||(n[0]=[p(`<h2 id="mongodb数据库" tabindex="-1"><a class="header-anchor" href="#mongodb数据库"><span>mongodb数据库</span></a></h2><p>MongoDB是一个基于分布式文件存储的数据库。由C++语言编写。旨在为WEB应用提供可扩展的高性能数据存储解决方案。</p><p>MongoDB是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，是类似json的json格式，因此可以存储比较复杂的数据类型。</p><p>https://www.mongodb.com/try/download/community 进入Resources 选择社区服务进行</p><p>https://www.mongodb.com/try/download/compass 可视化工具</p><p>配置mongoodb的环境变量</p><p>cmd 打印中 mongod -version 查看是否安装成功</p><p>下载安装的时候 最好是不要直接安装可视化mongodb 下载会很慢</p><h2 id="mongodb数据库-1" tabindex="-1"><a class="header-anchor" href="#mongodb数据库-1"><span>mongodb数据库</span></a></h2><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd"><pre><code><span class="line">// cmd启动mongodb数据库</span>
<span class="line">mongod --dbpath  &quot;文件的路径&quot; --port 端口号   开启数据库</span>
<span class="line">// cmd 链接启动数据库</span>
<span class="line">mongo --port 端口号</span>
<span class="line"></span>
<span class="line">show dbs   // 展示所有的数据库</span>
<span class="line">show tables // 展示对应的集合</span>
<span class="line">	</span>
<span class="line">use  数据库名字    // 链接到指定的数据库</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>添</p></blockquote><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd"><pre><code><span class="line">db.集合名字.insert(数据)   // 向数据库的集合中填充数据 并添加集合</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><blockquote><p>查</p></blockquote><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd"><pre><code><span class="line">db.集合名字.find(数据)   // 集合查找数据(及可能多)</span>
<span class="line">db.集合名字.findOne(数据) // 查找集合中的一个数据</span>
<span class="line">db.集合名字.find(数据).limit(数量)  // limit(数量)限制查找数量</span>
<span class="line"></span>
<span class="line">如果需要限制查找数据的数量可以使用limit(数量)函数</span>
<span class="line">如果需要跳过指定的数据可以使用skip(数量)函数</span>
<span class="line">如果需要获得查找的数据的长度可以使用count()函数</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>删</p></blockquote><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd"><pre><code><span class="line">db.集合名字.remove()      删除集合中的数据（尽可能多)</span>
<span class="line">db.集合名字.remove({},1) 删除集合中的一个数据</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>改</p></blockquote><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd"><pre><code><span class="line">// 更新一个数据</span>
<span class="line">db.集合名字.update({需要更改数据},{$set:{更改后数据}})</span>
<span class="line">// 更新多个数据</span>
<span class="line">db.集合名字.update(</span>
<span class="line">	{需要更改数据},</span>
<span class="line">	{$set:{更改后数据}},</span>
<span class="line">	{multi:true}  // 更新多个数据</span>
<span class="line">)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mongoose库" tabindex="-1"><a class="header-anchor" href="#mongoose库"><span>mongoose库</span></a></h2><p>Mongoose是一个在Node.js环境中使用MongoDB的对象模型工具。它是一个优秀的ODM（对象文档映射）库，提供了一种在Node.js应用程序中定义模式、验证数据、构建查询和处理数据库操作的简单而强大的方式</p><p>数据默认存储地址是在安装位置的 data文件夹中</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">npm i mongoose  </span>
<span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="链接数据库" tabindex="-1"><a class="header-anchor" href="#链接数据库"><span>链接数据库</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//连接 test 数据库</span></span>
<span class="line">mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;mongodb://localhost:27017/ceshi&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Connected to MongoDB&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Error connecting to MongoDB:&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="schema" tabindex="-1"><a class="header-anchor" href="#schema"><span>Schema</span></a></h2><p>Schema（模式）是用于定义MongoDB集合中文档的结构、字段类型和验证规则的对象</p><p>Schema的常用数据类型：<code>String Number Date Boolean Buffer Mixed ObjectId Array</code>。</p><p>基础型</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">let</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span>String<span class="token punctuation">,</span></span>
<span class="line">        <span class="token comment">// 必须输入</span></span>
<span class="line">        <span class="token literal-property property">required</span><span class="token operator">:</span><span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">age</span><span class="token operator">:</span>Number<span class="token punctuation">,</span>  </span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//增 create</span></span>
<span class="line">user<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span> <span class="token operator">:</span> <span class="token string">&quot;ceshi&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">age</span> <span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/*</span>
<span class="line">	基础类型规则</span>
<span class="line">		String  字符串				:&quot;123&quot;,</span>
<span class="line">        Number  数字				 :12,</span>
<span class="line">        Date    时间				 :new Date(),</span>
<span class="line">        Buffer  buffer			  :new Buffer(&quot;大哥&quot;),</span>
<span class="line">        Boolean 布尔值				:true,</span>
<span class="line">        Array   数组和对象都可以	 :[1,2,3]</span>
<span class="line">        Object  对象</span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通用型</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line">name:{</span>
<span class="line">	type: 类型</span>
<span class="line">	</span>
<span class="line">	required :   true | false ;     		是否必须输入</span>
<span class="line">	required : 	 [true, &#39;Why no bacon?&#39;]  	必须输入 不输入返回自定义报错信息</span>
<span class="line">	required: 	function() { return this.userId != null }  验证  可以不讲</span>
<span class="line"></span>
<span class="line">	default : 默认值   数组对象也可以直接返回数据 </span>
<span class="line">			default  默认值可以是function 返回的默认值</span>
<span class="line">	</span>
<span class="line">	自定义验证</span>
<span class="line">	validate:{</span>
<span class="line">      validator: function(v) {</span>
<span class="line">            if(v == &quot;WQR&quot;){</span>
<span class="line">                return false</span>
<span class="line">            }</span>
<span class="line">		},</span>
<span class="line">        // 上面判断为false 就执行message函数</span>
<span class="line">        message: &#39;手机号码格式错误！&#39;         </span>
<span class="line">   }</span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>字符串</p><ul><li>lowercase: true 字母大写转化成字母小写</li><li>uppercase: true 字母小写转化字母大写</li><li>trim:true 清空左右空格</li><li>enum:[组合选择其中的一项] 写入的数据必须是这其中的一项</li><li>minlength: number 字符串最小长度</li><li>maxlength: number 字符串最大长度</li></ul><p>数字型</p><ul><li>min:number 最小值</li><li>max:number 最大值</li></ul><p>对象嵌套</p><div class="language-txt line-numbers-mode" data-highlighter="prismjs" data-ext="txt"><pre><code><span class="line">对象嵌套   里面设置的类型无效   </span>
<span class="line">obj:{</span>
<span class="line">    type:Object,</span>
<span class="line">    name:String,</span>
<span class="line">    age:Number,</span>
<span class="line">    sex:{</span>
<span class="line">        type:String,</span>
<span class="line">        enum:[&quot;男&quot;,&quot;女&quot;],</span>
<span class="line">    },</span>
<span class="line">} </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>特殊需求</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">/*</span>
<span class="line">特殊需求  </span>
<span class="line">  new mongoose.Schema({ ofString:[Number] })</span>
<span class="line"> </span>
<span class="line">使用数组包裹数据 里面的所有内容变成指定格式   不能转化就报错</span>
<span class="line">  ofString:   [String],</span>
<span class="line">  ofNumber:   [Number],</span>
<span class="line">  ofDates:    [Date],  </span>
<span class="line">  ofBuffer:   [Buffer],</span>
<span class="line">  ofBoolean:  [Boolean],</span>
<span class="line"> </span>
<span class="line"> db.create({</span>
<span class="line">    ofString: [1,2,3,&quot;打分1&quot;,true]  全部转化成String</span>
<span class="line"> })</span>
<span class="line">*/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="取消版本信息" tabindex="-1"><a class="header-anchor" href="#取消版本信息"><span>取消版本信息</span></a></h3><p>Schema构造函数可以接受第二个对象参数，比如我们可以传入<code>{versionKey : false}</code>来取消每项数据的版本信息。</p><h2 id="model" tabindex="-1"><a class="header-anchor" href="#model"><span>Model</span></a></h2><p>通过创建一个模型（Model）来定义数据表</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">//建立一个名为 &quot;users&quot;（存储到数据库的时候，mongoose默认为表名补上&quot;s&quot;）的表 指定表数据规则 userScheme</span></span>
<span class="line"><span class="token comment">//返回值定义一个变量来接收，用于接下来的增删改查操作</span></span>
<span class="line"><span class="token keyword">const</span> user <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span>userScheme<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意1：如果第一次建立 &quot;users&quot; 表，且不存数据的话，这个表是不会在数据库中建立的。</p><p>注意2：这和连接数据库是同步代码，但是不用担心连接的异步问题，mongoose会自动在连接成功之后处理。</p><h2 id="增删改查" tabindex="-1"><a class="header-anchor" href="#增删改查"><span>增删改查</span></a></h2><p>可以使用<em>回调</em>、<em>Promise</em>或者<em>async函数</em>的形式来检测接来下的各种操作是否成功，推荐<em>Promise</em>。</p><p>删除更新等操作<strong>没有错误捕捉（或者回调函数）的情况下，是不执行的</strong>，所以建议为每项操作添加上错误捕捉。</p><p>需要设置 .then 或 callback 或 await使用</p><h3 id="增" tabindex="-1"><a class="header-anchor" href="#增"><span>增</span></a></h3><p><code>create save insertMany </code> 都可以进行添加</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">//增 create</span></span>
<span class="line">user<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span> <span class="token operator">:</span> <span class="token string">&quot;ceshi&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">age</span> <span class="token operator">:</span> <span class="token string">&quot;123456&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">user<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;xuxin&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	</span>
<span class="line"></span>
<span class="line"><span class="token comment">// 写入多条</span></span>
<span class="line">user<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;xuxin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;夏栀&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">)</span></span>
<span class="line">user<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;许鑫1&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">pas</span><span class="token operator">:</span><span class="token number">12345</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;许鑫2&quot;</span><span class="token punctuation">,</span><span class="token literal-property property">pas</span><span class="token operator">:</span><span class="token number">12345</span><span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查" tabindex="-1"><a class="header-anchor" href="#查"><span>查</span></a></h3><p>根据条件查询对应数据</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//查找到一个      未查找到返回null 查找到返回 =&gt; 对象结构数据</span></span>
<span class="line"><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token comment">//通过id名查找   未查找到返回null 查找到返回 =&gt; 对象结构数据</span></span>
<span class="line"><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment">// 查询多个        未查找到返回[]  查找到返回  =&gt; 数组结构数据</span></span>
<span class="line"></span>
<span class="line">Model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span> conditions<span class="token punctuation">,</span> <span class="token punctuation">[</span>projection<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	conditions  查询条件</span>
<span class="line">	projection  返回内容选项</span>
<span class="line">	options     查询配置选项</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>conditions 常用查询条件</p></blockquote><pre><code>{}                      基础条件块， {name:&quot;afei&quot;}
$or $nor                或者 或者取反，{$or:[{name:&quot;afei&quot;},{age:&quot;20&quot;}]}
$gt $gte $lt $lte $ne   大于 大于等于 小于 小于等于 不等于，{age:{$lt:20}}
$in $nin                包含/不包含指定的多个字段之类，{name:{$in:[&quot;afei&quot;,&quot;zhuque&quot;]}}
$exists                  存在某属性，{age:{$exists:true}}
$size                   数组长度匹配， {arr:{$size:2}}
$all                    数组中是否存在指定的所有项，{arr:{$all:[123,456]}}
正则                    使用正则匹配，{name:{$regex: 变量 }} 
</code></pre><blockquote><p>projection 返回内容选项</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">默认全部显示</span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span>        只显示age属性和_id属性</span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span>  只显示age属性</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>options 查询配置选项</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token punctuation">{</span><span class="token literal-property property">skip</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">}</span>         略过前<span class="token number">2</span>条数据</span>
<span class="line"><span class="token punctuation">{</span><span class="token literal-property property">limit</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">}</span>        最多返回<span class="token number">5</span>条属性</span>
<span class="line"><span class="token punctuation">{</span><span class="token literal-property property">sort</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>   按照age项升序排列</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>示列</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span></span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">userName</span><span class="token operator">:</span><span class="token string">&quot;ceshi&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">userName</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">skip</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token literal-property property">limit</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token literal-property property">sort</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="改" tabindex="-1"><a class="header-anchor" href="#改"><span>改</span></a></h3><p>根据查询条件删除对应数据</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// update updateOne updateMany findByIdAndUpdate</span></span>
<span class="line"><span class="token comment">// update(conditions)</span></span>
<span class="line"></span>
<span class="line">Model<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>conditions<span class="token punctuation">,</span>doc<span class="token punctuation">,</span><span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">	conditions   查询条件（和find一样）</span>
<span class="line">	doc          要修改的内容</span>
<span class="line">	options      选项</span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line"><span class="token comment">// updateOne未修改  返回修改的结果    修改后一样的只是数据进行修改 </span></span>
<span class="line">  <span class="token literal-property property">acknowledged</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   是否找到</span>
<span class="line">  <span class="token literal-property property">modifiedCount</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>     修改了几个</span>
<span class="line">  <span class="token literal-property property">upsertedId</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">upsertedCount</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">matchedCount</span><span class="token operator">:</span> <span class="token number">1</span>       匹配多少数据</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>doc 要修改的内容</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">password</span><span class="token operator">:</span><span class="token string">&quot;456&quot;</span><span class="token punctuation">}</span>                     修改 password 为<span class="token string">&quot;456&quot;</span>  </span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;userInfo.test&quot;</span><span class="token operator">:</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>       修改 userInfo<span class="token punctuation">.</span>test 为<span class="token string">&quot;123&quot;</span></span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">$inc</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                       修改 age  自增<span class="token number">1</span></span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">$unset</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                     移除 age 属性（值随便写啥都是移除）</span>
<span class="line">	</span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">$push</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">arr</span><span class="token operator">:</span><span class="token number">999</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                    为 arr数组 添加一条 <span class="token number">999</span> 值</span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">$push</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">arr</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">$each</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token literal-property property">$slice</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>  为 arr数组 添加 <span class="token number">1</span> <span class="token number">4</span> <span class="token number">5</span> <span class="token number">9</span> 值，并截取倒数<span class="token number">5</span>个</span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">$addToSet</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">arr</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                 为 arr数组 添加一条 <span class="token number">20</span> 值，如果<span class="token number">20</span>存在，则不添加</span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">$pop</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">arr</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                       删除 arr数组 的最后一项，arr值为<span class="token operator">-</span><span class="token number">1</span> 则删除第一项</span>
<span class="line">	<span class="token punctuation">{</span><span class="token literal-property property">$pull</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">arr</span><span class="token operator">:</span><span class="token number">123</span><span class="token punctuation">}</span><span class="token punctuation">}</span>                    删除 arr数组 所有<span class="token number">123</span>值</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>示列</p></blockquote><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line">user<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">age</span><span class="token operator">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name.ww&quot;</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;res&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="删" tabindex="-1"><a class="header-anchor" href="#删"><span>删</span></a></h3><p>根据条件进行删除</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// MyModel.daleteOne( conditions, [projection], [options]  只有查询有作用</span></span>
<span class="line">MyModel<span class="token punctuation">.</span><span class="token function">daleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 删除一条数据 1  返回删除几条数据deletedCount:1</span></span>
<span class="line"></span>
<span class="line">MyModel<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 删除多条数据 \`</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//删除age值小于21的</span></span>
<span class="line"><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token literal-property property">$lt</span><span class="token operator">:</span><span class="token number">21</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="中间件" tabindex="-1"><a class="header-anchor" href="#中间件"><span>中间件</span></a></h2><p>为Schema实例设置 pre / post 可以为后续操作设置前后钩子。</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">let</span> Schema<span class="token operator">=</span>  mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">let</span> userSchema  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">user</span><span class="token operator">:</span>String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">age</span><span class="token operator">:</span>Number<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">arr</span><span class="token operator">:</span>Object<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">obj</span><span class="token operator">:</span>Array<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// 中间件要写在定义之前  也就是表规则插入表格中之前</span></span>
<span class="line">userSchema<span class="token punctuation">.</span><span class="token function">pre</span><span class="token punctuation">(</span><span class="token string">&quot;find&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;find方法  执行之前，这里代码会执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">userSchema<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;find&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">doc</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;find方法  执行之后，这里代码会执行&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;qweqwe&quot;</span><span class="token punctuation">,</span>userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">db<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;xuxin&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="表关联" tabindex="-1"><a class="header-anchor" href="#表关联"><span>表关联</span></a></h2><p>通过定义表之间的关联来实现数据的关联查询和操作</p><h3 id="引用" tabindex="-1"><a class="header-anchor" href="#引用"><span>引用</span></a></h3><ul><li>使用引用方式，可以通过在一个文档中存储对其他文档的引用来建立关联。</li><li>在一个表中，创建一个字段来存储对另一个表的引用，通常使用另一个表的主键（_id）作为引用。</li><li>使用populate()方法可以将引用转换为实际的关联文档。</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// 定义用户数据表的模式</span></span>
<span class="line"><span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&#39;Post&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 创建用户模型</span></span>
<span class="line"><span class="token keyword">const</span> User <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 定义文章数据表的模式</span></span>
<span class="line"><span class="token keyword">const</span> postSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&#39;User&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 创建文章模型</span></span>
<span class="line"><span class="token keyword">const</span> Post <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;Post&#39;</span><span class="token punctuation">,</span> postSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment">// populate(&quot;user&quot;,&quot;显示的属性&quot;) </span></span>
<span class="line">Post<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="子文档" tabindex="-1"><a class="header-anchor" href="#子文档"><span>子文档</span></a></h3><ul><li>在一个表中，可以定义一个字段为子文档类型，以表示和其他表的嵌套关系。</li><li>子文档可以具有自己的模式和方法，可以在父表的文档中进行创建和操作</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> childSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;string&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> parentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>childSchema<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> Parent <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;Parent&#39;</span><span class="token punctuation">,</span> parentSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 创建子文件数据</span></span>
<span class="line"><span class="token keyword">let</span> result <span class="token operator">=</span> Parent<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">children</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;6666666&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">age</span><span class="token operator">:</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 查询</span></span>
<span class="line">Parent<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">&#39;children.name&#39;</span><span class="token operator">:</span> <span class="token string">&#39;6666666&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> foundParent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="session" tabindex="-1"><a class="header-anchor" href="#session"><span>session</span></a></h2><p>使用 express express-session mongoose</p><p>将session数据存储到数据库中</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> connectMongo <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;connect-mongo&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">在session的中间件中写</span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">cookie</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">        </span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">store</span><span class="token operator">:</span>connectMongo<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">mongoUrl</span><span class="token operator">:</span><span class="token string">&quot;数据库地址&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="链接多个数据库" tabindex="-1"><a class="header-anchor" href="#链接多个数据库"><span>链接多个数据库</span></a></h2><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// 链接第一个数据库</span></span>
<span class="line"><span class="token keyword">let</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">&quot;mongodb://localhost:27018/www&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">// 不能.then</span></span>
<span class="line">db<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库链接成功&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">db<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据库链接失败&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> Mng <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span>String<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token literal-property property">versionKey</span><span class="token operator">:</span><span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">let</span> newMng <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;dage&quot;</span><span class="token punctuation">,</span>Mng<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">newMng<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;美少女&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;吸入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 链接第二个数据库</span></span>
<span class="line"><span class="token keyword">let</span> db1 <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token string">&quot;mongodb://localhost:27018/rrr&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">useNewUrlParser</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">useUnifiedTopology</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">db1<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;open&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;db1数据库链接成功&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">db1<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;db1数据库链接失败&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">let</span> Mng1 <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span>String<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">versionKey</span><span class="token operator">:</span><span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">let</span> newMng1 <span class="token operator">=</span> db1<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&quot;zhen&quot;</span><span class="token punctuation">,</span>Mng1<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">newMng1<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;美少女&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;吸入成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="其他" tabindex="-1"><a class="header-anchor" href="#其他"><span>其他</span></a></h2><h3 id="查找深层对象" tabindex="-1"><a class="header-anchor" href="#查找深层对象"><span>查找深层对象</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$oid&quot;</span><span class="token operator">:</span><span class="token string">&quot;6112114bcd2d4c2e8cb4fc50&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;nes&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;swe&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;ww&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token string-property property">&quot;ss&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token string-property property">&quot;qwe&quot;</span><span class="token operator">:</span><span class="token number">123</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;__v&quot;</span><span class="token operator">:</span><span class="token number">0</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">mongoose<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;nes.name&quot;</span><span class="token operator">:</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">||</span>  nest<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;swe.ww.ss.qwe&quot;</span><span class="token operator">:</span><span class="token number">123</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改或添加深层对象" tabindex="-1"><a class="header-anchor" href="#修改或添加深层对象"><span>修改或添加深层对象</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;_id&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token string-property property">&quot;$oid&quot;</span><span class="token operator">:</span><span class="token string">&quot;61121094df4a4d1d68132c4f&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;nes&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string-property property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;woshinide&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;__v&quot;</span><span class="token operator">:</span><span class="token number">0</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">nest<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;nes.name&quot;</span><span class="token operator">:</span><span class="token string">&quot;woshinide&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;nes.weer&quot;</span><span class="token operator">:</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 添加</span></span>
<span class="line">nest<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string-property property">&quot;nes.name&quot;</span><span class="token operator">:</span><span class="token string">&quot;woshinide&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string-property property">&quot;nes.name&quot;</span><span class="token operator">:</span><span class="token string">&quot;修改的知识&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="表嵌套取值" tabindex="-1"><a class="header-anchor" href="#表嵌套取值"><span>表嵌套取值</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// 表嵌套中嵌套取值</span></span>
<span class="line">leaveMessagTlabe<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">&quot;children.user&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="定义数组中的对象id" tabindex="-1"><a class="header-anchor" href="#定义数组中的对象id"><span>定义数组中的对象ID</span></a></h4><p>设置数组中对象出现ID进行修改</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./mongoose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> mongoLogin <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./mongoLogin&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span>  db<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span></span>
<span class="line">    <span class="token string">&quot;mongoShop&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">			<span class="token literal-property property">mongoShopGoods</span><span class="token operator">:</span><span class="token punctuation">[</span>      <span class="token comment">// 设置所有商品  //内部还需嵌套</span></span>
<span class="line">				<span class="token punctuation">{</span></span>
<span class="line">					<span class="token literal-property property">date</span><span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">						<span class="token literal-property property">type</span><span class="token operator">:</span>String<span class="token punctuation">,</span></span>
<span class="line">						<span class="token keyword">default</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">					<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">					<span class="token literal-property property">title</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">				    <span class="token literal-property property">articleTitle</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">					<span class="token literal-property property">serialNumber</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">				<span class="token punctuation">}</span></span>
<span class="line">			<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">versionKey</span><span class="token operator">:</span><span class="token boolean">false</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://api2.mubu.com/v3/document_image/761dadca-7c0c-4975-a74a-7b39c6824f18-7637318.jpg" referrerpolicy="no-referrer"><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token comment">// 修改数组中的对象</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">qqq</span> <span class="token operator">=</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> mongoShop<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span></span>
<span class="line">		<span class="token punctuation">{</span> <span class="token literal-property property">mongoShopAuthor</span><span class="token operator">:</span> <span class="token string">&quot;623f13523c3f1dfa29c152bd&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">{</span></span>
<span class="line">			<span class="token string-property property">&quot;$set&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">				<span class="token comment">// &quot;mongoShopGoods.$[articleTitle]&quot; : &quot;66666&quot;</span></span>
<span class="line">				<span class="token string-property property">&quot;mongoShopGoods.$[outer].articleTitle&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;666&quot;</span></span>
<span class="line">			<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">{</span> </span>
<span class="line">			<span class="token comment">// 过滤数据  可以写多个</span></span>
<span class="line">			<span class="token string-property property">&quot;arrayFilters&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">		        <span class="token punctuation">{</span> <span class="token string-property property">&quot;outer._id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;6242c9ca9d44a1259a3fcc5b&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">			<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">		<span class="token punctuation">}</span></span>
<span class="line">	<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token keyword">return</span> result</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,103)])])}const i=s(t,[["render",l]]),u=JSON.parse('{"path":"/node/08-mongoose.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"mongodb数据库","slug":"mongodb数据库","link":"#mongodb数据库","children":[]},{"level":2,"title":"mongodb数据库","slug":"mongodb数据库-1","link":"#mongodb数据库-1","children":[]},{"level":2,"title":"mongoose库","slug":"mongoose库","link":"#mongoose库","children":[{"level":3,"title":"链接数据库","slug":"链接数据库","link":"#链接数据库","children":[]}]},{"level":2,"title":"Schema","slug":"schema","link":"#schema","children":[{"level":3,"title":"取消版本信息","slug":"取消版本信息","link":"#取消版本信息","children":[]}]},{"level":2,"title":"Model","slug":"model","link":"#model","children":[]},{"level":2,"title":"增删改查","slug":"增删改查","link":"#增删改查","children":[{"level":3,"title":"增","slug":"增","link":"#增","children":[]},{"level":3,"title":"查","slug":"查","link":"#查","children":[]},{"level":3,"title":"改","slug":"改","link":"#改","children":[]},{"level":3,"title":"删","slug":"删","link":"#删","children":[]}]},{"level":2,"title":"中间件","slug":"中间件","link":"#中间件","children":[]},{"level":2,"title":"表关联","slug":"表关联","link":"#表关联","children":[{"level":3,"title":"引用","slug":"引用","link":"#引用","children":[]},{"level":3,"title":"子文档","slug":"子文档","link":"#子文档","children":[]}]},{"level":2,"title":"session","slug":"session","link":"#session","children":[]},{"level":2,"title":"链接多个数据库","slug":"链接多个数据库","link":"#链接多个数据库","children":[]},{"level":2,"title":"其他","slug":"其他","link":"#其他","children":[{"level":3,"title":"查找深层对象","slug":"查找深层对象","link":"#查找深层对象","children":[]},{"level":3,"title":"修改或添加深层对象","slug":"修改或添加深层对象","link":"#修改或添加深层对象","children":[]},{"level":3,"title":"表嵌套取值","slug":"表嵌套取值","link":"#表嵌套取值","children":[]}]}],"git":{},"filePathRelative":"node/08-mongoose.md"}');export{i as comp,u as data};
