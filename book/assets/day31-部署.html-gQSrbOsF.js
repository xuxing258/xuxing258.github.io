import{_ as n,a as i,b as l,c as a,d as e,e as p,f as t,g as c,h as o,i as u,j as d,k as r,l as m,m as g,n as v,o as h,p as b,q as k,r as y}from"./08-部署 (7)-XzR_irBn.js";import{_ as w,c as x,a as _,o as f}from"./app-BkadFxXL.js";const q={};function S(W,s){return f(),x("div",null,[...s[0]||(s[0]=[_('<h2 id="部署" tabindex="-1"><a class="header-anchor" href="#部署"><span>部署</span></a></h2><p>虚拟机网络: 先练习linux命令,之后有条件了再去练习部署</p><h3 id="nginx-uwsgi介绍" tabindex="-1"><a class="header-anchor" href="#nginx-uwsgi介绍"><span>nginx+uWSGI介绍</span></a></h3><ul><li>uWSGI是一个web服务器,他实现了WSGI协议,uwsgi,http等协议.要做的事情就是把HTTP协议转换成语言所支持的网络协议(将http协议转换成WSGI协议,让python能够直接使用) <ul><li>WSGI是一种通信协议.是为python语言定义的web服务器和web应用程序(框架)之间的一种简单而通用的接口,是用来描述web服务器如何和django框架之间进行通信.</li><li>uwsgi是一种线路协议而不是通信协议,用于在uWSGI服务器和其他网络服务器的数据通信</li></ul></li><li>为什么有了uWSGI还需要nginx: <ul><li>因为nginx具备优秀的静态内容处理内容,然后将动态内容转发给uWSGI服务器.</li></ul></li></ul><img src="'+n+'"><ul><li>nginx作为直接对外服务的接口,接收来自客户端发送过来的http请求</li><li>如果是静态文件请求就根据nginx配置的静态文件目录,返回请求的资源</li><li>如果是动态请求,nginx就通过配置文件,将请求传递给uWSGI.</li><li>wsgi根据请求调用django后端的某个文件或者函数,处理完之后将返回值交给wsgi</li><li>wsgi将返回值进行打包,转发给uWSGI</li><li>uWSGI接收到后转发给nginx.nginx最终将返回值返回给客户端</li></ul><h3 id="部署前的准备" tabindex="-1"><a class="header-anchor" href="#部署前的准备"><span>部署前的准备</span></a></h3><p>2.1 python下载与ubuntu版本更新:</p><p>https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/20.04/</p><img src="'+i+'"><p>20.04自带的python版本是python3.8,可以直接下载django4.2</p><ul><li><p>pip还是需要下载 sudo apt install python3-pip</p></li><li><p>pip下载好之后可以准备项目所需的第三方库</p><ul><li>pip3 install django==4.2</li><li>(可以使用镜像文件:-i https://pypi.tuna.tsinghua.edu.cn/simple/)</li><li>pip3 install pymysql</li><li>pip3 install mysqlclient</li><li>(下载mysqlclient之前在ubuntu下载客户端:sudo apt install libmysqlclient-dev)</li><li>pip3 install pillow</li><li>pip3 install beautifulsoup4</li></ul></li></ul><h4 id="mysql数据库下载" tabindex="-1"><a class="header-anchor" href="#mysql数据库下载"><span>mysql数据库下载</span></a></h4><ul><li>下载数据库 sudo apt install mysql-server</li><li>安全认证 sudo mysql_secure_installation <ul><li><img src="'+l+'"></li><li><img src="'+a+'"></li><li><img src="'+e+'"></li><li><img src="'+p+'"></li><li><img src="'+t+'"></li></ul></li><li>修改密码 <ul><li>sudo mysql--&gt;进入mysql服务器</li><li>use mysql; ---&gt;切换到mysql表</li><li>alter user &#39;root&#39;@&#39;localhost&#39; identified with mysql_native_password by &#39;密码&#39;; --&gt;修改root用户密码,密码设置为windows系统上root用户的密码</li><li>flush privileges; --&gt;更新配置</li></ul></li><li>修改允许其他网络访问 <ul><li>select host, user from mysql.user;--&gt;查看网络访问情况</li><li>update user set host=&#39;%&#39; where user=&#39;root&#39;;---&gt;修改配置</li><li>flush privileges;---&gt;更新配置</li></ul></li><li>创建项目所需数据库 <ul><li>进入mysql服务器:mysql -uroot -p</li><li>创建数据库:create database 数据库名;</li></ul></li></ul><h4 id="将windows系统的django项目发送到linux系统" tabindex="-1"><a class="header-anchor" href="#将windows系统的django项目发送到linux系统"><span>将windows系统的django项目发送到linux系统</span></a></h4><ul><li>linux安装ssh实现远程登录 <ul><li>安装服务:sudo apt install openssh-server</li><li>启动服务:sudo systemctl start sshd.service</li><li>查看运行状态:sudo systemctl status sshd.service</li></ul></li></ul><img src="'+c+'"><ul><li>windows系统安装WinSCP软件远程连接linux <ul><li>通过ifconfig查看linux的ip地址</li></ul></li></ul><p>(ifconfig命令需要下载:sudo apt install net-tools)</p><img src="'+o+'"><p>将需要部署的django项目移动到linux系统</p><img src="'+u+'"><h4 id="准备数据库数据" tabindex="-1"><a class="header-anchor" href="#准备数据库数据"><span>准备数据库数据</span></a></h4><blockquote><p>linux系统:切换到manage.py统计目录下进行数据库迁移两条命令(settings.py中连接的数据库配置要一致)</p></blockquote><p>python3 manage.py makemigrations(没有改变)</p><p>python3 manage.py migrate</p><blockquote><p>去windows系统中将之前执行过的数据备份出来</p></blockquote><p>mysqldump -uroot -p123456 数据库名 &gt; 路径</p><img src="'+d+'"><blockquote><p>在linux系统执行插入语句</p></blockquote><p>进入mysql服务器:mysql -uroot -p</p><p>切换数据库:use 数据库名;</p><p>执行insert语句:</p><img src="'+r+'"><h4 id="查看项目是否能够正常运行" tabindex="-1"><a class="header-anchor" href="#查看项目是否能够正常运行"><span>查看项目是否能够正常运行</span></a></h4><blockquote><p>linux系统:切换到manage.py同级目录下</p></blockquote><p>python3 manage.py runserver</p><p>能够成功运行说明准备工作结束!</p><h4 id="将settings-py中allowed-host的值进行修改" tabindex="-1"><a class="header-anchor" href="#将settings-py中allowed-host的值进行修改"><span>将settings.py中ALLOWED_HOST的值进行修改</span></a></h4><ul><li>vim settings.py进入编辑器</li><li>按i进入编辑模式修改</li></ul><img src="'+m+'"><ul><li>按esc退回到命令模式</li><li>在命令模式下输入shift加;进入末行模式</li><li>在末行模式下输入wq保存并退出</li></ul><h3 id="uwsgi服务器" tabindex="-1"><a class="header-anchor" href="#uwsgi服务器"><span>uWSGI服务器</span></a></h3><ul><li>下载uWSGI <ul><li>下载第三方库:pip3 install uwsgi</li><li>下载命令:sudo apt install uwsgi</li></ul></li><li>创建需要的文件夹 <ul><li>在项目根目录下创建delop文件夹</li><li>再去到delop文件夹中创建logs文件夹和uwsgi_conf.ini配置文件</li></ul></li></ul><img src="'+g+`"><ul><li>在uwsgi_conf.ini中写入</li><li>下载vim编辑器:sudo apt install vim</li><li>进入编辑器:vim uwsgi_conf.ini</li><li>输入i进入编辑模式写入下面内容</li></ul><div class="language-uwsg line-numbers-mode" data-highlighter="prismjs" data-ext="uwsg"><pre><code><span class="line">[uwsgi]</span>
<span class="line"># ip地址和端口号</span>
<span class="line">socket=192.168.174.130:8001</span>
<span class="line"># 项目根目录</span>
<span class="line">chdir=/home/python/bbs</span>
<span class="line"># wsgi.py文件的相对路径</span>
<span class="line">wsgi-file=bbs/wsgi.py</span>
<span class="line"># 进程数</span>
<span class="line">processes=4</span>
<span class="line"># 线程数</span>
<span class="line">threads=2</span>
<span class="line"># uwsgi服务器的角色</span>
<span class="line">master=True</span>
<span class="line"># 存放进程编号的文件</span>
<span class="line">pidfile=uwsgi.pid</span>
<span class="line"># 日志文件(因为uwsgi是脱离终端在后台运行,终端看不到运行结果, logs文件夹需要手动创建)</span>
<span class="line">daemonize=logs/uwsgi.log</span>
<span class="line"># 指定python环境地址(可以通过which python3查看python地址)</span>
<span class="line">pythonpath=/usr/bin/python3</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>按esc退回到命令模式</li><li>在命令模式下按shift加;进入末行模式</li><li>在末行模式按wq保存并退出</li><li>运行uwsgi服务器 <ul><li>uwsgi --ini uwsgi_conf.ini &amp;</li></ul></li></ul><img src="`+v+`"><p>以上效果就是成功执行了!</p><p>强制退出:ctrl+c</p><h3 id="nginx服务器" tabindex="-1"><a class="header-anchor" href="#nginx服务器"><span>nginx服务器</span></a></h3><ul><li>下载nginx <ul><li>sudo apt install nginx</li></ul></li><li>配置nginx <ul><li>创建nginx_conf.conf文件</li><li>写入配置:vim nginx_conf.conf</li><li>按i进入编辑模式写入下面内容</li></ul></li></ul><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code><span class="line"><span class="token directive"><span class="token keyword">upstream</span> bbs</span><span class="token punctuation">{</span></span>
<span class="line">   <span class="token comment"># 此处是uwsgi运行的ip地址和端口号</span></span>
<span class="line">   <span class="token directive"><span class="token keyword">server</span> 192.168.174.130:8001</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span></span>
<span class="line">   <span class="token comment"># 监听端口</span></span>
<span class="line">   <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token comment"># 服务器域名或者ip地址(也是之后访问的地址)</span></span>
<span class="line">   <span class="token directive"><span class="token keyword">server_name</span> 192.168.174.130</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token comment"># 编码</span></span>
<span class="line">   <span class="token directive"><span class="token keyword">charset</span> utf-8</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token comment"># 文件最大上传大小</span></span>
<span class="line">   <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">75M</span></span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token comment"># 媒体文件</span></span>
<span class="line">   <span class="token directive"><span class="token keyword">location</span> /media</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token comment"># 媒体文件绝对路径</span></span>
<span class="line">       <span class="token directive"><span class="token keyword">alias</span> /home/python/bbs/media</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">   <span class="token comment"># 静态文件</span></span>
<span class="line">   <span class="token directive"><span class="token keyword">location</span> /static</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token directive"><span class="token keyword">alias</span> /home/python/bbs/static</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line">   <span class="token comment"># 主目录</span></span>
<span class="line">   <span class="token directive"><span class="token keyword">location</span> /</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token comment"># 这个地址就是上边uwsgi服务器的地址</span></span>
<span class="line">       <span class="token directive"><span class="token keyword">uwsgi_pass</span> bbs</span><span class="token punctuation">;</span></span>
<span class="line">       <span class="token directive"><span class="token keyword">include</span> /etc/nginx/uwsgi_params</span><span class="token punctuation">;</span></span>
<span class="line">   <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>按esc退回到命令模式</li><li>在命令模式下按shift加;进入末行模式</li><li>在末行模式下按wq保存并退出</li></ul><blockquote><p>将nginx_conf.conf移动到nginx文件夹中</p></blockquote><p>sudo mv nginx_conf.conf /etc/nginx/conf.d</p><img src="`+h+'"><ul><li>更改配置文件的第一句</li></ul><img src="'+b+'"><img src="'+k+'"><blockquote><p>测试配置文件是否有问题</p></blockquote><p>sudo nginx -t -c /etc/nginx/nginx.conf</p><img src="'+y+'"><ul><li>启动nginx <ul><li>sudo systemctl start nginx</li></ul></li><li>重启nginx <ul><li>sudo systemctl restart nginx</li></ul></li><li>查看nginx运行状态</li><li>sudo systemctl status nginx</li></ul><h3 id="访问服务" tabindex="-1"><a class="header-anchor" href="#访问服务"><span>访问服务</span></a></h3><p>在局域网中的其他主机可以通过配置的ip地址直接访问部署好的服务</p><p>(运行之后需要重启一下计算机,刷新一下配置.然后再重新运行uwsgi服务器,再运行nginx服务器)</p>',68)])])}const j=w(q,[["render",S]]),B=JSON.parse('{"path":"/django/day31-%E9%83%A8%E7%BD%B2.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"部署","slug":"部署","link":"#部署","children":[{"level":3,"title":"nginx+uWSGI介绍","slug":"nginx-uwsgi介绍","link":"#nginx-uwsgi介绍","children":[]},{"level":3,"title":"部署前的准备","slug":"部署前的准备","link":"#部署前的准备","children":[]},{"level":3,"title":"uWSGI服务器","slug":"uwsgi服务器","link":"#uwsgi服务器","children":[]},{"level":3,"title":"nginx服务器","slug":"nginx服务器","link":"#nginx服务器","children":[]},{"level":3,"title":"访问服务","slug":"访问服务","link":"#访问服务","children":[]}]}],"git":{},"filePathRelative":"django/day31-部署.md"}');export{j as comp,B as data};
