import{_ as n,c as a,a as p,o as e}from"./app-B89-99AF.js";const t={};function l(c,s){return e(),a("div",null,[...s[0]||(s[0]=[p(`<h1 id="drf框架" tabindex="-1"><a class="header-anchor" href="#drf框架"><span>drf框架</span></a></h1><h2 id="序列化serializer" tabindex="-1"><a class="header-anchor" href="#序列化serializer"><span>序列化serializer</span></a></h2><h3 id="序列化" tabindex="-1"><a class="header-anchor" href="#序列化"><span>序列化</span></a></h3><ul><li>models.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create your models here.</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Role</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;职务名称&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Department</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;部门名称&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    level_choices <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;普通用户&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;vip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;svip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    level <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span>level_choices<span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;级别&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;用户名&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;密码&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;年龄&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;邮箱&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    token <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    depart <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Department&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;部门&#39;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    roles <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Role&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;职务&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="序列化基本字段" tabindex="-1"><a class="header-anchor" href="#序列化基本字段"><span>序列化基本字段</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</span>
<span class="line"><span class="token keyword">from</span> app01 <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 序列化类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo</span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">     </span>
<span class="line"><span class="token comment"># 视图类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        ser <span class="token operator">=</span> UserModelSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line"><span class="token comment"># 访问</span></span>
<span class="line">get请求<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token operator">//</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>users<span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="自定义字段" tabindex="-1"><a class="header-anchor" href="#自定义字段"><span>自定义字段</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</span>
<span class="line"><span class="token keyword">from</span> app01 <span class="token keyword">import</span> models</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>forms<span class="token punctuation">.</span>models <span class="token keyword">import</span> model_to_dict</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 序列化类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># source:获取数据来源</span></span>
<span class="line">    level_text <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">&#39;get_level_display&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 获取choices参数字段实际的值</span></span>
<span class="line">    depart <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">&#39;depart.title&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 获取外键字段对应的表中的字段值</span></span>
<span class="line">    roles <span class="token operator">=</span> serializers<span class="token punctuation">.</span>SerializerMethodField<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 调用指定方法得到返回值</span></span>
<span class="line">    extra <span class="token operator">=</span> serializers<span class="token punctuation">.</span>SerializerMethodField<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 调用指定方法得到返回值</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo</span>
<span class="line">        <span class="token comment"># 如果没有自定义字段,那么引用数据库里的值</span></span>
<span class="line">        <span class="token comment"># 如果自定义了字段和数据库字段名重复了,会使用自定义的字段的值</span></span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token string">&#39;level&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;depart&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;level_text&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;roles&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;extra&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get_extra</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token number">666</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get_roles</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 引用的哪个模型类,obj就是哪个模型类的对象</span></span>
<span class="line">        role_queryset <span class="token operator">=</span> obj<span class="token punctuation">.</span>roles<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># list1 = []  # [{&#39;id&#39;:..., &#39;title&#39;:...}, {}]</span></span>
<span class="line">        <span class="token comment"># for role in role_queryset:</span></span>
<span class="line">        <span class="token comment">#     dict1 = {}</span></span>
<span class="line">        <span class="token comment">#     dict1[&#39;id&#39;] = role.id</span></span>
<span class="line">        <span class="token comment">#     dict1[&#39;title&#39;] = role.title</span></span>
<span class="line">        <span class="token comment">#     list1.append(dict1)</span></span>
<span class="line">        <span class="token comment"># model_to_dict:对象转换成字段</span></span>
<span class="line">        list1 <span class="token operator">=</span> <span class="token punctuation">[</span>model_to_dict<span class="token punctuation">(</span>role<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;title&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> role <span class="token keyword">in</span> role_queryset<span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">return</span> list1</span>
<span class="line"></span>
<span class="line">    </span>
<span class="line"><span class="token comment"># 模型类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        ser <span class="token operator">=</span> UserModelSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line"><span class="token comment"># 访问</span></span>
<span class="line">get请求<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token operator">//</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>users<span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="序列化的嵌套" tabindex="-1"><a class="header-anchor" href="#序列化的嵌套"><span>序列化的嵌套</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</span>
<span class="line"><span class="token keyword">from</span> app01 <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 序列化类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">DepartModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>Department</span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">]</span>  <span class="token comment"># 获取模型类中所以字段值</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">RoleModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>Role</span>
<span class="line">        fields <span class="token operator">=</span> <span class="token string">&#39;__all__&#39;</span></span>
<span class="line">        </span>
<span class="line">        </span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    level_text <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">&#39;get_level_display&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    depart <span class="token operator">=</span> DepartModelSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 一对多外键字段,查询结果只有一个</span></span>
<span class="line">    roles <span class="token operator">=</span> RoleModelSerializer<span class="token punctuation">(</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 多对多外键字段,查询结果有多个</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo</span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;level_text&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;depart&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;roles&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">        </span>
<span class="line">  </span>
<span class="line"><span class="token comment"># 视图类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        ser <span class="token operator">=</span> UserModelSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line"><span class="token comment"># 访问</span></span>
<span class="line">get请求<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token operator">//</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>users<span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="数据校验-序列化" tabindex="-1"><a class="header-anchor" href="#数据校验-序列化"><span>数据校验+序列化</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 让一个序列化类既做数据校验又做序列化,可以通过属性read_only=True(只做序列化)和write_only=True(只做数据校验)进行字段的区分</span></span>
<span class="line"><span class="token comment"># 如果序列化类用到了嵌套的序列化类,那么在做数据校验时,需要自己重写create函数来保存数据到数据库</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 序列化类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">DepartModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>Department</span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;title&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token comment"># 字段指定read_only=True---&gt;设置字段为只能序列化</span></span>
<span class="line">        <span class="token comment"># 字段设置write_ony=True---&gt;设置字段为只做数据校验</span></span>
<span class="line">        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&#39;id&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;read_only&#39;</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment"># id需要数据校验+序列化</span></span>
<span class="line">            <span class="token string">&#39;title&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;read_only&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span>  <span class="token comment"># title只做序列化</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">RoleModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>Role</span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;title&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&#39;id&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;read_only&#39;</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token comment"># id:数据校验+序列化</span></span>
<span class="line">            <span class="token string">&#39;title&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;read_only&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span>   <span class="token comment"># title:序列化</span></span>
<span class="line">        <span class="token punctuation">}</span>   </span>
<span class="line">        </span>
<span class="line">   </span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    level_text <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">&#39;get_level_display&#39;</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    depart <span class="token operator">=</span> DepartModelSerializer<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    roles <span class="token operator">=</span> RoleModelSerializer<span class="token punctuation">(</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    email2 <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>validators<span class="token operator">=</span><span class="token punctuation">[</span>EmailValidator<span class="token punctuation">(</span><span class="token string">&#39;邮箱格式不正确&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">                                   write_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo</span>
<span class="line">        <span class="token comment"># username, email, age:序列化+数据校验</span></span>
<span class="line">        <span class="token comment"># level_text:序列化</span></span>
<span class="line">        <span class="token comment"># level, email2, password: 数据校验</span></span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;password&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;level_text&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                  <span class="token string">&#39;level&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;depart&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;roles&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email2&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&#39;level&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;write_only&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;password&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;write_only&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 如果用到了嵌套的序列化类,在做数据校验保存数据到数据库时,需要自己重写create函数</span></span>
<span class="line">        depart <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;depart&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># {&#39;id: ...}</span></span>
<span class="line">        depart_id <span class="token operator">=</span> depart<span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        validated_data<span class="token punctuation">[</span><span class="token string">&#39;depart_id&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> depart_id</span>
<span class="line"></span>
<span class="line">        role_list <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;roles&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># [{...}, {...}]</span></span>
<span class="line">        role_id_list <span class="token operator">=</span> <span class="token punctuation">[</span>role<span class="token punctuation">[</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">]</span> <span class="token keyword">for</span> role <span class="token keyword">in</span> role_list<span class="token punctuation">]</span>  <span class="token comment"># role:{id: ...}</span></span>
<span class="line">        <span class="token comment"># role_id_list:[1, 2]</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># 先产生一个用户对象</span></span>
<span class="line">        user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 通过用户对象跨表到多对多关系表</span></span>
<span class="line">        user_obj<span class="token punctuation">.</span>roles<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token operator">*</span>role_id_list<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 返回创建的用户对象</span></span>
<span class="line">        <span class="token keyword">return</span> user_obj</span>
<span class="line"></span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line"><span class="token comment"># 视图类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 数据校验</span></span>
<span class="line">        ser <span class="token operator">=</span> UserModelSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">not</span> ser<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">1006</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>errors<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># 所有字段通过校验,保存数据</span></span>
<span class="line">        ser<span class="token punctuation">.</span>validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;email2&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        instance <span class="token operator">=</span> ser<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 自动调用序列化类中的create方法</span></span>
<span class="line">        <span class="token comment"># ser = UserModelSerializer(instance=instance, many=False)</span></span>
<span class="line">        <span class="token comment"># ser.data:获取序列化的结果</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 序列化:获取数据库所有数据进行展示</span></span>
<span class="line">        queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        ser <span class="token operator">=</span> UserModelSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  </span>
<span class="line"></span>
<span class="line"><span class="token comment"># 访问</span></span>
<span class="line"><span class="token comment"># post请求:http://localhost:8000/users/</span></span>
<span class="line">   请求体raw<span class="token punctuation">:</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;lilili&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;email2&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> </span>
<span class="line">    <span class="token string">&quot;depart&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;roles&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span><span class="token number">2</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># get请求:http://localhost:8000/users/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="视图" tabindex="-1"><a class="header-anchor" href="#视图"><span>视图</span></a></h2><h3 id="apiview" tabindex="-1"><a class="header-anchor" href="#apiview"><span>APIView</span></a></h3><p>继承django中的View然后在请求来的时候,新增了:免除csrf,请求封装,版本,认证,权限,限流的功能</p><p>APIView相当于drf框架中顶层的视图类</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">GenericAPIView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">GenericViewSet</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">,</span> ViewSetMixin<span class="token punctuation">)</span></span>
<span class="line">	<span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>GenericViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">pass</span>   </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="genericapiview" tabindex="-1"><a class="header-anchor" href="#genericapiview"><span>GenericAPIView</span></a></h3><p>继承APIView,在APIView的基础上又新增了一些功能:get_queryset, get_object等</p><p>实际开发过程中不会直接继承它,而是作为一个中间商,为子类提供了它的一些公共方法.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    serializer_class <span class="token operator">=</span> 序列化类</span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        queryset <span class="token operator">=</span> self<span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        ser <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将数据库查询,序列化类提取到类变量中,后期在提供公共方法get/post/put/delete等方法.让开发者只定义类变量,自动实现增删改查</p><h3 id="genericviewset" tabindex="-1"><a class="header-anchor" href="#genericviewset"><span>GenericViewSet</span></a></h3><p>该类中没有定义任何的代码,就是继承了ViewSetMixin和GenericAPIView,也就是说,该类的功能就是将继承的两个类的功能结合到一起了</p><ul><li>GenericAPIView:将数据库查询,序列化类提取到类变量中,便于后续处理</li><li>ViewSetMixin:将get/post/put/patch/delete等方法映射到list/create/retrieve/update/partial_update/destroy等方法中</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># urls.py</span></span>
<span class="line">path<span class="token punctuation">(</span><span class="token string">&#39;users/&#39;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;get&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;list&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;create&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">path<span class="token punctuation">(</span><span class="token string">&#39;users/&lt;int:pk&gt;&#39;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;get&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;retrieve&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;put&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;update&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;patch&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;partial_update&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;delete&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;destroy&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># views.py</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>GenericViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 认证, 权限, 限流</span></span>
<span class="line">    queryset <span class="token operator">=</span> models<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    serializer_class <span class="token operator">=</span> 序列化类</span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">list</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 查看所有数据列表</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 新增一条数据到数据库</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">retrieve</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 查询某一条数据</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">	</span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 更新数据</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">partial_update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 局部更新</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">destroy</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 删除数据</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,28)])])}const i=n(t,[["render",l]]),u=JSON.parse('{"path":"/django/35-drf%E6%A1%86%E6%9E%B6.html","title":"drf框架","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"序列化serializer","slug":"序列化serializer","link":"#序列化serializer","children":[{"level":3,"title":"序列化","slug":"序列化","link":"#序列化","children":[]},{"level":3,"title":"数据校验+序列化","slug":"数据校验-序列化","link":"#数据校验-序列化","children":[]}]},{"level":2,"title":"视图","slug":"视图","link":"#视图","children":[{"level":3,"title":"APIView","slug":"apiview","link":"#apiview","children":[]},{"level":3,"title":"GenericAPIView","slug":"genericapiview","link":"#genericapiview","children":[]},{"level":3,"title":"GenericViewSet","slug":"genericviewset","link":"#genericviewset","children":[]}]}],"git":{},"filePathRelative":"django/35-drf框架.md"}');export{i as comp,u as data};
