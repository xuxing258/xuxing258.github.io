import{_ as s,c as a,a as p,o as t}from"./app-oYpRxrJy.js";const e={};function l(i,n){return t(),a("div",null,[...n[0]||(n[0]=[p(`<h2 id="elasticsearch的介绍" tabindex="-1"><a class="header-anchor" href="#elasticsearch的介绍"><span>Elasticsearch的介绍</span></a></h2><p>Elasticsearch是一个基于Lucene的搜索引擎，业内简称ES。它提供了一个分布式多用户能力的全文搜索引擎，是用Java开发的，基于RESTful风格的api操作规范（即http请求接口）的分布式搜索引擎（或者说数据库） 并且能够达到准实时搜索</p><h3 id="什么是搜索引擎" tabindex="-1"><a class="header-anchor" href="#什么是搜索引擎"><span>什么是搜索引擎？</span></a></h3><p>比如百度：就是在任何场景下，找寻你想要的信息，用户输入想要搜索的关键词，然后期望找到这个关键词相关的信息</p><h3 id="用传统的数据库做搜索会怎么样" tabindex="-1"><a class="header-anchor" href="#用传统的数据库做搜索会怎么样"><span>用传统的数据库做搜索会怎么样？</span></a></h3><p>MySQL作为传统的关系型数据库，是当下Web应用开发中最流行的关系型数据库，我能否直接用MySQL实现搜索引擎？</p><p><img src="https://api2.mubu.com/v3/document_image/7637318_23609018-792d-4bf2-baf8-e8cc6aaa369d.png" alt=""></p><h4 id="基于数据库去做搜索会有以下几个缺点" tabindex="-1"><a class="header-anchor" href="#基于数据库去做搜索会有以下几个缺点"><span>基于数据库去做搜索会有以下几个缺点：</span></a></h4><ol><li>会进行全文扫描，必须<strong>逐行读取</strong> <code>数据库</code> 表中的每一行记录, 对于每一行，都要扫描对于字段的文本，看看里面有没有 “中国” 这两个字。并且开始一一比对文本值，如果指定的字段的文本过于长，扫描比对的时间就长，无法实现高效率</li><li>如果用户输入“python系全栈开发”，但由于中间干扰项，检索结果会受干扰</li></ol><h3 id="什么是全文检索" tabindex="-1"><a class="header-anchor" href="#什么是全文检索"><span>什么是全文检索?</span></a></h3><p>全文检索的核心在于倒排索引(拆分词条)</p><p><img src="https://api2.mubu.com/v3/document_image/7637318_2f2a5a0b-2d21-4077-d203-7472b4989578.png" alt=""></p><p>以上过程就是ES的全文检索，如果数据有100万条，倒排索引中未必扫描100万次，就算倒排索引扫描100万次，跟数据库相对，ES性能更高，因为数据库中要匹配是否包含关键词，ES的倒排索引只要比对词条是否一样</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 文档是es的称呼 与 mysql数据的一行是对应的</span></span>
<span class="line">文档<span class="token number">1</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token string">&quot;Python爬虫教程：快速抓取网页数据&quot;</span></span>
<span class="line">文档<span class="token number">2</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token string">&quot;Elasticsearch全文检索实战指南&quot;</span></span>
<span class="line">文档<span class="token number">3</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token string">&quot;Python与Elasticsearch构建搜索引擎&quot;</span></span>
<span class="line">    </span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;_index&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;web_pages&quot;</span><span class="token punctuation">,</span>   <span class="token operator">//</span> 相当于MySQL的表名</span>
<span class="line">  <span class="token string">&quot;_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>              <span class="token operator">//</span> 唯一ID <span class="token punctuation">(</span>类似MySQL的主键<span class="token punctuation">)</span></span>
<span class="line">  <span class="token string">&quot;_source&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>             <span class="token operator">//</span> 真实数据 <span class="token punctuation">(</span>相当于MySQL的一行<span class="token punctuation">)</span></span>
<span class="line">    <span class="token string">&quot;url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;https://example.com/python-tutorial&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Python爬虫入门教程&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;content&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;本文介绍如何用Python编写爬虫...&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;crawl_time&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2023-10-01&quot;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://api2.mubu.com/v3/document_image/7637318_57c1bdf8-f83e-43c5-be88-f6a12fc0301f.png" alt=""></p><h3 id="什么叫lunece" tabindex="-1"><a class="header-anchor" href="#什么叫lunece"><span>什么叫Lunece?</span></a></h3><p>Lucene是一个开源的信息检索工具包（类似于Java api），它包含了很多极优算法，索引结构、读写索引工具、排序索引等功能，而Elasticsearch底层是基于这些包，对其进行了扩展，提供了比Lucene更为丰富简洁的查询语言，可以非常方便的通过Elasticsearch的HTTP接口与底层Lucene进行逻辑交互。</p><p>一句话概括: Elasticsearch是Lucene面向企业搜索应用的扩展，极大的缩短研发周期，因为Elasticsearch是在它基础上扩展的应用程序,提供了简单易用的restful接口，可以直接拿来使用</p><h2 id="es和kibana的安装流程" tabindex="-1"><a class="header-anchor" href="#es和kibana的安装流程"><span>ES和kibana的安装流程</span></a></h2><p>安装过程中路径不能有任何中文及特殊字符</p><h3 id="elasticsearch8-2-3-安装" tabindex="-1"><a class="header-anchor" href="#elasticsearch8-2-3-安装"><span>ElasticSearch8.2.3 安装</span></a></h3><ul><li>软件包下载 <ul><li>https://www.elastic.co/cn/downloads/elasticsearch</li></ul></li><li>配置&amp;使用 <ul><li>es&amp;kibana都无需额外配置，下载解压后即可使用</li></ul></li><li>elasticSearch文件目录 <img src="https://api2.mubu.com/v3/document_image/7637318_4c1f51b2-ac41-4d61-a1e2-2e958c5889d5.png" alt=""></li><li>elasticSearch启动方式 上述目录中，进入bin目录，双击 elasticsearch.bat 脚本，即可启动 es数据库<img src="https://api2.mubu.com/v3/document_image/7637318_9b9136a5-e237-4c67-cc16-4d805165288c.png" alt=""></li><li>访问es数据库服务 <ul><li>启动成功且无异常后，网页访问 127.0.0.1:9200，即可看到如下页面,如若无法正常访问，请查看后面步骤<img src="https://api2.mubu.com/v3/document_image/7637318_f08de59a-a1b4-4739-e0f7-06cceabd7c15.png" alt=""></li></ul></li><li>elasticSearch异常&amp;解决 <ul><li>启动elasticSearch异常 <img src="https://api2.mubu.com/v3/document_image/7637318_23343cf2-552c-4d04-e210-fa89b1c2cac3.png" alt=""></li><li>原因：启动时会去更新地图的一些数据库，这里直接禁掉即可</li><li>解决：修改配置文件 config\\elasticsearch.yml 添加以下配置：</li><li>ingest.geoip.downloader.enabled: false <img src="https://api2.mubu.com/v3/document_image/7637318_95f7cc78-894d-4e84-9055-45b353378b07.png" alt=""></li></ul></li><li>访问服务异常 <ul><li>网页访问 127.0.0.1:9200 ，页面不加载，控制台报以下错误：received plaintext http traffic on an https channel, closing connection Netty4HttpChannel <img src="https://api2.mubu.com/v3/document_image/7637318_50a01169-7e00-4f9d-ed9e-df4f2a812395.png" alt=""></li><li>原因：开启了SSL认证 <ul><li>解决：查看 config\\elasticsearch.yml 修改以下内容为 false <img src="https://api2.mubu.com/v3/document_image/7637318_c8d18148-a6b6-442d-e6ed-da40199bfd5a.png" alt=""></li></ul></li></ul></li></ul><h3 id="kibana-es可视化工具-安装" tabindex="-1"><a class="header-anchor" href="#kibana-es可视化工具-安装"><span>Kibana[ES可视化工具] 安装</span></a></h3><ul><li>下载链接：https://www.elastic.co/cn/downloads/kibana <ul><li>kibana文件目录 <img src="https://api2.mubu.com/v3/document_image/7637318_92876c04-1bb3-42fc-e282-8f3609dacf03.png" alt=""></li></ul></li><li>kibana启动方式： <ul><li>与es数据库启动方式一直，进入对应的bin目录，双击 kibana.bat 脚本，即可启动 <img src="https://api2.mubu.com/v3/document_image/7637318_da48b1e6-1be8-4d7f-e770-9450e73a478a.png" alt=""></li></ul></li><li>访问kibana服务 <ul><li>网页访问 127.0.0.1:5601，即可看到类似如下页面 表示服务可用 <img src="https://api2.mubu.com/v3/document_image/7637318_b3db0993-838f-4800-d19f-360574f4e006.png" alt=""></li><li>进入kibana控制台面板 <img src="https://api2.mubu.com/v3/document_image/7637318_89a9f001-eca3-45b4-dc41-6845324ebce8.png" alt=""></li></ul></li></ul><h2 id="elasticsearch的基本结构" tabindex="-1"><a class="header-anchor" href="#elasticsearch的基本结构"><span>Elasticsearch的基本结构</span></a></h2><p>Elasticsearch是基于Lucene的全文检索库，本质也是存储数据，很多概念与我们的MySQL类似</p><h3 id="与mysql的对比关系" tabindex="-1"><a class="header-anchor" href="#与mysql的对比关系"><span>与mysql的对比关系：</span></a></h3><p>索引（indices）--------------------------------Databases 数据库</p><p>类型（type）-----------------------------Table 数据表</p><p>文档（Document）----------------Row 行（数据记录）</p><p>字段（Field）-------------------Columns 列 （字段名）</p><p>mappings ------------------- 数据结构</p><h5 id="详细说明" tabindex="-1"><a class="header-anchor" href="#详细说明"><span>详细说明：</span></a></h5><ul><li>索引（indices)：indices是index的复数，代表许多的索引,每个索引 （即数据库）的名字必须小写</li><li>类型（type）：ES是没有type的概念的，在document中，实际上将type作为一个document的field来存储，　所以一个index中的多个type是放在一起存储的，因此才有了type是模拟mysql中的table概念</li><li>文档（document）：存入索引库的原始数据。比如每一条商品信息，就是一个文档</li><li>字段（field）：文档中的属性(字段)</li></ul><h3 id="语法" tabindex="-1"><a class="header-anchor" href="#语法"><span>语法</span></a></h3><p>创建索引的请求格式：</p><ul><li>请求方式：PUT</li><li>请求路径：/索引库名</li><li>请求参数：json格式：</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 创建索引</span></span>
<span class="line">PUT <span class="token operator">/</span>hotel   <span class="token comment"># hotel是索引名 必须小写</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;mappings&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>   <span class="token comment"># 建立数据结构</span></span>
<span class="line">    <span class="token string">&quot;properties&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>  <span class="token comment"># 属性</span></span>
<span class="line">      <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;text&quot;</span>   <span class="token comment"># type指定字段类型</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;keyword&quot;</span>   <span class="token comment"># keyword不会被分词</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;price&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;double&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string">&quot;created&quot;</span><span class="token punctuation">:</span>  <span class="token punctuation">{</span> <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;date&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 写入文档数据</span></span>
<span class="line">POST <span class="token operator">/</span>hotel<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">001</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;酒店&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;三亚&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;price&quot;</span><span class="token punctuation">:</span><span class="token number">90</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 不指定ID</span></span>
<span class="line">POST <span class="token operator">/</span>hotel<span class="token operator">/</span>_doc</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;酒店2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;price&quot;</span><span class="token punctuation">:</span><span class="token number">90</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment">#  简单查询</span></span>
<span class="line">GET <span class="token operator">/</span>my_index<span class="token operator">/</span>_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;match&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;入门&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 根据文本字段搜索文档</span></span>
<span class="line">GET <span class="token operator">/</span>hotel<span class="token operator">/</span>_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;match&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;店&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Get请求可以帮我们查看索引信息，格式：GET /索引库名</span></span>
<span class="line">GET <span class="token operator">/</span>hotel<span class="token operator">/</span>_search</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2.3 根据文档_id 001检索文档 </span></span>
<span class="line">GET <span class="token operator">/</span>hotel<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">001</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 批量写入数据</span></span>
<span class="line">PUT <span class="token operator">/</span>hotel<span class="token operator">/</span>_bulk</span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;旅游酒店2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">:</span><span class="token number">109</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;index&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;_id&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;00344&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;中心酒店3&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;上海&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;price&quot;</span><span class="token punctuation">:</span><span class="token number">309</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#根据条件删除文档（数据）</span></span>
<span class="line">POST <span class="token operator">/</span>hotel<span class="token operator">/</span>_delete_by_query</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;term&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;value&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;上海&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 删除</span></span>
<span class="line">DELETE <span class="token operator">/</span>hotel<span class="token operator">/</span>_doc<span class="token operator">/</span><span class="token number">001</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="python-api实践操作" tabindex="-1"><a class="header-anchor" href="#python-api实践操作"><span>Python API实践操作</span></a></h2><p>以下代码的运行需要开启Elasticsearch服务</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 连接ES</span></span>
<span class="line"><span class="token keyword">from</span> elasticsearch <span class="token keyword">import</span> Elasticsearch</span>
<span class="line">es <span class="token operator">=</span> Elasticsearch<span class="token punctuation">(</span><span class="token string">&quot;http://localhost:9200&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2 创建索引</span></span>
<span class="line">py_index01 <span class="token operator">=</span> es<span class="token punctuation">.</span>indices<span class="token punctuation">.</span>create<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>ignore<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>py_index01<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3，插入数据</span></span>
<span class="line">body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;上海&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;hobbies&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;吃饭，睡觉&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">es<span class="token punctuation">.</span>index<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span> body <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3，插入第二条数据</span></span>
<span class="line">body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;王五&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;上海&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;hobbies&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;吃饭，跑步&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">es<span class="token punctuation">.</span>index<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span> body <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3，插入第三条数据</span></span>
<span class="line">body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Lucy&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;深圳&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;hobbies&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;reading,dancing&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">es<span class="token punctuation">.</span>index<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span> body <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4,match_all 查询所有</span></span>
<span class="line">query<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;match_all&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">r <span class="token operator">=</span> es<span class="token punctuation">.</span>search<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span>query <span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 5,根据term查询</span></span>
<span class="line"><span class="token comment"># term主要用于精确匹配哪些值</span></span>
<span class="line">query<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token string">&quot;term&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">           <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">20</span></span>
<span class="line">       <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">r <span class="token operator">=</span> es<span class="token punctuation">.</span>search<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span>query <span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 6 根据terms查询  # 指定多个字段值查询</span></span>
<span class="line">query<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token string">&quot;terms&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">           <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">]</span></span>
<span class="line">       <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">r <span class="token operator">=</span> es<span class="token punctuation">.</span>search<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span>query <span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 7，根据name</span></span>
<span class="line">query<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token string">&quot;terms&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">           <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&quot;lucy&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;李&quot;</span><span class="token punctuation">]</span></span>
<span class="line">       <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">r <span class="token operator">=</span> es<span class="token punctuation">.</span>search<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span>query <span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 8，multi_match    在match查询的基础上可同时搜索多个字段 在多个字段中同时查一个</span></span>
<span class="line">query<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;multi_match&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;reading&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;fields&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hobbies&quot;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">r <span class="token operator">=</span> es<span class="token punctuation">.</span>search<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span>query <span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 9，wildcard 查询 模糊查询</span></span>
<span class="line">query<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token string">&quot;wildcard&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">           <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;李*&quot;</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">r <span class="token operator">=</span> es<span class="token punctuation">.</span>search<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span>query <span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 10 regexp查询  正则查询</span></span>
<span class="line">query<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;query&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">       <span class="token string">&quot;regexp&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">           <span class="token string">&quot;hobbies&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;.*?anc.*&quot;</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">r <span class="token operator">=</span> es<span class="token punctuation">.</span>search<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>body <span class="token operator">=</span>query <span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 11 根据id删除数据</span></span>
<span class="line">r <span class="token operator">=</span> es<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;dc6hHZUB8E96iyK5Q7Oh&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3，插入第4条数据</span></span>
<span class="line">body <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;王五2号&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;city&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;上海&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;hobbies&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;吃饭，跑步&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">es<span class="token punctuation">.</span>index<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>body <span class="token operator">=</span> body <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 12 根据索引删除</span></span>
<span class="line">es<span class="token punctuation">.</span>indices<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">)</span></span>
<span class="line">ObjectApiResponse<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;acknowledged&#39;</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 13 检查索引是否存在</span></span>
<span class="line">es<span class="token punctuation">.</span>indices<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token string">&quot;py_index01&quot;</span><span class="token punctuation">,</span>ignore<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ik分词器" tabindex="-1"><a class="header-anchor" href="#ik分词器"><span>IK分词器</span></a></h2><h3 id="ik分词是什么" tabindex="-1"><a class="header-anchor" href="#ik分词是什么"><span>IK分词是什么？</span></a></h3><p>IK分词器是ES的一个插件，主要用于把我们要查询的数据拆分成一个个关键字，我们在搜索时，ElasticSearch会把数据进行分词，然后做匹配。默认的中文分词器会把每一个中文拆分，比如“李四在吃饭”，会拆分成“李”，“四”，“在”，“吃”，“饭”, 显然，这并不符合我们的要求，会影响我们最终的搜索结果，所以ik分词器（中文分词器）能解决这个问题。</p><h3 id="ik分词插件的安装" tabindex="-1"><a class="header-anchor" href="#ik分词插件的安装"><span>IK分词插件的安装</span></a></h3><p>下载链接： https://github.com/medcl/elasticsearch-analysis-ik/releases/tag/v8.2.3</p><p>注意：IK插件的版本一定要与ES和 Kibana的版本一致</p><p>将下载好的插件解压并放入elasticsearch服务路径中的plugins文件夹中</p><p><img src="https://api2.mubu.com/v3/document_image/7637318_e0d01bb6-f5ce-4538-b2d6-d612cf0ce7b5.png" alt=""></p><p><img src="https://api2.mubu.com/v3/document_image/7637318_53383ed7-a460-46ef-e8d4-53c578ccdec0.png" alt=""></p><p>然后将ES服务重启即可</p><h3 id="测试ik插件是否安装成功" tabindex="-1"><a class="header-anchor" href="#测试ik插件是否安装成功"><span>测试IK插件是否安装成功</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">GET _analyze</span>
<span class="line">{</span>
<span class="line">  &quot;analyzer&quot;: &quot;ik_smart&quot;, # 选择IK智能分词</span>
<span class="line">  &quot;text&quot;: &quot;张三在吃饭， 李四在睡觉&quot;</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,54)])])}const o=s(e,[["render",l]]),u=JSON.parse('{"path":"/spider/11-Elasticsearch.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Elasticsearch的介绍","slug":"elasticsearch的介绍","link":"#elasticsearch的介绍","children":[{"level":3,"title":"什么是搜索引擎？","slug":"什么是搜索引擎","link":"#什么是搜索引擎","children":[]},{"level":3,"title":"用传统的数据库做搜索会怎么样？","slug":"用传统的数据库做搜索会怎么样","link":"#用传统的数据库做搜索会怎么样","children":[]},{"level":3,"title":"什么是全文检索?","slug":"什么是全文检索","link":"#什么是全文检索","children":[]},{"level":3,"title":"什么叫Lunece?","slug":"什么叫lunece","link":"#什么叫lunece","children":[]}]},{"level":2,"title":"ES和kibana的安装流程","slug":"es和kibana的安装流程","link":"#es和kibana的安装流程","children":[{"level":3,"title":"ElasticSearch8.2.3 安装","slug":"elasticsearch8-2-3-安装","link":"#elasticsearch8-2-3-安装","children":[]},{"level":3,"title":"Kibana[ES可视化工具] 安装","slug":"kibana-es可视化工具-安装","link":"#kibana-es可视化工具-安装","children":[]}]},{"level":2,"title":"Elasticsearch的基本结构","slug":"elasticsearch的基本结构","link":"#elasticsearch的基本结构","children":[{"level":3,"title":"与mysql的对比关系：","slug":"与mysql的对比关系","link":"#与mysql的对比关系","children":[]},{"level":3,"title":"语法","slug":"语法","link":"#语法","children":[]}]},{"level":2,"title":"Python API实践操作","slug":"python-api实践操作","link":"#python-api实践操作","children":[]},{"level":2,"title":"IK分词器","slug":"ik分词器","link":"#ik分词器","children":[{"level":3,"title":"IK分词是什么？","slug":"ik分词是什么","link":"#ik分词是什么","children":[]},{"level":3,"title":"IK分词插件的安装","slug":"ik分词插件的安装","link":"#ik分词插件的安装","children":[]},{"level":3,"title":"测试IK插件是否安装成功","slug":"测试ik插件是否安装成功","link":"#测试ik插件是否安装成功","children":[]}]}],"git":{},"filePathRelative":"spider/11-Elasticsearch.md"}');export{o as comp,u as data};
