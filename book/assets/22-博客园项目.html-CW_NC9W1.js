import{_ as n,c as a,a as p,o as t}from"./app-BD3X-Yt7.js";const e={};function o(l,s){return t(),a("div",null,[...s[0]||(s[0]=[p(`<h1 id="博客园项目" tabindex="-1"><a class="header-anchor" href="#博客园项目"><span>博客园项目</span></a></h1><h2 id="登录功能" tabindex="-1"><a class="header-anchor" href="#登录功能"><span>登录功能</span></a></h2><h3 id="验证码" tabindex="-1"><a class="header-anchor" href="#验证码"><span>验证码</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># img标签的src属性</span></span>
<span class="line"><span class="token number">1.</span>图片路径</span>
<span class="line"><span class="token number">2</span><span class="token punctuation">.</span>url<span class="token punctuation">(</span>通过路由执行视图函数<span class="token punctuation">,</span>函数的返回值就是读取的图片的二进制数据<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">3.</span>图片的二进制数据</span>
<span class="line"></span>
<span class="line"><span class="token comment"># pillow模块</span></span>
<span class="line"><span class="token comment"># 需要通过pip install pillow进行下载</span></span>
<span class="line"><span class="token comment"># 镜像文件下载:pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ pillow</span></span>
<span class="line"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw<span class="token punctuation">,</span> ImageFont</span>
<span class="line"><span class="token comment"># Image:生成图片</span></span>
<span class="line"><span class="token comment"># ImageDraw:能够控制在图片上作画</span></span>
<span class="line"><span class="token comment"># ImageFont:控制字体样式</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_code</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 利用pillow模块生成图片</span></span>
<span class="line">    <span class="token comment"># new(&#39;RGB&#39;, (图片的宽, 图片的高), 图片的颜色)</span></span>
<span class="line">    image_obj <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">&#39;RGB&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;blue&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 将图片对象保存起来</span></span>
<span class="line">    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;xxx.png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;wb&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">        image_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&#39;png&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 再将图片读取出来</span></span>
<span class="line">    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;xxx.png&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;rb&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">        data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 图片读取比较麻烦,可以内存管理器模块</span></span>
<span class="line"><span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO</span>
<span class="line"><span class="token comment"># BytesIO:临时帮你存储数据,返回的数据是二进制格式</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># (0-255, 0-255, 0-255)</span></span>
<span class="line">    <span class="token keyword">return</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_code</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 利用pillow模块生成图片</span></span>
<span class="line">    <span class="token comment"># new(&#39;RGB&#39;, (图片的宽, 图片的高), 图片的颜色)</span></span>
<span class="line">    img_obj <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">&#39;RGB&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> get_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 利用内存管理器模块操作图片</span></span>
<span class="line">    <span class="token comment"># 生成内存管理器对象</span></span>
<span class="line">    io_obj <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># io_obj可以理解为文件操作中的f</span></span>
<span class="line">    img_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span>io_obj<span class="token punctuation">,</span> <span class="token string">&#39;png&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 保存图片到内存</span></span>
<span class="line">    data <span class="token operator">=</span> io_obj<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 读取内存中的图片数据</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 完整实现</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># (0-255, 0-255, 0-255)</span></span>
<span class="line">    <span class="token keyword">return</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_code</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 利用pillow模块生成图片</span></span>
<span class="line">    <span class="token comment"># new(&#39;RGB&#39;, (图片的宽, 图片的高), 图片的颜色)</span></span>
<span class="line">    img_obj <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">&#39;RGB&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> get_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    img_draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>img_obj<span class="token punctuation">)</span>  <span class="token comment"># 生成一个在图片上作画的笔</span></span>
<span class="line">    img_font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span><span class="token string">&#39;static/font/111.ttf&#39;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>  <span class="token comment"># truetype(字体样式, 字体大小)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 5位随机验证码  大写字母/小写字母/数字</span></span>
<span class="line">    code <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 大写字母</span></span>
<span class="line">        random_upper <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># chr(数字):将数字转换成ascii码中的字符</span></span>
<span class="line">        <span class="token comment"># 小写字母</span></span>
<span class="line">        random_lower <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        random_int <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 随机从上面的三种情况中选择一个</span></span>
<span class="line">        tem <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span>random_lower<span class="token punctuation">,</span> random_upper<span class="token punctuation">,</span> random_int<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 一个一个的字符写到图片上,这个位置是能控制的</span></span>
<span class="line">        <span class="token comment"># text((x坐标, y坐标), 字符, 颜色, 字体样式)</span></span>
<span class="line">        img_draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tem<span class="token punctuation">,</span> get_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img_font<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 将随机选择的一位字符添加到验证码中</span></span>
<span class="line">        code <span class="token operator">+=</span> tem</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 随机验证码需要再登录功能中进行校验:判断用户输入的验证码是否登录图片上的验证码</span></span>
<span class="line">    request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> code</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 利用内存管理器模块操作图片</span></span>
<span class="line">    <span class="token comment"># 生成内存管理器对象</span></span>
<span class="line">    io_obj <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># io_obj可以理解为文件操作中的f</span></span>
<span class="line">    img_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span>io_obj<span class="token punctuation">,</span> <span class="token string">&#39;png&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 保存图片到内存</span></span>
<span class="line">    data <span class="token operator">=</span> io_obj<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 读取内存中的图片数据</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>点击图片实现刷新</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line">    $<span class="token punctuation">(</span><span class="token string">&#39;#myimg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">//</span> 点击图片之后实现刷新<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>再次朝<span class="token operator">/</span>get_code<span class="token operator">/</span>发起请求</span>
<span class="line">        <span class="token operator">//</span> 先获取原来的src属性的值</span>
<span class="line">        let oldVal <span class="token operator">=</span> $<span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">.</span>attr<span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token operator">//</span> 在原来的基础上加上问号就可以再次发起请求</span>
<span class="line">        $<span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">.</span>attr<span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">,</span> oldVal<span class="token operator">+=</span><span class="token string">&#39;?&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="登录功能完整实现" tabindex="-1"><a class="header-anchor" href="#登录功能完整实现"><span>登录功能完整实现</span></a></h3><ul><li>urls</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">path<span class="token punctuation">(</span><span class="token string">&#39;login/&#39;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>login<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token comment"># 获取验证码的图片</span></span>
<span class="line">path<span class="token punctuation">(</span><span class="token string">&#39;get_code/&#39;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>get_code<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>views.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 针对ajax请求,都返回一个字典信息</span></span>
<span class="line">        back_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;msg&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">}</span></span>
<span class="line">        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        code <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 1.校验验证码是否正确</span></span>
<span class="line">        <span class="token comment"># 可以自己考虑一下要不要忽略大小写</span></span>
<span class="line">        <span class="token comment"># 如果要忽略:就全部转换成大写字母再进行比较</span></span>
<span class="line">        <span class="token keyword">if</span> code<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># 2.用户名是否存在密码是否正确</span></span>
<span class="line">            user_obj <span class="token operator">=</span> auth<span class="token punctuation">.</span>authenticate<span class="token punctuation">(</span>request<span class="token punctuation">,</span> username<span class="token operator">=</span>username<span class="token punctuation">,</span> password<span class="token operator">=</span>password<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> user_obj<span class="token punctuation">:</span></span>
<span class="line">                <span class="token comment"># 3.登录成功,保存用户登录状态</span></span>
<span class="line">                auth<span class="token punctuation">.</span>login<span class="token punctuation">(</span>request<span class="token punctuation">,</span> user_obj<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">                target_url <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;next&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 获取用户上次访问的页面</span></span>
<span class="line">                <span class="token keyword">if</span> target_url<span class="token punctuation">:</span></span>
<span class="line">                    back_dict<span class="token punctuation">[</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> target_url</span>
<span class="line">                <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                    back_dict<span class="token punctuation">[</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;/home/&#39;</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># 4.用户名不存在或者密码错误</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                back_dict<span class="token punctuation">[</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2000</span></span>
<span class="line">                back_dict<span class="token punctuation">[</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;用户名或密码错误&#39;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            back_dict<span class="token punctuation">[</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3000</span></span>
<span class="line">            back_dict<span class="token punctuation">[</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;验证码错误&#39;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>back_dict<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;login.html&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_color</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 获取随机的颜色</span></span>
<span class="line">    <span class="token comment"># (0-255, 0-255, 0-255)</span></span>
<span class="line">    <span class="token keyword">return</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_code</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 利用pillow模块生成图片</span></span>
<span class="line">    <span class="token comment"># new(&#39;RGB&#39;, (图片的宽, 图片的高), 图片的颜色)</span></span>
<span class="line">    img_obj <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">&#39;RGB&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span> get_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    img_draw <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>img_obj<span class="token punctuation">)</span>  <span class="token comment"># 生成一个在图片上作画的笔</span></span>
<span class="line">    img_font <span class="token operator">=</span> ImageFont<span class="token punctuation">.</span>truetype<span class="token punctuation">(</span><span class="token string">&#39;static/font/111.ttf&#39;</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>  <span class="token comment"># truetype(字体样式, 字体大小)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 5位随机验证码  大写字母/小写字母/数字</span></span>
<span class="line">    code <span class="token operator">=</span> <span class="token string">&#39;&#39;</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 大写字母</span></span>
<span class="line">        random_upper <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># chr(数字):将数字转换成ascii码中的字符</span></span>
<span class="line">        <span class="token comment"># 小写字母</span></span>
<span class="line">        random_lower <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        random_int <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 随机从上面的三种情况中选择一个</span></span>
<span class="line">        tem <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span>random_lower<span class="token punctuation">,</span> random_upper<span class="token punctuation">,</span> random_int<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 一个一个的字符写到图片上,这个位置是能控制的</span></span>
<span class="line">        <span class="token comment"># text((x坐标, y坐标), 字符, 颜色, 字体样式)</span></span>
<span class="line">        img_draw<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tem<span class="token punctuation">,</span> get_color<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img_font<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 将随机选择的一位字符添加到验证码中</span></span>
<span class="line">        code <span class="token operator">+=</span> tem</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 随机验证码需要再登录功能中进行校验:判断用户输入的验证码是否登录图片上的验证码</span></span>
<span class="line">    request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> code</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 利用内存管理器模块操作图片</span></span>
<span class="line">    <span class="token comment"># 生成内存管理器对象</span></span>
<span class="line">    io_obj <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># io_obj可以理解为文件操作中的f</span></span>
<span class="line">    img_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span>io_obj<span class="token punctuation">,</span> <span class="token string">&#39;png&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 保存图片到内存</span></span>
<span class="line">    data <span class="token operator">=</span> io_obj<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 读取内存中的图片数据</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>login.html</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>head<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Title<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token punctuation">{</span><span class="token operator">%</span> load static <span class="token operator">%</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">&quot;stylesheet&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;{% static &#39;bootstrap-3.4.1-dist/css/bootstrap.min.css&#39; %}&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;{% static &#39;js/jquery-3.7.1.min.js&#39; %}&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;{% static &#39;bootstrap-3.4.1-dist/js/bootstrap.min.js&#39; %}&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;container-fluid&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;row&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-md-8 col-md-offset-2&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>h1 <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;text-center&quot;</span><span class="token operator">&gt;</span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;username&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span><span class="token operator">&gt;</span>密码<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;code&quot;</span><span class="token operator">&gt;</span>验证码<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;row&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-md-6&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;code&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;code&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-md-6&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;/get_code/&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;&quot;</span> width<span class="token operator">=</span><span class="token string">&quot;440px&quot;</span> height<span class="token operator">=</span><span class="token string">&quot;35px&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;myimg&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;clearfix&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;button&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn btn-primary pull-right&quot;</span> value<span class="token operator">=</span><span class="token string">&quot;登录&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;commit&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">            </span>
<span class="line">            <span class="token operator">&lt;</span>span <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;msg&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;color: red&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;pull-right&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line">    $<span class="token punctuation">(</span><span class="token string">&#39;#myimg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">//</span> 点击图片之后实现刷新<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>再次朝<span class="token operator">/</span>get_code<span class="token operator">/</span>发起请求</span>
<span class="line">        <span class="token operator">//</span> 先获取原来的src属性的值</span>
<span class="line">        let oldVal <span class="token operator">=</span> $<span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">.</span>attr<span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token operator">//</span> 在原来的基础上加上问号就可以再次发起请求</span>
<span class="line">        $<span class="token punctuation">(</span>this<span class="token punctuation">)</span><span class="token punctuation">.</span>attr<span class="token punctuation">(</span><span class="token string">&#39;src&#39;</span><span class="token punctuation">,</span> oldVal<span class="token operator">+=</span><span class="token string">&#39;?&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token operator">//</span> 点击登录按钮朝后端提交ajax请求</span>
<span class="line">    $<span class="token punctuation">(</span><span class="token string">&#39;#commit&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        $<span class="token punctuation">.</span>ajax<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            url<span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token builtin">type</span><span class="token punctuation">:</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            data<span class="token punctuation">:</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token string">&#39;username&#39;</span><span class="token punctuation">:</span> $<span class="token punctuation">(</span><span class="token string">&#39;#username&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;password&#39;</span><span class="token punctuation">:</span> $<span class="token punctuation">(</span><span class="token string">&#39;#password&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> $<span class="token punctuation">(</span><span class="token string">&#39;#code&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                csrfmiddlewaretoken<span class="token punctuation">:</span> <span class="token string">&#39;{{ csrf_token }}&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            success<span class="token punctuation">:</span> function <span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>code<span class="token operator">==</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token operator">//</span> 跳转到指定地址</span>
<span class="line">                    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> args<span class="token punctuation">.</span>url</span>
<span class="line">                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                    <span class="token operator">//</span> 只会有一种报错情况</span>
<span class="line">                    $<span class="token punctuation">(</span><span class="token string">&#39;#msg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">(</span>args<span class="token punctuation">.</span>msg<span class="token punctuation">)</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="首页" tabindex="-1"><a class="header-anchor" href="#首页"><span>首页</span></a></h2><h3 id="导航条" tabindex="-1"><a class="header-anchor" href="#导航条"><span>导航条</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token operator">&lt;</span>nav <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;navbar navbar-default&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;container-fluid&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> Brand <span class="token keyword">and</span> toggle get grouped <span class="token keyword">for</span> better mobile display <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;navbar-header&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>button <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;button&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;navbar-toggle collapsed&quot;</span> data<span class="token operator">-</span>toggle<span class="token operator">=</span><span class="token string">&quot;collapse&quot;</span> data<span class="token operator">-</span>target<span class="token operator">=</span><span class="token string">&quot;#bs-example-navbar-collapse-1&quot;</span> aria<span class="token operator">-</span>expanded<span class="token operator">=</span><span class="token string">&quot;false&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;sr-only&quot;</span><span class="token operator">&gt;</span>Toggle navigation<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;icon-bar&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;icon-bar&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;icon-bar&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;navbar-brand&quot;</span> href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>bbs<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line">    <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> Collect the nav links<span class="token punctuation">,</span> forms<span class="token punctuation">,</span> <span class="token keyword">and</span> other content <span class="token keyword">for</span> toggling <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;collapse navbar-collapse&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;bs-example-navbar-collapse-1&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;nav navbar-nav&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;active&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>Link <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;sr-only&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>current<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>Link<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line">      <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;nav navbar-nav navbar-right&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>is_authenticated <span class="token operator">%</span><span class="token punctuation">}</span></span>
<span class="line">            <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>用户登录展示用户名和更多操作<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line">          	    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dropdown&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                  <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dropdown-toggle&quot;</span> data<span class="token operator">-</span>toggle<span class="token operator">=</span><span class="token string">&quot;dropdown&quot;</span> role<span class="token operator">=</span><span class="token string">&quot;button&quot;</span> aria<span class="token operator">-</span>haspopup<span class="token operator">=</span><span class="token string">&quot;true&quot;</span> aria<span class="token operator">-</span>expanded<span class="token operator">=</span><span class="token string">&quot;false&quot;</span><span class="token operator">&gt;</span>更多操作 <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;caret&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span></span>
<span class="line">                  <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;dropdown-menu&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>修改密码<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>修改头像<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span><span class="token operator">&gt;</span>后台管理<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>li role<span class="token operator">=</span><span class="token string">&quot;separator&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;divider&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;/logout/&quot;</span><span class="token operator">&gt;</span>退出登录<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">              </span>
<span class="line">          <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">else</span> <span class="token operator">%</span><span class="token punctuation">}</span> <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>用户未登录展示登录和注册<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;/login/&quot;</span><span class="token operator">&gt;</span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">                <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;/register/&quot;</span><span class="token operator">&gt;</span>注册<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span></span>
<span class="line">          <span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>navbar<span class="token operator">-</span>collapse <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> <span class="token operator">/</span><span class="token punctuation">.</span>container<span class="token operator">-</span>fluid <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>nav<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="退出登录" tabindex="-1"><a class="header-anchor" href="#退出登录"><span>退出登录</span></a></h3><p>因为很多的功能需要用户登录才能实现</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> login_required</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 全局配置登录路由:settings.py中</span></span>
<span class="line">LOGIN_URL <span class="token operator">=</span> <span class="token string">&#39;/login/&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>urls.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">path<span class="token punctuation">(</span><span class="token string">&#39;logout/&#39;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>logout<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>views.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token decorator annotation punctuation">@login_required</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    auth<span class="token punctuation">.</span>logout<span class="token punctuation">(</span>request<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/home/&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改密码" tabindex="-1"><a class="header-anchor" href="#修改密码"><span>修改密码</span></a></h3><ul><li>模态框使用</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> Large modal <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">&quot;#&quot;</span> data<span class="token operator">-</span>toggle<span class="token operator">=</span><span class="token string">&quot;modal&quot;</span> data<span class="token operator">-</span>target<span class="token operator">=</span><span class="token string">&quot;.bs-example-modal-lg&quot;</span><span class="token operator">&gt;</span>修改密码<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span></span>
<span class="line"></span>
<span class="line"><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>这个模态框写在任何地方都可以<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;modal fade bs-example-modal-lg&quot;</span> tabindex<span class="token operator">=</span><span class="token string">&quot;-1&quot;</span> role<span class="token operator">=</span><span class="token string">&quot;dialog&quot;</span> aria<span class="token operator">-</span>labelledby<span class="token operator">=</span><span class="token string">&quot;myLargeModalLabel&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;modal-dialog modal-lg&quot;</span> role<span class="token operator">=</span><span class="token string">&quot;document&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;modal-content&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span>h1 <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;text-center&quot;</span><span class="token operator">&gt;</span>修改密码<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;row&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;col-md-8 col-md-offset-2&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                          <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;username&quot;</span><span class="token operator">&gt;</span>用户名<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span></span>
<span class="line">                          <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;text&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;username&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span></span>
<span class="line">                                 <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;username&quot;</span> disabled value<span class="token operator">=</span><span class="token string">&quot;{{ request.user.username }}&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                          <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;old_password&quot;</span><span class="token operator">&gt;</span>旧密码<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span></span>
<span class="line">                          <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;old_password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;old_password&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                          <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;new_password&quot;</span><span class="token operator">&gt;</span>新密码<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span></span>
<span class="line">                          <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;new_password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;new_password&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-group&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                          <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;re_password&quot;</span><span class="token operator">&gt;</span>确认密码<span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span></span>
<span class="line">                          <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;password&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;re_password&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;re_password&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;form-control&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;modal-footer&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>button <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;button&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn btn-default&quot;</span> data<span class="token operator">-</span>dismiss<span class="token operator">=</span><span class="token string">&quot;modal&quot;</span><span class="token operator">&gt;</span>取消<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span>
<span class="line">                        <span class="token operator">&lt;</span>button <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;button&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;btn btn-primary&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;set_password&quot;</span><span class="token operator">&gt;</span>修改<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span></span>
<span class="line">                      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">                  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">              <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>点击修改</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span></span>
<span class="line">    $<span class="token punctuation">(</span><span class="token string">&#39;#set_password&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        $<span class="token punctuation">.</span>ajax<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">            url<span class="token punctuation">:</span> <span class="token string">&#39;/set_password/&#39;</span><span class="token punctuation">,</span>  <span class="token operator">//</span> 朝指定地址提交</span>
<span class="line">            <span class="token builtin">type</span><span class="token punctuation">:</span> <span class="token string">&#39;post&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            data<span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string">&#39;old_password&#39;</span><span class="token punctuation">:</span> $<span class="token punctuation">(</span><span class="token string">&#39;#old_password&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;new_password&#39;</span><span class="token punctuation">:</span> $<span class="token punctuation">(</span><span class="token string">&#39;#new_password&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;re_password&#39;</span><span class="token punctuation">:</span> $<span class="token punctuation">(</span><span class="token string">&#39;#re_password&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                csrfmiddlewaretoken<span class="token punctuation">:</span> <span class="token string">&#39;{{ csrf_token }}&#39;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            success<span class="token punctuation">:</span> function <span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                </span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>urls.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">path<span class="token punctuation">(</span><span class="token string">&#39;set_password/&#39;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>set_password<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>views.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token decorator annotation punctuation">@login_required</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">set_password</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 针对ajax请求,都返回一个字典信息</span></span>
<span class="line">        back_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;msg&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">}</span></span>
<span class="line">        old_password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;old_password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        new_password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;new_password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        re_password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;re_password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 1.判断旧密码是否正确</span></span>
<span class="line">        is_right <span class="token operator">=</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>check_password<span class="token punctuation">(</span>old_password<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> is_right<span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 2.判断两次密码是否一致</span></span>
<span class="line">            <span class="token keyword">if</span> new_password <span class="token operator">==</span> re_password<span class="token punctuation">:</span></span>
<span class="line">                <span class="token comment"># 3.修改密码</span></span>
<span class="line">                request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>set_password<span class="token punctuation">(</span>new_password<span class="token punctuation">)</span></span>
<span class="line">                request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                back_dict<span class="token punctuation">[</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;修改成功&#39;</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                back_dict<span class="token punctuation">[</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1001</span></span>
<span class="line">                back_dict<span class="token punctuation">[</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;两次密码不一致&#39;</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            back_dict<span class="token punctuation">[</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1002</span></span>
<span class="line">            back_dict<span class="token punctuation">[</span><span class="token string">&#39;msg&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;两次密码不一致&#39;</span></span>
<span class="line">        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>back_dict<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,33)])])}const i=n(e,[["render",o]]),r=JSON.parse('{"path":"/django/22-%E5%8D%9A%E5%AE%A2%E5%9B%AD%E9%A1%B9%E7%9B%AE.html","title":"博客园项目","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"登录功能","slug":"登录功能","link":"#登录功能","children":[{"level":3,"title":"验证码","slug":"验证码","link":"#验证码","children":[]},{"level":3,"title":"登录功能完整实现","slug":"登录功能完整实现","link":"#登录功能完整实现","children":[]}]},{"level":2,"title":"首页","slug":"首页","link":"#首页","children":[{"level":3,"title":"导航条","slug":"导航条","link":"#导航条","children":[]},{"level":3,"title":"退出登录","slug":"退出登录","link":"#退出登录","children":[]},{"level":3,"title":"修改密码","slug":"修改密码","link":"#修改密码","children":[]}]}],"git":{},"filePathRelative":"django/22-博客园项目.md"}');export{i as comp,r as data};
