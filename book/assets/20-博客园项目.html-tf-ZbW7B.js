import{_ as s,c as a,a as p,o as e}from"./app-BtRpJXvK.js";const l={};function t(o,n){return e(),a("div",null,[...n[0]||(n[0]=[p(`<h1 id="博客园项目" tabindex="-1"><a class="header-anchor" href="#博客园项目"><span>博客园项目</span></a></h1><h2 id="表设计" tabindex="-1"><a class="header-anchor" href="#表设计"><span>表设计</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># bbs</span></span>
<span class="line"><span class="token number">1.</span>用户表</span>
<span class="line">	继承AbstractUser</span>
<span class="line">    扩展<span class="token punctuation">:</span></span>
<span class="line">        avatar<span class="token punctuation">:</span>头像</span>
<span class="line">        phone<span class="token punctuation">:</span>电话号码</span>
<span class="line">    外键字段<span class="token punctuation">:</span></span>
<span class="line">        一对一个人站点</span>
<span class="line">        </span>
<span class="line"></span>
<span class="line"><span class="token number">2.</span>个人站点表<span class="token punctuation">(</span>用户首页<span class="token punctuation">)</span></span>
<span class="line">	site_name<span class="token punctuation">:</span>站点名称<span class="token punctuation">(</span>用来展示看的<span class="token punctuation">)</span></span>
<span class="line">    site_title<span class="token punctuation">:</span>个性签名</span>
<span class="line">    site_theme<span class="token punctuation">:</span>站点样式<span class="token punctuation">(</span>存放css文件<span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line"></span>
<span class="line"><span class="token number">3.</span>文章标签</span>
<span class="line">	name<span class="token punctuation">:</span>标签名</span>
<span class="line">    外键字段<span class="token punctuation">:</span></span>
<span class="line">        一对多个人站点</span>
<span class="line">    </span>
<span class="line"></span>
<span class="line"><span class="token number">4.</span>文章分类</span>
<span class="line">	name<span class="token punctuation">:</span>分类名</span>
<span class="line">    外键字段<span class="token punctuation">:</span></span>
<span class="line">        一对多个人站点</span>
<span class="line"></span>
<span class="line"><span class="token number">5.</span>文章表</span>
<span class="line">	title<span class="token punctuation">:</span>文章标题</span>
<span class="line">    desc<span class="token punctuation">:</span>文章简介</span>
<span class="line">    content<span class="token punctuation">:</span>文章内容</span>
<span class="line">    create_time<span class="token punctuation">:</span>创建时间</span>
<span class="line">       </span>
<span class="line">    数据库优化三个字段<span class="token punctuation">:</span>虽然下面三个字段可以从其他表跨表查询计算得出<span class="token punctuation">,</span>但是查询频率比较高</span>
<span class="line">        生成三个普通字段<span class="token punctuation">,</span>之后点赞点踩评论更新的时候只需要同步给这三个字段更新即可</span>
<span class="line">    up_num<span class="token punctuation">:</span>点赞数</span>
<span class="line">    down_num<span class="token punctuation">:</span>点踩数</span>
<span class="line">    comment_num<span class="token punctuation">:</span>评论数</span>
<span class="line">        </span>
<span class="line">    外键字段<span class="token punctuation">:</span></span>
<span class="line">        一对多个人站点表</span>
<span class="line">        一对多分类</span>
<span class="line">        多对多标签</span>
<span class="line"></span>
<span class="line">        </span>
<span class="line"><span class="token number">6.</span>点赞点踩表</span>
<span class="line">	哪个用户给哪篇文章点了赞还是点了踩</span>
<span class="line">    user<span class="token punctuation">:</span>哪个用户</span>
<span class="line">    article<span class="token punctuation">:</span>哪个文章</span>
<span class="line">    is_up<span class="token punctuation">:</span><span class="token number">1</span>表示点赞<span class="token number">0</span>表示点踩</span>
<span class="line">        </span>
<span class="line"></span>
<span class="line"><span class="token number">7.</span>文章评论表</span>
<span class="line">	哪个用户给哪篇文章评论了什么内容</span>
<span class="line">    user<span class="token punctuation">:</span>哪个用户</span>
<span class="line">    article<span class="token punctuation">:</span>哪篇文章</span>
<span class="line">    content<span class="token punctuation">:</span>评论内容</span>
<span class="line">    comment_time<span class="token punctuation">:</span>评论时间</span>
<span class="line">     </span>
<span class="line">   	外键字段<span class="token punctuation">:</span><span class="token punctuation">(</span>自关联<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># self表示关联自己</span></span>
<span class="line">        parent <span class="token operator">=</span> ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;self&#39;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">       </span>
<span class="line">    </span>
<span class="line">根评论和子评论概念</span>
<span class="line">根评论<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span> parent_id<span class="token operator">=</span>null</span>
<span class="line">	子评论<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span> parent_id<span class="token operator">=</span><span class="token number">1</span></span>
<span class="line">	子评论<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span> parent_id<span class="token operator">=</span><span class="token number">1</span></span>
<span class="line"></span>
<span class="line">根评论<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">4</span> parent_id<span class="token operator">=</span>null</span>
<span class="line">	子评论<span class="token builtin">id</span><span class="token operator">=</span><span class="token number">5</span>  parent_id<span class="token operator">=</span><span class="token number">4</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="模型类" tabindex="-1"><a class="header-anchor" href="#模型类"><span>模型类</span></a></h2><ul><li>settings.py中连接mysql数据库</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 更改数据库连接</span></span>
<span class="line">DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;default&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&#39;ENGINE&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;django.db.backends.mysql&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;NAME&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;bbs&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;USER&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;PASSWORD&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;HOST&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;PORT&#39;</span><span class="token punctuation">:</span> <span class="token number">3306</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;CHARSET&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;utf8mb4&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 因为手动指定了用户表,需要表明</span></span>
<span class="line">AUTH_USER_MODEL <span class="token operator">=</span> <span class="token string">&#39;app01.UserInfo&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>models.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AbstractUser</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Delete</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    is_delete <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;是否删除&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        abstract <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 用户表</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>AbstractUser<span class="token punctuation">,</span> Delete<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># null = True:对于数据库可以为空, blank=True:对于后台管理可以为空</span></span>
<span class="line">    phone <span class="token operator">=</span> models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;手机号&#39;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 保存一个文件对象,能够自动写入到upload_to指定的地址中</span></span>
<span class="line">    avatar <span class="token operator">=</span> models<span class="token punctuation">.</span>FileField<span class="token punctuation">(</span>upload_to<span class="token operator">=</span><span class="token string">&#39;avatar/&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                              default<span class="token operator">=</span><span class="token string">&#39;avatar/default.png&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                              verbose_name<span class="token operator">=</span><span class="token string">&#39;用户头像&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    create_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 外键字段</span></span>
<span class="line">    blog <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Blog&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 个人站点表</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Blog</span><span class="token punctuation">(</span>Delete<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    site_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;站点名称&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    site_title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;站点标题&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    site_theme <span class="token operator">=</span> models<span class="token punctuation">.</span>FileField<span class="token punctuation">(</span>upload_to<span class="token operator">=</span><span class="token string">&#39;site_theme/&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;站点样式&#39;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 标签表</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Tag</span><span class="token punctuation">(</span>Delete<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;标签名&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 外键字段:一对多个人站点</span></span>
<span class="line">    blog <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Blog&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 分类表</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Category</span><span class="token punctuation">(</span>Delete<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;分类名&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 外键字段:一对多个人站点</span></span>
<span class="line">    blog <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Blog&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 文章表</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Article</span><span class="token punctuation">(</span>Delete<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;文章标题&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    desc <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;文章简介&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    content <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;文章内容&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    create_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 数据库优化三个字段</span></span>
<span class="line">    up_num <span class="token operator">=</span> models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;点赞数&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    down_num <span class="token operator">=</span> models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;点踩数&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    comment_num <span class="token operator">=</span> models<span class="token punctuation">.</span>BigIntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;评论数&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 外键字段</span></span>
<span class="line">    <span class="token comment"># 一对多个人站点</span></span>
<span class="line">    blog <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Blog&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 一对多分类</span></span>
<span class="line">    category <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Category&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 多对多标签</span></span>
<span class="line">    tags <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Tag&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 点赞点踩表</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UpAndDown</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;UserInfo&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span></span>
<span class="line">    article <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Article&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span></span>
<span class="line">    is_up <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 1表示点赞,0表示点踩</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 评论表</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Comment</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;UserInfo&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span></span>
<span class="line">    article <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Article&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span></span>
<span class="line">    content <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;评论内容&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    comment_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;评论时间&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 自关联</span></span>
<span class="line">    parent <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;self&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>数据库迁移</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">python manage<span class="token punctuation">.</span>py makemigrations</span>
<span class="line">python manage<span class="token punctuation">.</span>py migrate</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="注册" tabindex="-1"><a class="header-anchor" href="#注册"><span>注册</span></a></h2><h3 id="forms组件" tabindex="-1"><a class="header-anchor" href="#forms组件"><span>forms组件</span></a></h3><p>因为我后续不会再写其他的forms组件,所以就在应用文件夹中创建一个py文件写入注册相关的forms组件</p><ul><li>regform.py</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 注册相关的forms组件</span></span>
<span class="line"><span class="token keyword">from</span> django <span class="token keyword">import</span> forms</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> RegexValidator</span>
<span class="line"><span class="token keyword">from</span> app01 <span class="token keyword">import</span> models</span>
<span class="line"><span class="token keyword">import</span> re</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">RegForm</span><span class="token punctuation">(</span>forms<span class="token punctuation">.</span>Form<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    username <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> min_length<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;用户名&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                               error_messages<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">                                   <span class="token string">&#39;max_length&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;用户最大8位&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                   <span class="token string">&#39;min_length&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;用户名最少4位&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                   <span class="token string">&#39;required&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;用户名不能为空&#39;</span></span>
<span class="line">                               <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    password <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;密码&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                               error_messages<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">                                   <span class="token string">&#39;max_length&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;密码最大16位&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                   <span class="token string">&#39;min_length&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;密码最少6位&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                   <span class="token string">&#39;required&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;密码不能为空&#39;</span></span>
<span class="line">                               <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    confirm_password <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> min_length<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&#39;确认密码&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                       error_messages<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">                                           <span class="token string">&#39;max_length&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;确认密码最大16位&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                           <span class="token string">&#39;min_length&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;确认密码最少6位&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                           <span class="token string">&#39;required&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;确认密码不能为空&#39;</span></span>
<span class="line">                                       <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    email <span class="token operator">=</span> forms<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;邮箱&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                             error_messages<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="line">                                 <span class="token string">&#39;invalid&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;邮箱格式不正确&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                 <span class="token string">&#39;required&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;邮箱不能为空&#39;</span></span>
<span class="line">                             <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    phone <span class="token operator">=</span> forms<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;手机号&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                            error_messages<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&#39;required&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;手机号不能为空&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                            validators<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="line">                                        RegexValidator<span class="token punctuation">(</span><span class="token string">&#39;\\d+&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;请输入数字&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">                                        RegexValidator<span class="token punctuation">(</span><span class="token string">&#39;1[3-9]\\d{9}&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;请输入正确的手机号&#39;</span><span class="token punctuation">)</span></span>
<span class="line">                            <span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 局部钩子:校验用户名是否存在</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">clean_username</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        username <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>username<span class="token operator">=</span>username<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> user_obj<span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>add_error<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;用户名已存在&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> username</span>
<span class="line"></span>
<span class="line">    <span class="token comment"># # 钩子函数:判断手机号是否符合规则</span></span>
<span class="line">    <span class="token comment"># def clean_phone(self):</span></span>
<span class="line">    <span class="token comment">#     phone = self.cleaned_data.get(&#39;phone&#39;)</span></span>
<span class="line">    <span class="token comment">#     # re.match(正则表达式, 要匹配的字符)</span></span>
<span class="line">    <span class="token comment">#     if not re.match(&#39;\\d+&#39;, phone):</span></span>
<span class="line">    <span class="token comment">#         self.add_error(&#39;phone&#39;, &#39;请输入数字&#39;)</span></span>
<span class="line">    <span class="token comment">#     if not re.match(&#39;1[3-9]\\d{9}&#39;, phone):</span></span>
<span class="line">    <span class="token comment">#         self.add_error(&#39;phone&#39;,&#39;请输入正确格式的手机号&#39;)</span></span>
<span class="line">    <span class="token comment">#     return phone</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 全局钩子:校验两次密码是否一致</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">clean</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        password <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        confirm_password <span class="token operator">=</span> self<span class="token punctuation">.</span>cleaned_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;confirm_password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> password <span class="token operator">!=</span> confirm_password<span class="token punctuation">:</span>  <span class="token comment"># 两次密码不一致</span></span>
<span class="line">            self<span class="token punctuation">.</span>add_error<span class="token punctuation">(</span><span class="token string">&#39;confirm_password&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;两次密码不一致&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>cleaned_data</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="头像功能" tabindex="-1"><a class="header-anchor" href="#头像功能"><span>头像功能</span></a></h3><p>通过点击头像的img标签就能弹开选择头像的文件框</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">因为label标签绑定<span class="token builtin">input</span>框之后<span class="token punctuation">,</span>点击label标签就会自动聚焦到绑定的<span class="token builtin">input</span>框<span class="token punctuation">(</span>点击<span class="token punctuation">)</span></span>
<span class="line">子标签会拥用父标签的事件<span class="token punctuation">,</span>所以将img标签放在label标签内部之后<span class="token punctuation">.</span>那么点击img标签就会自动聚焦到这个label绑定的<span class="token builtin">input</span>框中</span>
<span class="line"></span>
<span class="line"><span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;myfile&quot;</span><span class="token operator">&gt;</span>头像</span>
<span class="line">	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span></span>
<span class="line">		<span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">&quot;{% static &#39;images/default.png&#39; %}&quot;</span> alt<span class="token operator">=</span><span class="token string">&quot;&quot;</span> width<span class="token operator">=</span><span class="token string">&quot;200px&quot;</span><span class="token operator">&gt;</span></span>
<span class="line">	<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span></span>
<span class="line"><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span></span>
<span class="line">                    </span>
<span class="line"><span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">&quot;file&quot;</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">&quot;myfile&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;avatar&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;display:none;&quot;</span><span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>怎么实现选择完图片之后,img标签内容变成选择的图片</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span></span>
<span class="line">	img标签看到图片是通过src属性的值实现的<span class="token punctuation">,</span>src属性的值<span class="token punctuation">:</span></span>
<span class="line">		<span class="token number">1.</span>图片地址</span>
<span class="line">        <span class="token number">2.</span>路由<span class="token punctuation">(</span>如果是自己服务器写的路由<span class="token punctuation">,</span>执行的视图函数返回值也是图片的二进制数据<span class="token punctuation">)</span></span>
<span class="line">        <span class="token number">3.</span>图片的二进制数据</span>
<span class="line"><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,20)])])}const i=s(l,[["render",t]]),u=JSON.parse('{"path":"/django/20-%E5%8D%9A%E5%AE%A2%E5%9B%AD%E9%A1%B9%E7%9B%AE.html","title":"博客园项目","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"表设计","slug":"表设计","link":"#表设计","children":[]},{"level":2,"title":"模型类","slug":"模型类","link":"#模型类","children":[]},{"level":2,"title":"注册","slug":"注册","link":"#注册","children":[{"level":3,"title":"forms组件","slug":"forms组件","link":"#forms组件","children":[]},{"level":3,"title":"头像功能","slug":"头像功能","link":"#头像功能","children":[]}]}],"git":{},"filePathRelative":"django/20-博客园项目.md"}');export{i as comp,u as data};
