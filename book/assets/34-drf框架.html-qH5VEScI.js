import{_ as n,c as a,a as p,o as e}from"./app-D_gKCYhm.js";const t={};function l(o,s){return e(),a("div",null,[...s[0]||(s[0]=[p(`<h1 id="drf框架" tabindex="-1"><a class="header-anchor" href="#drf框架"><span>drf框架</span></a></h1><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 请求封装</span></span>
<span class="line">request<span class="token punctuation">.</span>query_params<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>获取get请求传递的数据</span>
<span class="line">request<span class="token punctuation">.</span>data<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>获取传递的json格式数据</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 认证--&gt;判断用户是否登录</span></span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> BaseAuthentication</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> AuthenticationFailed</span>
<span class="line"></span>
<span class="line">登录类<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>登录成功之后获取token</span>
<span class="line">登录认证类<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>重写authenticate方法<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>登录成功返回user_obj<span class="token punctuation">,</span> token</span>
<span class="line">其他需要登录认证的类<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>在类中定义authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>MyAuthentication<span class="token punctuation">,</span> <span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 权限--&gt;判断登录的用户是否有权限访问</span></span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> BasePermission</span>
<span class="line"></span>
<span class="line">权限类<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>重写has_permission</span>
<span class="line">其他需要权限判断的类<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>在类中定义permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>MyPermission<span class="token punctuation">,</span> <span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redis" tabindex="-1"><a class="header-anchor" href="#redis"><span>redis</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 安装redis</span></span>
<span class="line"><span class="token number">1.</span>解压压缩包到指定地址<span class="token punctuation">(</span>空文件夹中且地址路径没有中文<span class="token punctuation">)</span></span>
<span class="line"><span class="token number">2.</span>打开cmd命令行窗口<span class="token punctuation">,</span>来到redis解压的路径下</span>
<span class="line"><span class="token number">3.</span>执行命令启动redis<span class="token punctuation">:</span>redis<span class="token operator">-</span>server redis<span class="token punctuation">.</span>windows<span class="token punctuation">.</span>conf</span>
<span class="line"><span class="token number">4.</span>为windows部署redis服务器<span class="token punctuation">:</span>redis<span class="token operator">-</span>server <span class="token operator">-</span><span class="token operator">-</span>service<span class="token operator">-</span>install redis<span class="token punctuation">.</span>windows<span class="token punctuation">.</span>conf</span>
<span class="line"><span class="token number">5.</span>右键点击状态栏选择任务管理器<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>找到服务<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>找到redis<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>右键点击运行redis服务</span>
<span class="line"><span class="token number">6.</span>可以在cmd中切换到redis所在路径通过命令访问redis服务<span class="token punctuation">:</span>redis<span class="token operator">-</span>cli</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在django中使用redis</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 1.安装python第三方库</span></span>
<span class="line">pip install django<span class="token operator">-</span>redis</span>
<span class="line"><span class="token comment"># 2.在settings.py文件中配置</span></span>
<span class="line">CACHES <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">     <span class="token string">&quot;default&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;BACKEND&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;django_redis.cache.RedisCache&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;LOCATION&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;redis://127.0.0.1:6379&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;CLIENT_CLASS&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;django_redis.client.DefaultClient&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="限流" tabindex="-1"><a class="header-anchor" href="#限流"><span>限流</span></a></h2><p>限制用户访问的频率xx/s, xx/m, xx/h, xx/d</p><ul><li>对于匿名用户:使用用户ip作为唯一标识</li><li>对于登录用户:使用用户id作为唯一标识</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 限制一小时只能访问5次</span></span>
<span class="line">缓存 <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    用户标识<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span>  <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">09</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># urls.py</span></span>
<span class="line">path<span class="token punctuation">(</span><span class="token string">&#39;order/&#39;</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>OrderView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&#39;order&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># views.py</span></span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> exceptions</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>throttling <span class="token keyword">import</span> SimpleRateThrottle</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache <span class="token keyword">as</span> default_cache</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ThrottleException</span><span class="token punctuation">(</span>exceptions<span class="token punctuation">.</span>APIException<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    status_code <span class="token operator">=</span> status<span class="token punctuation">.</span>HTTP_429_TOO_MANY_REQUESTS</span>
<span class="line">    default_code <span class="token operator">=</span> <span class="token string">&#39;throttle&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 限流类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyRateThrottle</span><span class="token punctuation">(</span>SimpleRateThrottle<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    cache <span class="token operator">=</span> default_cache  <span class="token comment"># 访问放在django的缓存中的记录</span></span>
<span class="line">    scope <span class="token operator">=</span> <span class="token string">&#39;user&#39;</span></span>
<span class="line">    <span class="token comment"># 构造缓存的键</span></span>
<span class="line">    cache_format <span class="token operator">=</span> <span class="token string">&#39;throttle_%s_%s&#39;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 设置访问频率:一分钟内访问5次</span></span>
<span class="line">    THROTTLE_RATES <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;5/m&#39;</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get_cache_key</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> request<span class="token punctuation">.</span>auth<span class="token punctuation">:</span>  <span class="token comment"># 用户登录</span></span>
<span class="line">            ident <span class="token operator">=</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>pk</span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            ident <span class="token operator">=</span> self<span class="token punctuation">.</span>get_ident<span class="token punctuation">(</span>request<span class="token punctuation">)</span>  <span class="token comment"># 获取用户ip</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>cache_format <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>scope<span class="token punctuation">,</span> ident<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">throttle_failure</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        wait <span class="token operator">=</span> self<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取还需要等到的时间</span></span>
<span class="line">        detail <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">1005</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;访问频率&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;detail&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;还需要登录{}s之后才能访问&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>wait<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">raise</span> ThrottleException<span class="token punctuation">(</span>detail<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create your views here.</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">OrderView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    throttle_classes <span class="token operator">=</span> <span class="token punctuation">[</span>MyRateThrottle<span class="token punctuation">,</span> <span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;这是order视图&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    </span>
<span class="line"><span class="token comment"># 访问:</span></span>
<span class="line">get请求<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token operator">//</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>order<span class="token operator">/</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="关于多个限流类" tabindex="-1"><a class="header-anchor" href="#关于多个限流类"><span>关于多个限流类</span></a></h3><p>本质上每个限流类的类中都会有一个allow_request的方法,次方法内部可以有三种情况:</p><ul><li>返回True,表示当前限流类允许访问,继续执行后续的限流类</li><li>返回False,表示当前限流类不允许访问,继续执行后续的限流类.所有限流类执行完毕之后,获取所有不允许的限流,计算需要等待的时间</li><li>抛出异常,表示当前限流类不允许访问,后续的限流类不再执行</li></ul><h3 id="视图类中获取等待时间" tabindex="-1"><a class="header-anchor" href="#视图类中获取等待时间"><span>视图类中获取等待时间</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> exceptions</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>throttling <span class="token keyword">import</span> SimpleRateThrottle</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>cache <span class="token keyword">import</span> cache <span class="token keyword">as</span> default_cache</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ThrottleException</span><span class="token punctuation">(</span>exceptions<span class="token punctuation">.</span>APIException<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    status_code <span class="token operator">=</span> status<span class="token punctuation">.</span>HTTP_429_TOO_MANY_REQUESTS</span>
<span class="line">    default_code <span class="token operator">=</span> <span class="token string">&#39;throttle&#39;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 限流类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">MyRateThrottle</span><span class="token punctuation">(</span>SimpleRateThrottle<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    cache <span class="token operator">=</span> default_cache  <span class="token comment"># 访问放在django的缓存中的记录</span></span>
<span class="line">    scope <span class="token operator">=</span> <span class="token string">&#39;user&#39;</span></span>
<span class="line">    <span class="token comment"># 构造缓存的键</span></span>
<span class="line">    cache_format <span class="token operator">=</span> <span class="token string">&#39;throttle_%s_%s&#39;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 设置访问频率:一分钟内访问5次</span></span>
<span class="line">    THROTTLE_RATES <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;5/m&#39;</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get_cache_key</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> request<span class="token punctuation">.</span>auth<span class="token punctuation">:</span>  <span class="token comment"># 用户登录</span></span>
<span class="line">            ident <span class="token operator">=</span> request<span class="token punctuation">.</span>user<span class="token punctuation">.</span>pk</span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            ident <span class="token operator">=</span> self<span class="token punctuation">.</span>get_ident<span class="token punctuation">(</span>request<span class="token punctuation">)</span>  <span class="token comment"># 获取用户ip</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>cache_format <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>scope<span class="token punctuation">,</span> ident<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create your views here.</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">OrderView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    throttle_classes <span class="token operator">=</span> <span class="token punctuation">[</span>MyRateThrottle<span class="token punctuation">,</span> <span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;这是order视图&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">throttled</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> wait<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        detail <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">1005</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;访问频率&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&#39;detail&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;需要等待{}s才能访问&#39;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>wait<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">raise</span> ThrottleException<span class="token punctuation">(</span>detail<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="序列化serializer" tabindex="-1"><a class="header-anchor" href="#序列化serializer"><span>序列化serializer</span></a></h2><p>drf框架为我们提供了serializer,主要有两个功能:</p><ul><li>对请求数据进行数据校验(底层调用django的Form和ModelForm)</li><li>对数据库查询的到的对象进行序列化(json格式的数据)</li></ul><h3 id="数据校验" tabindex="-1"><a class="header-anchor" href="#数据校验"><span>数据校验</span></a></h3><h4 id="基于serializer" tabindex="-1"><a class="header-anchor" href="#基于serializer"><span>基于serializer</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> EmailValidator<span class="token punctuation">,</span> RegexValidator</span>
<span class="line"><span class="token keyword">import</span> re</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> exceptions</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 序列化类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    username <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;用户名&#39;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> min_length<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">    password <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;密码&#39;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> min_length<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">    email1 <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;邮箱1&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 内部自动进行邮箱格式校验</span></span>
<span class="line">    email2 <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;邮箱2&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                   validators<span class="token operator">=</span><span class="token punctuation">[</span>EmailValidator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># EmailValidator:邮箱格式校验</span></span>
<span class="line">    email3 <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;邮箱3&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                                   validators<span class="token operator">=</span><span class="token punctuation">[</span>RegexValidator<span class="token punctuation">(</span><span class="token string">&#39;\\w+@\\w+\\.\\w+&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># RegexValidator:自定义正则进行校验</span></span>
<span class="line">    email4 <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;邮箱4&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 钩子函数</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">validate_email4</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 判断数据是否符合校验规则</span></span>
<span class="line">        <span class="token keyword">if</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">&#39;\\w+@\\w+\\.\\w+&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> value</span>
<span class="line">        <span class="token keyword">raise</span> exceptions<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">&#39;邮箱格式错误&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"> </span>
<span class="line"><span class="token comment"># 视图类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 获取前端传递的数据,调用serializer进行数据校验</span></span>
<span class="line">        ser <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">not</span> ser<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># is_valid():只有全部字段通过校验返回True</span></span>
<span class="line">            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">1006</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>errors<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>validated_data<span class="token punctuation">)</span>  <span class="token comment"># 经过校验之后,校验成功的数据保存在validated_data</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;创建成功&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    </span>
<span class="line"><span class="token comment"># 访问:</span></span>
<span class="line">post请求<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token operator">//</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>users<span class="token operator">/</span></span>
<span class="line">请求体<span class="token punctuation">:</span>username</span>
<span class="line">      password</span>
<span class="line">      email1<span class="token punctuation">,</span> email2<span class="token punctuation">,</span> email3<span class="token punctuation">,</span> email4</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="基于modelserializer" tabindex="-1"><a class="header-anchor" href="#基于modelserializer"><span>基于ModelSerializer</span></a></h4><ul><li>models</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create your models here.</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Role</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;职务名称&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Department</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;部门名称&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    level_choices <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;普通用户&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;vip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;svip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    level <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span>level_choices<span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;级别&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;用户名&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;密码&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;邮箱&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;年龄&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    token <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    depart <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;部门&#39;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&#39;Department&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span></span>
<span class="line">    roles <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Role&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;职务&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> EmailValidator</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> exceptions</span>
<span class="line"><span class="token keyword">import</span> re</span>
<span class="line"><span class="token keyword">from</span> app01 <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 序列化类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 添加其他模型类中没有的字典进行校验</span></span>
<span class="line">    email2 <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;邮箱2&#39;</span><span class="token punctuation">,</span> validators<span class="token operator">=</span><span class="token punctuation">[</span>EmailValidator<span class="token punctuation">(</span><span class="token string">&#39;邮箱格式不正确&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    email3 <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;邮箱3&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo</span>
<span class="line">        <span class="token comment"># fields = &#39;__all__&#39;  # 获取类中所有字段进行校验</span></span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email3&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token comment"># extra_kwargs:为模型类中的字段添加其他的规则</span></span>
<span class="line">        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string">&#39;username&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;min_length&#39;</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&#39;error_messages&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;required&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;用户名不能为空&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;email&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;error_messages&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;invalid&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;邮箱格式不正确&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">validate_email3</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 判断数据是否符合校验规则</span></span>
<span class="line">        <span class="token keyword">if</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">&#39;\\w+@\\w+\\.\\w+&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> value</span>
<span class="line">        <span class="token keyword">raise</span> exceptions<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">&#39;邮箱格式错误&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        </span>
<span class="line"><span class="token comment"># 视图类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 获取前端传递的数据,调用serializer进行数据校验</span></span>
<span class="line">        ser <span class="token operator">=</span> UserModelSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">not</span> ser<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">1006</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>errors<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>validated_data<span class="token punctuation">)</span>  <span class="token comment"># 经过校验之后,校验成功的数据保存在validated_data</span></span>
<span class="line">        ser<span class="token punctuation">.</span>validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;email2&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 模型类不需要的字段移除</span></span>
<span class="line">        ser<span class="token punctuation">.</span>validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;email3&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 模型类不需要的字段移除</span></span>
<span class="line">        <span class="token comment"># save()括号中添加没有校验且模型类必须的字段</span></span>
<span class="line">        ser<span class="token punctuation">.</span>save<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;123456&#39;</span><span class="token punctuation">,</span> depart_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 自动操作数据库保存数据</span></span>
<span class="line">        <span class="token comment"># save方法能够返回当前报错的新的数据对象</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;创建成功&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="基于modelserializer-fk-mtm使用" tabindex="-1"><a class="header-anchor" href="#基于modelserializer-fk-mtm使用"><span>基于ModelSerializer(fk+mtm使用)</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>validators <span class="token keyword">import</span> EmailValidator</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> exceptions</span>
<span class="line"><span class="token keyword">import</span> re</span>
<span class="line"><span class="token keyword">from</span> app01 <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 序列化类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 添加其他模型类中没有的字典进行校验</span></span>
<span class="line">    email2 <span class="token operator">=</span> serializers<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;邮箱2&#39;</span><span class="token punctuation">,</span> validators<span class="token operator">=</span><span class="token punctuation">[</span>EmailValidator<span class="token punctuation">(</span><span class="token string">&#39;邮箱格式不正确&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    email3 <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>label<span class="token operator">=</span><span class="token string">&#39;邮箱3&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo</span>
<span class="line">        <span class="token comment"># fields = &#39;__all__&#39;  # 获取类中所有字段进行校验</span></span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email2&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email3&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;depart&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;roles&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token comment"># extra_kwargs:为模型类中的字段添加其他的规则</span></span>
<span class="line">        extra_kwargs <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token string">&#39;username&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;min_length&#39;</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&#39;error_messages&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;required&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;用户名不能为空&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token string">&#39;email&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;error_messages&#39;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&#39;invalid&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;邮箱格式不正确&#39;</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">validate_email3</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 判断数据是否符合校验规则</span></span>
<span class="line">        <span class="token keyword">if</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">&#39;\\w+@\\w+\\.\\w+&#39;</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> value</span>
<span class="line">        <span class="token keyword">raise</span> exceptions<span class="token punctuation">.</span>ValidationError<span class="token punctuation">(</span><span class="token string">&#39;邮箱格式错误&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        </span>
<span class="line"><span class="token comment"># 视图类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 获取前端传递的数据,调用serializer进行数据校验</span></span>
<span class="line">        ser <span class="token operator">=</span> UserModelSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">not</span> ser<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">1006</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>errors<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>validated_data<span class="token punctuation">)</span>  <span class="token comment"># 经过校验之后,校验成功的数据保存在validated_data</span></span>
<span class="line">        ser<span class="token punctuation">.</span>validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;email2&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 模型类不需要的字段移除</span></span>
<span class="line">        ser<span class="token punctuation">.</span>validated_data<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">&#39;email3&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 模型类不需要的字段移除</span></span>
<span class="line">        <span class="token comment"># save()括号中添加没有校验且模型类必须的字段</span></span>
<span class="line">        ser<span class="token punctuation">.</span>save<span class="token punctuation">(</span>level<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">&#39;123456&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 自动操作数据库保存数据</span></span>
<span class="line">        <span class="token comment"># save方法能够返回当前报错的新的数据对象</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;创建成功&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">   </span>
<span class="line"><span class="token comment"># 访问</span></span>
<span class="line">post请求<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token operator">//</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>users<span class="token operator">/</span></span>
<span class="line">请求体<span class="token punctuation">:</span>选择raw<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hehehe&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;email2&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;email3&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;depart&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;roles&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="序列化" tabindex="-1"><a class="header-anchor" href="#序列化"><span>序列化</span></a></h3><p>通过orm从数据库中获取到queryset对象或者数据对象都可以被序列化为json格式数据</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># models.py</span></span>
<span class="line"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create your models here.</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Role</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;职务名称&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">Department</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;部门名称&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    level_choices <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;普通用户&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&#39;vip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;svip&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    level <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span>level_choices<span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;级别&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;用户名&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;密码&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;邮箱&#39;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;年龄&#39;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    token <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;token&#39;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    depart <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&#39;部门&#39;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&#39;Department&#39;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span></span>
<span class="line">    roles <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">&#39;Role&#39;</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">&#39;职务&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="序列化基本字段" tabindex="-1"><a class="header-anchor" href="#序列化基本字段"><span>序列化基本字段</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView</span>
<span class="line"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response</span>
<span class="line"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers</span>
<span class="line"><span class="token keyword">from</span> app01 <span class="token keyword">import</span> models</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 序列化类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserModelSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span></span>
<span class="line">        model <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo</span>
<span class="line">        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;age&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;email&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;level&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;password&#39;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 视图类</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserView</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 获取数据库中所有的数据</span></span>
<span class="line">        queryset <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 如果数据有多个需要指定参数many=True</span></span>
<span class="line">        ser <span class="token operator">=</span> UserModelSerializer<span class="token punctuation">(</span>instance<span class="token operator">=</span>queryset<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>ser<span class="token punctuation">.</span>data<span class="token punctuation">)</span>  <span class="token comment"># 经过序列化的结果</span></span>
<span class="line">        <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;code&#39;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&#39;data&#39;</span><span class="token punctuation">:</span> ser<span class="token punctuation">.</span>data<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    </span>
<span class="line"><span class="token comment"># 访问</span></span>
<span class="line">get请求<span class="token punctuation">:</span>http<span class="token punctuation">:</span><span class="token operator">//</span>localhost<span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>users<span class="token operator">/</span></span>
<span class="line">            </span>
<span class="line">结果<span class="token punctuation">:</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;xixixi&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">19</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;123456&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hehehe&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;email&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;123@qq.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;level&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;123456&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,34)])])}const i=n(t,[["render",l]]),u=JSON.parse('{"path":"/django/34-drf%E6%A1%86%E6%9E%B6.html","title":"drf框架","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"redis","slug":"redis","link":"#redis","children":[]},{"level":2,"title":"限流","slug":"限流","link":"#限流","children":[{"level":3,"title":"关于多个限流类","slug":"关于多个限流类","link":"#关于多个限流类","children":[]},{"level":3,"title":"视图类中获取等待时间","slug":"视图类中获取等待时间","link":"#视图类中获取等待时间","children":[]}]},{"level":2,"title":"序列化serializer","slug":"序列化serializer","link":"#序列化serializer","children":[{"level":3,"title":"数据校验","slug":"数据校验","link":"#数据校验","children":[]},{"level":3,"title":"序列化","slug":"序列化","link":"#序列化","children":[]}]}],"git":{},"filePathRelative":"django/34-drf框架.md"}');export{i as comp,u as data};
