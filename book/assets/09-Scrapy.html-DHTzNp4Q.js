import{_ as n,c as a,a as p,o as e}from"./app-hJI7UlmO.js";const t={};function l(i,s){return e(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="scrapyçš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#scrapyçš„æ¦‚å¿µ"><span>scrapyçš„æ¦‚å¿µ</span></a></h2><p>**æ˜¯ä¸€ä¸ªå¿«é€Ÿã€é«˜å±‚æ¬¡çš„ Python ç½‘ç»œçˆ¬è™«æ¡†æ¶ï¼Œç”¨äºæŠ“å–ç½‘ç«™æ•°æ®å¹¶æå–ç»“æ„åŒ–æ•°æ® **</p><p>ä½œç”¨: é€šè¿‡å°‘é‡çš„ä»£ç ï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿçš„æŠ“å– ,æ¡†æ¶æ˜¯ä»£ç çš„åŠæˆå“ï¼Œæé«˜æ•ˆç‡ï¼ˆçˆ¬è™«æ•ˆç‡å’Œå¼€å‘æ•ˆç‡ï¼‰</p><p>å®˜ç½‘åœ°å€: http://scrapy-chs.readthedocs.io/zh_CN/1.0/intro/overview.html</p><h2 id="çˆ¬è™«å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#çˆ¬è™«å·¥ä½œæµç¨‹"><span>çˆ¬è™«å·¥ä½œæµç¨‹</span></a></h2><img src="https://api2.mubu.com/v3/document_image/7637318_11a2b4a1-fc75-4202-eaa6-95215793b058.png" referrerpolicy="no-referrer"><p>å¯ä»¥æ”¹å†™æˆä¸‹æ–¹ç¤ºä¾‹:</p><img src="https://api2.mubu.com/v3/document_image/7637318_ea21ff4c-ec67-4333-e4e6-f4b560014ecf.png" referrerpolicy="no-referrer"><h3 id="scrapyçš„æµç¨‹" tabindex="-1"><a class="header-anchor" href="#scrapyçš„æµç¨‹"><span>scrapyçš„æµç¨‹</span></a></h3><img src="https://api2.mubu.com/v3/document_image/7637318_a5056c84-9f58-486e-d1a0-5a5429600ce4.png" referrerpolicy="no-referrer"><h4 id="å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹" tabindex="-1"><a class="header-anchor" href="#å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹"><span>å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹ï¼š</span></a></h4><p>ç”¨æˆ·è¿è¡Œçˆ¬è™«è„šæœ¬åï¼ŒScrapyåˆå§‹åŒ–åï¼Œå…ˆåŠ è½½ Spider ä¸­å®šä¹‰çš„èµ·å§‹ URL</p><ol><li>å°†Spidersçš„URL <ul><li>ä¼ è¾“ â†’ Spider Middlewares(çˆ¬è™«ä¸­é—´ä»¶) è¿›è¡Œè®¾ç½®è¯·æ±‚å¯¹è±¡</li><li>ä¼ è¾“ â†’ Scrapy Engine(å¼•æ“ ==&gt; æ§åˆ¶ä¸­å¿ƒ)</li></ul></li><li>Scrapy Engineæ¥æ”¶spider middleware æ•°æ®ä¿¡æ¯ <ul><li>å°†æ•°æ®ä¿¡æ¯å‘é€ â†’ scheduler(è°ƒåº¦å™¨)è¿›è¡Œå¤„ç†</li></ul></li><li>schedulerå°†æ¥æ”¶åˆ°çš„æ•°æ®ä¿¡æ¯(request)ç”Ÿæˆé˜Ÿåˆ— (ç®¡ç†requestè¯·æ±‚çš„) <ul><li>å°†requestè¯·æ±‚ä¿¡æ¯å‘é€ â†’ Engineå¼•æ“,å†å‘é€ â†’ Downloader middleware(ä¸‹è½½ä¸­é—´ä»¶)</li><li>ä»ä¸‹è½½ä¸­é—´ä»¶å‘é€ â†’ downloader(ä¸‹è½½å™¨)</li></ul></li><li>downloaderæ¥æ”¶è¯·æ±‚ä¿¡æ¯ <ul><li>downloader è·å–è¯·æ±‚ä¿¡æ¯å,ä¼šè¯·æ±‚å¯¹äºçš„ç½‘ç»œåœ°å€çš„æ•°æ®,å¹¶è¿”å›æ•°æ®response</li><li>å°†responseæ•°æ®è¿”å› â†’ Downloader middleware(ä¸‹è½½ä¸­é—´ä»¶) â†’ Engineå¼•æ“å°†responseæ•°æ®å‘é€ â†’ Spider Middlewares(çˆ¬è™«ä¸­é—´ä»¶) â†’ Spiders</li></ul></li><li>Spiders è§£æ <code>Response</code>ï¼Œæå–æ•°æ®æˆ–æ–°é“¾æ¥ <ul><li><strong>æ–° Request</strong> â†’ è¿”å›ç»™ Engineï¼Œè¿›å…¥ä¸‹ä¸€è½®è°ƒåº¦</li><li><strong>ç»“æ„åŒ–æ•°æ®ï¼ˆItemï¼‰</strong> â†’ å¼•æ“â†’ äº¤ç»™ <code>Item Pipeline</code> å¤„ç†ã€‚</li></ul></li></ol><p>æ³¨æ„: å»é‡æ˜¯æ ¹æ®urlè¿›è¡Œå»é‡çš„</p><h4 id="æ¨¡å—ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—ä½œç”¨"><span>æ¨¡å—ä½œç”¨</span></a></h4><ul><li><p>å¼•æ“(engine)ï¼šè´Ÿè´£æ•°æ®å’Œä¿¡å·åœ¨ä¸åŒæ¨¡å—é—´çš„ä¼ é€’(ä¸­æ¢æ§åˆ¶å™¨ï¼Œåè°ƒæ‰€æœ‰ç»„ä»¶çš„æ•°æ®æµ)</p></li><li><p>è°ƒåº¦å™¨(scheduler)ï¼šç®¡ç†å¾…çˆ¬å–çš„ <code>Request</code> é˜Ÿåˆ—ï¼ˆURL æ„æˆçš„è¯·æ±‚å¯¹è±¡ï¼‰æ¯”å¦‚: å»é‡</p></li><li><p>ä¸‹è½½å™¨(downloader)ï¼šæ¥æ”¶å¼•æ“å‘è¿‡æ¥çš„requestè¯·æ±‚ï¼Œè·å–å“åº”ï¼Œå¹¶å°†å“åº”äº¤ç»™å¼•æ“</p></li><li><p>çˆ¬è™«(spider)ï¼šå¤„ç†å¼•æ“å‘è¿‡æ¥çš„responseï¼Œæå–æ•°æ®ï¼Œæå–urlï¼Œå¹¶äº¤ç»™å¼•æ“</p></li><li><p>ç®¡é“(pipeline)ï¼šå¤„ç†å¼•æ“ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œæ¯”å¦‚å­˜å‚¨</p></li><li><p>ä¸‹è½½ä¸­é—´ä»¶(downloader middleware)ï¼šå¯ä»¥è‡ªå®šä¹‰çš„ä¸‹è½½æ‰©å±•ï¼Œæ¯”å¦‚è®¾ç½®ä»£ç†ip</p><ul><li>é¢„å¤„ç† <code>Request</code>ï¼ˆå¦‚è‡ªåŠ¨é‡è¯•ã€æ›´æ¢ä»£ç†ï¼‰</li><li>åå¤„ç† <code>Response</code>ï¼ˆå¦‚ä¿®æ”¹å“åº”å†…å®¹ã€è¿‡æ»¤å¼‚å¸¸é¡µé¢)</li></ul></li><li><p>çˆ¬è™«ä¸­é—´ä»¶(spider middleware)ï¼šå¯ä»¥è‡ªå®šä¹‰requestè¯·æ±‚å’Œè¿›è¡Œresponseè¿‡æ»¤ï¼Œä¸ä¸‹è½½ä¸­é—´ä»¶ä½œç”¨é‡å¤</p><ul><li>å¹²é¢„ Spider çš„è¾“å…¥ï¼ˆ<code>Response</code>ï¼‰å’Œè¾“å‡ºï¼ˆ<code>Item/Request</code>ï¼‰</li></ul></li></ul><img src="https://api2.mubu.com/v3/document_image/7637318_54251048-c8c4-4629-8cb7-b91ad1ab0c95.png" referrerpolicy="no-referrer"><h3 id="scrapy" tabindex="-1"><a class="header-anchor" href="#scrapy"><span>Scrapy</span></a></h3><blockquote><p>windows/Macå®‰è£…å‘½ä»¤</p></blockquote><p><code>pip/pip3 install scrapy </code></p><blockquote><p>é¡¹ç›®æµç¨‹å‘½ä»¤</p></blockquote><ol><li>åˆ›å»ºé¡¹ç›®: <code>scrapy startproject é¡¹ç›®å</code></li><li>åˆ›å»ºä¸€ä¸ªçˆ¬è™«: <code>scrapy genspider æ–‡ä»¶åç§° çˆ¬è™«çš„ç½‘é¡µåŸŸå</code><ul><li>åˆ›å»ºåä¼šç”Ÿæˆåœ¨spideræ–‡ä»¶å¤¹ä¸­</li><li>ç¤ºä¾‹: <code>scrapy genspider lianjia cs.lianjia.com</code></li></ul></li><li>æå–æ•°æ®: æ ¹æ®ç½‘ç«™ç»“æ„åœ¨spiderä¸­å®ç°æ•°æ®é‡‡é›†ç›¸å…³å†…å®¹</li><li>ä¿å­˜æ•°æ®: ä½¿ç”¨pipelineè¿›è¡Œæ•°æ®åç»­å¤„ç†å’Œä¿å­˜</li></ol><h4 id="ç›®å½•ç»“æ„å¦‚ä¸‹" tabindex="-1"><a class="header-anchor" href="#ç›®å½•ç»“æ„å¦‚ä¸‹"><span>ç›®å½•ç»“æ„å¦‚ä¸‹</span></a></h4><p><img src="https://api2.mubu.com/v3/document_image/7637318_8ab03997-2137-455d-da96-95bfc4b41fbd.png" alt=""></p><ul><li><code>scrapy.cfg</code> é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œ ä¸éœ€è¦åšæ”¹åŠ¨</li><li><code>items.py</code> å®šä¹‰æ•°æ®å­˜å‚¨æ¨¡å‹</li><li><code>middlewares.py</code> ç”¨äºç¼–å†™ä¸­é—´ä»¶ï¼ˆä¸‹è½½ä¸­é—´ä»¶+çˆ¬è™«ä¸­é—´ä»¶ï¼‰ -- æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¸€èˆ¬ä¸éœ€è¦ç¼–å†™</li><li>spidersæ–‡ä»¶å¤¹å®šä¹‰çš„çˆ¬è™«æ–‡ä»¶ <code>lianjia.py </code>ï¼ˆçˆ¬è™«æ–‡ä»¶,æ–‡ä»¶åç§°è‡ªå·±å®šä¹‰ï¼‰ [åé¢å†æ¥å®Œå–„è¯¥çˆ¬è™«æ¨¡å—]</li><li><code>pipelines.py</code> ç®¡é“ -- ä¸»è¦ç”¨äºç¼–å†™æ•°æ®å¤„ç†æ­¥éª¤ ï¼ˆæ•°æ®çš„æ¸…æ´—+ä¿å­˜ï¼‰</li><li><code>settings.py</code> è¯¦ç»†çš„é…ç½®ä¿¡æ¯ï¼ˆè®¾ç½®æ–‡ä»¶USER_AGENT å¹¶å¯åŠ¨ç®¡é“)</li></ul><h4 id="åˆæ­¥ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#åˆæ­¥ä½¿ç”¨"><span>åˆæ­¥ä½¿ç”¨</span></a></h4><blockquote><p>ä¸å…è®¸ä¸­æ–‡æ³¨é‡Š</p></blockquote><p><code>settings.py</code> æ–‡ä»¶ åªéœ€ä¿®æ”¹<code>ROBOTSTXT_OBEY</code></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># ğŸ”µã€åŸºç¡€é…ç½®ã€‘</span></span>
<span class="line">BOT_NAME <span class="token operator">=</span> <span class="token string">&quot;scrapymax&quot;</span>  <span class="token comment"># ğŸŸ¢ é¡¹ç›®æ ‡è¯†ï¼ˆä¼šä½œä¸ºé»˜è®¤User-Agentå‰ç¼€ï¼‰</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸŸ£ã€çˆ¬è™«è·¯å¾„é…ç½®ã€‘</span></span>
<span class="line">SPIDER_MODULES <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;scrapymax.spiders&quot;</span><span class="token punctuation">]</span>  <span class="token comment"># ğŸ”µ æŒ‡å®šçˆ¬è™«æ¨¡å—è·¯å¾„</span></span>
<span class="line">NEWSPIDER_MODULE <span class="token operator">=</span> <span class="token string">&quot;scrapymax.spiders&quot;</span>  <span class="token comment"># ğŸ”µ æ–°å»ºçˆ¬è™«çš„é»˜è®¤ä½ç½®</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸŸ ã€æ‰©å±•æ’ä»¶ã€‘ï¼ˆéœ€æ‰‹åŠ¨æ·»åŠ ï¼‰</span></span>
<span class="line">ADDONS <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># ğŸŸ¡ é¢„ç•™çš„è‡ªå®šä¹‰æ‰©å±•é…ç½®å­—å…¸</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸ”´ã€çˆ¬è™«ä¼ªè£…ã€‘ # ğŸŸ¤ å»ºè®®å–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹ä¸ºçœŸå®UA</span></span>
<span class="line">USER_AGENT <span class="token operator">=</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36&quot;</span>  </span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸŸ¢ã€çˆ¬è™«åè®®ã€‘ æ˜¯å¦éµå®ˆrobots.txtè§„åˆ™ï¼ˆæ­£å¼ç¯å¢ƒå»ºè®®Trueï¼‰</span></span>
<span class="line">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span> </span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸŸ¢ çœŸå®æµè§ˆå™¨UA</span></span>
<span class="line">USER_AGENT <span class="token operator">=</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span>  </span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä¿å®ˆç­–ç•¥ï¼ˆé€‚åˆæ–°æ‰‹æˆ–æ•æ„Ÿç½‘ç«™ï¼‰â€‹</span></span>
<span class="line">CONCURRENT_REQUESTS <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># å…¨å±€å¹¶å‘4</span></span>
<span class="line"><span class="token comment"># åŒä¸€ä¸ªåŸŸåå¹¶å‘2 åŒæ—¶æœ€å¤šå‘ 2 ä¸ªè¯·æ±‚**ï¼ˆé¿å…è¯·æ±‚å¤ªçŒ›è¢«å°ï¼‰</span></span>
<span class="line">CONCURRENT_REQUESTS_PER_DOMAIN <span class="token operator">=</span> <span class="token number">2</span> </span>
<span class="line">DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># æ¯æ¬¡è¯·æ±‚é—´éš”1ç§’ ï¼ˆé™ä½é¢‘ç‡ï¼Œé˜²æ­¢è¢«å°ï¼‰</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¯ç”¨cookies  Trueæ—¶Scrapyä¼šå¤„ç†è¯·æ±‚å’Œå“åº”ä¸­çš„cookies</span></span>
<span class="line"><span class="token comment"># COOKIES_ENABLED = False</span></span>
<span class="line"></span>
<span class="line">DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">2.0</span>  <span class="token comment"># å•ä½ï¼šç§’ï¼Œæ¯ä¸ªè¯·æ±‚é—´éš”2ç§’</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è‡ªåŠ¨æŠ“å–ç›¸å…³é…ç½®</span></span>
<span class="line"><span class="token comment"># å¯ç”¨è‡ªåŠ¨é™é€Ÿ</span></span>
<span class="line">AUTOTHROTTLE_ENABLED <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line">AUTOTHROTTLE_START_DELAY <span class="token operator">=</span> <span class="token number">2.0</span>    <span class="token comment"># åˆå§‹å»¶æ—¶ï¼ˆç§’ï¼‰</span></span>
<span class="line">AUTOTHROTTLE_MAX_DELAY <span class="token operator">=</span> <span class="token number">60.0</span>     <span class="token comment"># æœ€å¤§å»¶æ—¶ï¼ˆç§’ï¼‰</span></span>
<span class="line">AUTOTHROTTLE_TARGET_CONCURRENCY <span class="token operator">=</span> <span class="token number">1.0</span>  <span class="token comment"># ç›®æ ‡å¹¶å‘æ•°</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç®¡é“é…ç½®</span></span>
<span class="line">ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token string">&quot;scrapymax.pipelines.ScrapymaxPipeline&quot;</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">#ç®¡é“æ–‡ä»¶åœ°å€ä»¥åŠæ–‡ä»¶ä¸­çš„ç±»å   æ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span></span>
<span class="line">    	</span>
<span class="line">    <span class="token comment"># å¤šä¸ªç®¡é“</span></span>
<span class="line">    <span class="token string">&quot;scrapymax.pipelines.DeduplicationPipeline&quot;</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>  <span class="token comment"># å†å»é‡</span></span>
<span class="line">    <span class="token string">&quot;scrapymax.pipelines.MongoDBPipeline&quot;</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>  <span class="token comment"># æœ€åå­˜æ•°æ®åº“</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>items.py</code> å®šä¹‰çˆ¬è™«çš„æ•°æ®ç±»å‹(å­—æ®µ)</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># æ–¹ä¾¿åç»­çš„ç®¡ç†, å®šä¹‰itemå³æå‰è§„åˆ’å¥½é‚£äº›å­—æ®µéœ€è¦æŠ“,é˜²æ­¢æ‰‹è¯¯,</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ScrapymaxItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># define the fields for your item here like:</span></span>
<span class="line">    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># æ ‡é¢˜</span></span>
<span class="line">    price <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ä»·æ ¼</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>çˆ¬è™«æ–‡ä»¶.py</code> å®šä¹‰çˆ¬è™«</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">LianjiaSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;lianjia&quot;</span>  <span class="token comment">#çˆ¬è™«æ–‡ä»¶çš„åç§°</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># åªå…è®¸çˆ¬å–è¯¥åŸŸåä¸‹å†…å®¹</span></span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;cs.lianjia.com&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://cs.lianjia.com&quot;</span><span class="token punctuation">]</span> <span class="token comment"># èµ·å§‹çš„è¯·æ±‚è¿æ¥</span></span>
<span class="line">	</span>
<span class="line">    <span class="token comment"># è¯¥æ–¹æ³•ä¼šæ¥æ”¶å¼•æ“ä¼ é€’çš„response</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token comment"># å“åº”ä½“å¯¹è±¡</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token comment">#è¿”å›çš„æ•°æ® æ˜¯bytes ç±»å‹</span></span>
<span class="line">        response<span class="token punctuation">.</span>text  <span class="token comment"># æ–‡æœ¬æ ¼å¼</span></span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="è¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œ"><span>è¿è¡Œ</span></a></h5><blockquote><p>scrapy crawl çˆ¬è™«æ–‡ä»¶å</p></blockquote><p>ä¼šå‡ºç°æ—¥å¿—ä¿¡æ¯,å¯é€šè¿‡æŒ‡ä»¤ä¸æ˜¾ç¤º</p><blockquote><p>scrapy crawl çˆ¬è™«æ–‡ä»¶å --nolog</p></blockquote><p>ä¸ä¼šå‡ºç°æ—¥å¿—ä¿¡æ¯</p><blockquote><p>è®¾ç½®å¯åŠ¨æ–‡ä»¶,ä¸éœ€è¦å‘½ä»¤å»å¯åŠ¨,</p></blockquote><p>æ³¨æ„: æ–‡ä»¶å¿…é¡»åˆ›å»ºåœ¨é¡¹ç›®çš„æ ¹ç›®å½•</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># è‡ªå®šä¹‰åç§°.py </span></span>
<span class="line"><span class="token keyword">from</span> scrapy <span class="token keyword">import</span> cmdline</span>
<span class="line">cmdline<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;scrapy&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;crawl&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;çˆ¬è™«æ–‡ä»¶åç§°&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">cmdline<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;scrapy&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;crawl&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;lianjia&#39;</span><span class="token punctuation">,</span><span class="token string">&quot;--nolog&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># å»é™¤æ—¥å¿—</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># å¯ä»¥ç›´æ¥åœ¨spidersçš„çˆ¬è™«æ–‡ä»¶ä¸­è¿›è¡Œæ‰§è¡Œ</span></span>
<span class="line"><span class="token keyword">from</span> scrapy <span class="token keyword">import</span> cmdline</span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">cmdline<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;scrapy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;crawl&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lianjia&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;--nolog&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="åˆæ­¥ä¹¦å†™" tabindex="-1"><a class="header-anchor" href="#åˆæ­¥ä¹¦å†™"><span>åˆæ­¥ä¹¦å†™</span></a></h5><ul><li><code>.extract() </code> æå–æ‰€æœ‰å¯¹åº”dataæ•°æ®</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># çˆ¬è™«æ–‡ä»¶</span></span>
<span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"><span class="token keyword">from</span> scrapymax<span class="token punctuation">.</span>items <span class="token keyword">import</span> ScrapymaxItem</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">LianjiaSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;lianjia&quot;</span> </span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;cs.lianjia.com&quot;</span><span class="token punctuation">]</span> </span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://cs.lianjia.com/zufang/&quot;</span><span class="token punctuation">]</span> </span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        title <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//a[@class=&quot;twoline&quot;]/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        pre <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//h2[@class=&quot;clearfix&quot;]/a/@href&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">        <span class="token keyword">for</span> titl<span class="token punctuation">,</span>pric <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>pre<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            item <span class="token operator">=</span> ScrapymaxItem<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            item<span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> titl<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            item<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pric</span>
<span class="line">            <span class="token comment"># å°†ç»„ä»¶å¥½çš„dictå½¢å¼æ•°æ®é€šè¿‡ yieldè¿”å›ç»™å¼•æ“  </span></span>
<span class="line">            <span class="token comment"># ç”±å¼•æ“åˆ¤æ–­æ˜¯å¦è¿”å›ç»™ç®¡é“æ–‡ä»¶</span></span>
<span class="line">            <span class="token keyword">yield</span> item</span>
<span class="line"></span>
<span class="line"><span class="token comment"># itemsæ•°æ®æ–‡ä»¶</span></span>
<span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"><span class="token comment"># è®¾è®¡è·å–çš„æ•°æ®å­—å…¸</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ScrapymaxItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    price <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># pipelineç®¡é“æ–‡ä»¶ </span></span>
<span class="line"><span class="token comment"># ä¸»è¦ç”¨äºç¼–å†™æ•°æ®å¤„ç†æ­¥éª¤  éœ€è¦åˆ°settings.pyä¸­å¼€å¯ç®¡é“</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ScrapymaxPipeline</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;./12.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment">#print(type(item),&quot;å¼•æ“å‘é€çš„&quot;) è·å–çš„æ˜¯ä¸€ä¸ªclassçš„æ•°æ®</span></span>
<span class="line">        dict_item <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># ensure_ascii=False ç¦ç”¨ASCIIè½¬ä¹‰â€‹â€‹ï¼Œç›´æ¥è¾“å‡ºåŸå§‹å­—ç¬¦</span></span>
<span class="line">        data <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>dict_item<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>item<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># ä¸èƒ½åˆ é™¤,æ•°æ®éœ€è¦è¿›è¡Œè¿”å›å¼•æ“çš„</span></span>
<span class="line">        <span class="token keyword">return</span> item</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># settings.py ä¸­å¼€å¯pipelineç®¡é“ ä¼ é€’æ•°æ®</span></span>
<span class="line">ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;douban.pipelines.DoubanPipeline&quot;</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è¯·æ±‚å¤´ä¸å“åº”å¤´å±æ€§" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚å¤´ä¸å“åº”å¤´å±æ€§"><span>è¯·æ±‚å¤´ä¸å“åº”å¤´å±æ€§</span></a></h4><blockquote><p>requestè¯·æ±‚å¯¹è±¡çš„å¸¸ç”¨å±æ€§</p></blockquote><ol><li>request.urlï¼ˆå¿…é€‰ï¼‰ï¼šè¯·æ±‚é¡µé¢çš„urlåœ°å€ï¼Œbytesæˆ–strç±»å‹ã€‚</li><li>request.callbackï¼šé¡µé¢è§£æå‡½æ•°ï¼ŒCallbackç±»å‹ï¼ŒRequestè¯·æ±‚å¯¹è±¡çš„é¡µé¢ä¸‹è½½å®Œæˆåï¼Œç”±è¯¥å‚æ•°æŒ‡å®šçš„é¡µé¢è§£æå‡½æ•°è§£æé¡µé¢ï¼Œå¦‚æœæœªä¼ é€’è¯¥å‚æ•°ï¼Œé»˜è®¤è°ƒç”¨Spiderçš„parseæ–¹æ³•ã€‚</li><li>request.methodï¼šHTTPè¯·æ±‚çš„æ–¹æ³•ï¼Œé»˜è®¤ä¸ºâ€˜GETâ€™ã€‚</li><li>request.headersï¼šHTTPè¯·æ±‚çš„å¤´éƒ¨å­—å…¸ï¼Œdict ç±»å‹ã€‚</li><li>request.metaï¼šRequest çš„å…ƒæ•°æ®å­—å…¸ï¼Œdict ç±»å‹ï¼Œç”¨äºç»™æ¡†æ¶ä¸­å…¶ä»–ç»„ä»¶ä¼ é€’ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸­é—´ä»¶ Item Pipelineã€‚å…¶ä»–ç»„ä»¶å¯ä»¥ä½¿ç”¨Request å¯¹è±¡çš„ meta å±æ€§è®¿é—®è¯¥å…ƒæ•°æ®å­—å…¸ (request.meta), ä¹Ÿç”¨äºç»™å“åº”å¤„ç†å‡½æ•°ä¼ é€’ä¿¡æ¯ã€‚</li><li>request.encodingï¼šurl å’Œ body å‚æ•°çš„ç¼–ç é»˜è®¤ä¸º&#39;utf-8&#39;ã€‚å¦‚æœä¼ å…¥çš„urlæˆ–bodyå‚æ•°æ˜¯str ç±»å‹ï¼Œå°±ä½¿ç”¨è¯¥å‚æ•°è¿›è¡Œç¼–ç ã€‚</li><li>request.dont_filterï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ˆdont_filter=Falseï¼‰,å¯¹åŒä¸€ä¸ªurlåœ°å€å¤šæ¬¡æäº¤ä¸‹è½½è¯·æ±‚ï¼Œåé¢çš„è¯·æ±‚ä¼šè¢«å»é‡è¿‡æ»¤å™¨è¿‡æ»¤ï¼ˆé¿å…é‡å¤ä¸‹è½½ï¼‰ã€‚å¦‚æœå°†è¯¥å‚æ•°ç½®ä¸ºTrueï¼Œå¯ä»¥ä½¿è¯·æ±‚é¿å…è¢«è¿‡æ»¤ï¼Œå¼ºåˆ¶ä¸‹è½½ã€‚ä¾‹å¦‚ï¼šåœ¨å¤šæ¬¡çˆ¬å–ä¸€ä¸ªå†…å®¹éšæ—¶é—´è€Œå˜åŒ–çš„é¡µé¢æ—¶ï¼ˆæ¯æ¬¡ä½¿ç”¨ç›¸åŒçš„urlï¼‰ï¼Œå¯ä»¥å°†è¯¥å‚æ•°è®¾ç½®ä¸ºTrueã€‚</li></ol><blockquote><p>responseå“åº”å¯¹è±¡çš„å¸¸ç”¨å±æ€§</p></blockquote><ol><li>response.urlï¼šè·å–å½“å‰å“åº”çš„urlåœ°å€</li><li>response.request.urlï¼šè·å–å½“å‰å“åº”å¯¹åº”çš„è¯·æ±‚çš„urlåœ°å€</li><li>response.headersï¼šè·å–å“åº”å¤´</li><li>response.urljoin(url) ï¼šç”¨äºæ„é€ ç»å¯¹url, å½“ä¼ å…¥çš„urlå‚æ•°æ˜¯ä¸€ä¸ªç›¸å¯¹åœ°å€æ—¶, æ ¹æ®response.urlè®¡ç®—å‡ºç›¸åº”çš„ç»å¯¹url.</li><li>response.bodyï¼šè·å–å“åº”ä½“ï¼Œä¹Ÿå°±æ˜¯htmlä»£ç ï¼Œbyteç±»å‹</li><li>response.textï¼š è·å–å“åº”ä½“ï¼Œstrç±»å‹</li><li>response.statusï¼šè·å–å“åº”çŠ¶æ€ç </li></ol><h3 id="çˆ¬å–æ•°æ®" tabindex="-1"><a class="header-anchor" href="#çˆ¬å–æ•°æ®"><span>çˆ¬å–æ•°æ®</span></a></h3><ul><li>æ”¯æŒxpathè·å–æ•°æ®</li><li>æ”¯æŒcssè·å–æ•°æ® <ul><li>res.css(&quot;.title::text&quot;) è·å–æ–‡æœ¬</li><li>res.css(&quot;img::attr(src)&quot;) è·å–å±æ€§</li></ul></li></ul><blockquote><p>è·å–åŒ¹é…çš„å†…å®¹</p></blockquote><table><thead><tr><th style="text-align:left;">æ–¹æ³•</th><th style="text-align:left;">è¿”å›ç±»å‹</th><th style="text-align:left;">æ˜¯å¦æ¨èä½¿ç”¨</th><th style="text-align:left;">å¤‡æ³¨</th></tr></thead><tbody><tr><td style="text-align:left;"><code>.extract()</code></td><td style="text-align:left;">åˆ—è¡¨</td><td style="text-align:left;">âŒ ä¸æ¨è</td><td style="text-align:left;">è¿”å›æ‰€æœ‰åŒ¹é…ç»“æœçš„åˆ—è¡¨</td></tr><tr><td style="text-align:left;"><code>.extract_first()</code></td><td style="text-align:left;">å­—ç¬¦ä¸²/None</td><td style="text-align:left;">âŒ ä¸æ¨è</td><td style="text-align:left;">è¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…ç»“æœ</td></tr><tr><td style="text-align:left;"><code>.getall()</code></td><td style="text-align:left;">åˆ—è¡¨</td><td style="text-align:left;">âœ… æ¨è</td><td style="text-align:left;"><code>.extract()</code> çš„ç°ä»£æ›¿ä»£</td></tr><tr><td style="text-align:left;"><code>.get()</code></td><td style="text-align:left;">å­—ç¬¦ä¸²/None</td><td style="text-align:left;">âœ… æ¨è</td><td style="text-align:left;"><code>.extract_first()</code> çš„ç°ä»£æ›¿ä»£</td></tr></tbody></table><h4 id="è®¾ç½®å¤šæ¬¡è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®å¤šæ¬¡è¯·æ±‚"><span>è®¾ç½®å¤šæ¬¡è¯·æ±‚</span></a></h4><blockquote><p><code>scrapy.Request(url,callback)</code> ç”¨äºåˆ›å»ºè¯·æ±‚å¹¶æŒ‡å®šå›è°ƒå‡½æ•°</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"> <span class="token comment"># åŸºæœ¬å‚æ•°</span></span>
<span class="line">    callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">,</span>        <span class="token comment"># å›è°ƒå‡½æ•°ï¼ˆé»˜è®¤ï¼šspider.parseï¼‰</span></span>
<span class="line">    method<span class="token operator">=</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span>               <span class="token comment"># HTTPæ–¹æ³•ï¼šGET, POST, PUTç­‰</span></span>
<span class="line">    headers<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token comment"># è¯·æ±‚å¤´å­—å…¸</span></span>
<span class="line">    body<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                  <span class="token comment"># è¯·æ±‚ä½“ï¼ˆPOSTæ•°æ®ï¼‰</span></span>
<span class="line">    cookies<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token comment"># Cookies</span></span>
<span class="line"> <span class="token comment"># å…ƒæ•°æ®ä¼ é€’</span></span>
<span class="line">    meta<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>                  <span class="token comment"># ä¼ é€’é¢å¤–æ•°æ®çš„å­—å…¸</span></span>
<span class="line">    dont_filter<span class="token operator">=</span><span class="token boolean">False</span>   	<span class="token comment">#ä¸ºTrueï¼Œè¯·æ±‚ä¸ä¼šè¢«è°ƒåº¦å™¨è¿‡æ»¤</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># extractåªéœ€è¦Selectorå…¶ä¸­çš„æ–‡æœ¬</span></span>
<span class="line"></span>
<span class="line">        title <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        pre <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">for</span> titl<span class="token punctuation">,</span> pric <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            items <span class="token operator">=</span> ScrapymaxItem<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            items<span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> titl<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            items<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pric</span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;itemssssss&#39;</span><span class="token punctuation">,</span>items<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">yield</span> items</span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>index <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">            <span class="token comment"># æ„å»ºå¤šæ¬¡è¯·æ±‚åœ°å€</span></span>
<span class="line">            page_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&#39;/pg</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">}</span></span><span class="token string">&#39;</span></span></span>
<span class="line">            <span class="token comment"># å°†æ–°çš„urlåœ°å€å‘é€åˆ°å¼•æ“  </span></span>
<span class="line">            <span class="token comment"># callbackè®¾ç½®åç»­è¯·æ±‚åæ•°æ®äº¤ç»™é‚£ä¸ªå‡½æ•°è¿›è¡Œå¤„ç†</span></span>
<span class="line">            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>page_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è·å–è¯¦ç»†ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#è·å–è¯¦ç»†ä¿¡æ¯"><span>è·å–è¯¦ç»†ä¿¡æ¯</span></a></h4><blockquote><p>é€šè¿‡metaå‚æ•°è¿›è¡Œä¼ é€’æ•°æ®, dict ç±»å‹</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># çˆ¬è™«æ–‡ä»¶</span></span>
<span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"><span class="token keyword">from</span> scrapymax<span class="token punctuation">.</span>items <span class="token keyword">import</span> ScrapymaxItem</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">LianjiaSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;lianjia&quot;</span> </span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;cs.lianjia.com&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://cs.lianjia.com/zufang/&quot;</span><span class="token punctuation">]</span> </span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        title <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        pre <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">        <span class="token keyword">for</span> titl<span class="token punctuation">,</span>pric <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>pre<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            item <span class="token operator">=</span> ScrapymaxItem<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            item<span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> titl<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            item<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pric</span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># ä¸éœ€è¦å†™, ç”±åç»­çš„å†…å®¹è¿›è¡Œä¼ é€’äº†</span></span>
<span class="line">            <span class="token comment"># yield items_all</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># è·å–è¯¦æƒ…é¡µé¢çš„æ•°æ®ä¿¡æ¯</span></span>
<span class="line">            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>items_all<span class="token punctuation">[</span><span class="token string">&quot;link&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_msg<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;items_all&quot;</span><span class="token punctuation">:</span> items_all<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse_msg</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        items <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">&#39;items_all&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        text <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//div[@class=&quot;intro&quot;]//text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        items<span class="token punctuation">[</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> text</span>
<span class="line">        <span class="token comment"># å°†è·å–çš„æ•°æ®å‘é€åˆ°å¼•æ“ åœ¨å‘é€åˆ°ç®¡é“</span></span>
<span class="line">        <span class="token keyword">yield</span> items</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shellæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#shellæµ‹è¯•"><span>Shellæµ‹è¯•</span></a></h3><p>ç”±äºScrapyæ˜¯ä¸€ä¸ªé‡é‡çº§æ¡†æ¶ï¼Œæ¯æ¬¡è¿è¡Œèµ·æ¥éƒ½è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå› æ­¤è¦å»éªŒè¯æˆ‘ä»¬ä¹¦å†™çš„è§„åˆ™æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ï¼Œå› æ­¤Scrapyæä¾›äº†ä¸€ä¸ªshellï¼Œç”¨èµ·æ¥æ–¹ä¾¿æµ‹è¯•è§„åˆ™</p><p>æ‰“å¼€cmdç»ˆç«¯ï¼Œè¿›å…¥åˆ°Scrapyé¡¹ç›®æ‰€åœ¨ç›®å½•ï¼Œè¿›å…¥åˆ°Scrapyæ¡†æ¶æ‰€åœ¨çš„ç¯å¢ƒä¸­</p><blockquote><p>ctrl + d é€€å‡ºæµ‹è¯•</p></blockquote><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd"><pre><code><span class="line"># é€šè¿‡cmdæŒ‡ä»¤ è®¾ç½®UAä¿¡æ¯ åœ¨è®¾ç½®æµè§ˆå™¨åœ°å€</span>
<span class="line">scrapy shell -s USER_AGENT=&#39;&#39; &#39;url&#39;</span>
<span class="line"></span>
<span class="line"># æ‰“å¼€ä¹‹å ä¼šè‡ªåŠ¨å­˜åœ¨ä¸€ä¸ªresponseè¿”å›å€¼, ä¾¿æ˜¯è·å–ç½‘é¡µçš„æ•°æ®</span>
<span class="line">print(rsponse.status)</span>
<span class="line"># è·å–å¯¹åº”çš„æ•°æ®</span>
<span class="line">response.xpath().extract() </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="scrapyè¿›é˜¶" tabindex="-1"><a class="header-anchor" href="#scrapyè¿›é˜¶"><span>scrapyè¿›é˜¶</span></a></h2><h3 id="postè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#postè¯·æ±‚"><span>postè¯·æ±‚</span></a></h3><ul><li><code>Request Payload</code>: jsonæ ¼å¼</li><li><code>from data</code>: å­—å…¸æ ¼å¼</li></ul><blockquote><p>åœ¨è¯·æ±‚æ—¶ è¦æ³¨æ„header,ä»¥åŠcookieè®¾ç½®, å°¤å…¶æ˜¯ä»¥è…¾è®¯æ–°é—»ä¸ºä¾‹</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># start_requestsæ˜¯å®šåˆ¶æ–¹æ³•,æ˜¯é‡å†™è¯·æ±‚çš„æ–¹æ³•,ä¸èƒ½ä¿®æ”¹åç§°å’Œå‚æ•°</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># é‡ä¿®æ„é€ çœ‹ä¸€ä¸ªèµ·å§‹çš„è¯·æ±‚,å¹¶ä¸”è¯·æ±‚æ–¹å¼ä¸ºpost</span></span>
<span class="line">    <span class="token comment">#  body: æºå¸¦Postè¯·æ±‚æ•°æ® Method: è¯·æ±‚æ–¹å¼</span></span>
<span class="line">    </span>
<span class="line">   	<span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">,</span>body<span class="token operator">=</span><span class="token string">&quot;æ•°æ®&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># è¦æ³¨æ„æ˜¯jsonæ ¼å¼ è¿˜æ˜¯å­—å…¸æ ¼å¼</span></span>
<span class="line">    <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> body<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>handler_parse<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">handler_parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token string">&quot;çŠ¶æ€&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cookieè®¾ç½®" tabindex="-1"><a class="header-anchor" href="#cookieè®¾ç½®"><span>Cookieè®¾ç½®</span></a></h3><blockquote><p>å¯ä»¥åœ¨ä¸‹è½½ä¸­é—´ä»¶ä¸­è¿›è¡Œè®¾ç½®</p><p>å¯ä»¥åœ¨spideræ–‡ä»¶ä¸­è¯·æ±‚(spider.Request)ä¹‹å‰è¿›è¡Œè®¾ç½®</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"> <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">     request<span class="token punctuation">.</span>cookies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&#39;sessionid&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># é‡ç½®è¯·æ±‚</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">   cookies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">   <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span> callback<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="scrapyé…ç½®" tabindex="-1"><a class="header-anchor" href="#scrapyé…ç½®"><span>scrapyé…ç½®</span></a></h3><blockquote><p>è®¾ç½®åŸºç¡€è¯·æ±‚å¤´ä¿¡æ¯, UAä¸Cookieè®¾ç½®åœ¨ä¸­é—´ä»¶æˆ–è¯·æ±‚ä¸­</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># setting.py</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯  è¿™é‡Œçš„user-Agentå†™äº† ä¸Šæ–¹çš„å¯ä»¥ä¸ç”¨å†™</span></span>
<span class="line">DEFAULT_REQUEST_HEADERS <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token string">&quot;Accept&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span></span>
<span class="line">   <span class="token string">&quot;Accept-Language&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;en&quot;</span><span class="token punctuation">,</span></span>
<span class="line">   <span class="token string">&quot;cookie&quot;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">   <span class="token string">&quot;User-Agent&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç®¡é“è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#ç®¡é“è®¾ç½®"><span>ç®¡é“è®¾ç½®</span></a></h3><blockquote><p>ä¸¤ä¸ªéƒ½ä¼šæ‰§è¡Œ, æ•°æ®æ˜¯ä¸€æ ·çš„, åªæ˜¯æ‰§è¡Œçš„å‰åé¡ºåºä¸åŒ</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;dian.pipelines.DianPipeline&quot;</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;dian.pipelines.DianPipelineMsg&quot;</span><span class="token punctuation">:</span> <span class="token number">299</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># åœ¨ç®¡é“ä¸­</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># ä½¿ç”¨getæ–¹æ³•é¿å…KeyErrorï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›None</span></span>
<span class="line">    title <span class="token operator">=</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    title_url <span class="token operator">=</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;title_url&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    address <span class="token operator">=</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;address&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    city <span class="token operator">=</span> item<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;city&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> item</span>
<span class="line"></span>
<span class="line"><span class="token comment"># è½¬æ¢æˆå­—å…¸dict(item)  ä¹Ÿå¯ä»¥</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¸­é—´ä»¶è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#ä¸­é—´ä»¶è®¾ç½®"><span>ä¸­é—´ä»¶è®¾ç½®</span></a></h3><blockquote><p>ä¸­é—´ä»¶å¯ä»¥è®¾ç½®å¤šä¸ª, ä¼šæŒ‰ç…§æ•°å€¼æ‰§è¡Œ</p></blockquote><h4 id="çˆ¬è™«ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#çˆ¬è™«ä¸­é—´ä»¶"><span>çˆ¬è™«ä¸­é—´ä»¶</span></a></h4><ul><li><code>from_crawler</code>: åˆ›å»ºä¸­é—´ä»¶å®ä¾‹çš„</li><li><code>process_spider_input</code>: æ¯ä¸ªå“åº”é€šè¿‡spiderä¸­é—´ä»¶å¹¶è¿›å…¥spiderï¼ˆå³è¢«spiderçš„è§£ææ–¹æ³•å¤„ç†ä¹‹å‰ï¼‰è¢«è°ƒç”¨ã€‚ <ul><li>æ—¢å¼•æ“å°†å“åº”æ•°æ®è¿”å›å€¼spiderä¸­æ—¶è§¦å‘</li></ul></li><li><code>process_spider_output</code>: å½“spiderå¤„ç†å®Œå“åº”æ•°æ®,æå–ç»“æœæˆ–urlåï¼Œè¿”å›ç»“æœæ—¶è¢«è°ƒç”¨</li><li><code>process_spider_exception</code>: å½“spideræˆ–<code>process_spider_input</code>æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨</li><li><code>process_start</code>: æ˜¯å¼‚æ­¥æ–¹æ³•ï¼Œç”¨äºå¤„ç†å¼‚æ­¥èµ·å§‹è¯·æ±‚</li><li><code>spider_opened</code> è®°å½•æ—¥å¿—çš„</li></ul><h4 id="ä¸‹è½½ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#ä¸‹è½½ä¸­é—´ä»¶"><span>ä¸‹è½½ä¸­é—´ä»¶</span></a></h4><ul><li><code>from_crawler</code>: åˆ›å»ºä¸­é—´ä»¶å®ä¾‹çš„</li><li><code>process_request</code>: æ¯ä¸ªé€šè¿‡ä¸‹è½½å™¨ä¸­é—´ä»¶çš„è¯·æ±‚éƒ½ä¼šè°ƒç”¨</li><li><code>process_response</code>: å¯¹æ¯ä¸ªä»ä¸‹è½½å™¨è¿”å›çš„å“åº”éƒ½ä¼šè°ƒç”¨</li><li><code>process_exception</code> : å½“ä¸‹è½½å¤„ç†å™¨æˆ–process_requestæ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ—¶è°ƒç”¨</li><li><code>spider_opened</code> è®°å½•æ—¥å¿—çš„</li></ul><blockquote><p>from fake_useragent import UserAgent éšæœºè¯·æ±‚å¤´åº“</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># åœ¨åŸæœ‰çš„downloadä¸­é—´ä»¶ä¸Šè®¾ç½®</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    user_agent <span class="token operator">=</span> UserAgent<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>random</span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>user_agent<span class="token punctuation">,</span> <span class="token string">&quot;è¾“å‡ºä¸­é—´ä»¶è¯·æ±‚å¤´&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> user_agent</span>
<span class="line">    </span>
<span class="line"><span class="token comment"># åœ¨spideræ–‡ä»¶ä¸­é€šè¿‡ response.request.headers è·å–è¯·æ±‚å¤´ä¿¡æ¯</span></span>
<span class="line"><span class="token comment"># response.request.headers[&quot;User-Agent&quot;]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„: <code>setting.pyæ–‡ä»¶</code> éœ€è¦è¿›è¡Œå¯¹äºçš„è®¾ç½®, æ•°å€¼è¶Šå°</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># å®‰è£…: pip install fake-useragent</span></span>
<span class="line"><span class="token keyword">from</span> fake_useragent <span class="token keyword">import</span> UserAgent</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserAgentDownloadMiddleware</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>ua <span class="token operator">=</span> UserAgent<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># æ¯ä¸ªäº¤ç»™ä¸‹è½½å™¨çš„requestå¯¹è±¡éƒ½ä¼šç»è¿‡è¯¥æ–¹æ³•</span></span>
<span class="line">    <span class="token comment"># æ–¹æ³•åæ˜¯scrapyè§„å®šçš„æ–¹æ³• ï¼ˆåå•†æœºåˆ¶ï¼‰</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># è®¾ç½®è¯·æ±‚å¤´</span></span>
<span class="line">        request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>ua<span class="token punctuation">.</span>random</span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">None</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><p>åœ¨middlewares.pyä¸­å®šä¹‰UserAgentDownloadMiddlewareç±»</p></li><li><p>åœ¨settings.pyä¸­å¯ç”¨è¿™ä¸ªä¸­é—´ä»¶ï¼Œé€šè¿‡DOWNLOADER_MIDDLEWARESé€‰é¡¹è®¾ç½®ã€‚</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># æ•°å€¼è¶Šå° å…ˆè°ƒç”¨, æ•°å€¼å¤§ç€åæ‰§è¡Œ</span></span>
<span class="line">DOWNLOADER_MIDDLEWARES <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token string">&quot;douban.middlewares.DoubanDownloaderMiddleware&quot;</span><span class="token punctuation">:</span> <span class="token number">543</span><span class="token punctuation">,</span></span>
<span class="line">   <span class="token string">&quot;douban.middlewares.UserAgentDownloadMiddleware&quot;</span><span class="token punctuation">:</span> <span class="token number">542</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="è¯·æ±‚ä»£ç†" tabindex="-1"><a class="header-anchor" href="#è¯·æ±‚ä»£ç†"><span>è¯·æ±‚ä»£ç†</span></a></h3><blockquote><p>æ¯æ¬¡è¿›è¡Œè¯·æ±‚æ—¶è®¾ç½®ä¸€ä¸ªä»£ç†: å•ä¸ªä»£ç†</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># ç§å¯†ä»£ç†</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">wangyeMide</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;ä¸­é—´:</span><span class="token interpolation"><span class="token punctuation">{</span>request<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># æå–ä»£ç†APIæ¥å£ï¼Œè·å–1ä¸ªä»£ç†IP</span></span>
<span class="line">        api_url <span class="token operator">=</span> <span class="token string">&quot;https://dps.kdlapi.com/api/getdps/?secret_id=o4zsfebj9j4nm0izhp7s&amp;signature=ocoxalcpllkatvl57beyisep1vzj58p8&amp;num=1&amp;sep=1&quot;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># è·å–APIæ¥å£è¿”å›çš„ä»£ç†IP</span></span>
<span class="line">        proxy_ip <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>api_url<span class="token punctuation">)</span><span class="token punctuation">.</span>text</span>
<span class="line"></span>
<span class="line">        <span class="token comment"># ç”¨æˆ·åå¯†ç è®¤è¯(ç§å¯†ä»£ç†/ç‹¬äº«ä»£ç†)</span></span>
<span class="line">        username <span class="token operator">=</span> <span class="token string">&quot;d2089925381&quot;</span></span>
<span class="line">        password <span class="token operator">=</span> <span class="token string">&quot;8ujkam0p&quot;</span></span>
<span class="line">        proxies <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;http&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://%(user)s:%(pwd)s@%(proxy)s/&quot;</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">&quot;pwd&quot;</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span> <span class="token string">&quot;proxy&quot;</span><span class="token punctuation">:</span> proxy_ip<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;https&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://%(user)s:%(pwd)s@%(proxy)s/&quot;</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">&quot;pwd&quot;</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span> <span class="token string">&quot;proxy&quot;</span><span class="token punctuation">:</span> proxy_ip<span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># ä½¿ç”¨ä»£ç†IPå‘é€è¯·æ±‚</span></span>
<span class="line">        request<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">&#39;proxy&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> proxies<span class="token punctuation">[</span><span class="token string">&#39;https&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">None</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>è®¾ç½®ä»£ç†æ± , å¿«ä»£ç†ä¸­å­˜åœ¨å¯¹åº”çš„ç¤ºä¾‹ä»£ç , æŒ‰ç…§ç¤ºä¾‹ä»£ç è¿›è¡Œæ“ä½œå°±è¡Œ</p></blockquote><ul><li><code>éœ€è¦è®¾ç½®settingæ–‡ä»¶, ä¸­é—´ä»¶,æ·»åŠ æ–°æ–‡ä»¶</code></li></ul><h2 id="seleniumå’Œdirssionpage" tabindex="-1"><a class="header-anchor" href="#seleniumå’Œdirssionpage"><span>seleniumå’ŒDirssionPage</span></a></h2><p>scrapyä¸­ä½¿ç”¨seleniumå’ŒDirssionPage, è¿˜ä¸å¦‚ç›´æ¥ä½¿ç”¨seleniumå’ŒDirssionPage, è¿™é‡Œäº†è§£å³å¯</p><h3 id="selenium" tabindex="-1"><a class="header-anchor" href="#selenium"><span>selenium</span></a></h3><h4 id="å¼€å§‹" tabindex="-1"><a class="header-anchor" href="#å¼€å§‹"><span>å¼€å§‹</span></a></h4><blockquote><p>çˆ¬å–ç½‘æ˜“æ–°é—», ç½‘æ˜“æ–°é—»æ˜¯ä¸€ä¸ªjsonpæ ¼å¼çš„æ•°æ®, ä¸seleniumè¿›è¡Œé…åˆ</p></blockquote><p>ç½‘æ˜“æ–°é—»çš„æ•°æ®,æ˜¯é€šè¿‡jsonpåç»­æ¸²æŸ“çš„é¡µé¢, æ— æ³•ç›´æ¥é€šè¿‡æ–‡æ¡£è·å–</p><ul><li><code>list_msg_info</code> è®¾ç½®è¯·æ±‚é¡µé¢å†…å®¹</li><li><code>__init__å‡½æ•°å†…å®¹</code> å¯ä»¥åœ¨ä¸‹è½½ä¸­é—´ä»¶è·å–åˆ° <ul><li>åœ¨ä¸‹è½½ä¸­é—´ä»¶,é€šè¿‡spiderå‚æ•°è·å–, spiderå‚æ•°ä¸º çˆ¬è™«æ–‡ä»¶å®ä¾‹å¯¹è±¡</li></ul></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># spiderçˆ¬è™«æ–‡ä»¶</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">WangyiceshiSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;wangyiceshi&quot;</span></span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;news.163.com&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://news.163.com/&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># è®¾ç½®çš„å†…å®¹,å¯ä»¥åœ¨ä¸‹è½½ä¸­é—´ä»¶è·å–åˆ°</span></span>
<span class="line">        self<span class="token punctuation">.</span>exists_msg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">        </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">if</span> res<span class="token punctuation">.</span>status <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span></span>
<span class="line">        title_url <span class="token operator">=</span> res<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        title_msg <span class="token operator">=</span> res<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># è®¾ç½®è¯·æ±‚é‚£å‡ ä¸ªé¡µé¢æ•°æ®å†…å®¹</span></span>
<span class="line">        list_msg_info <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># è®¾ç½®æ•°æ®</span></span>
<span class="line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> list_msg_info<span class="token punctuation">:</span></span>
<span class="line">            items <span class="token operator">=</span> WangyiItem<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            items<span class="token punctuation">[</span><span class="token string">&#39;title_url&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> title_url<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span>
<span class="line">            items<span class="token punctuation">[</span><span class="token string">&#39;title_msg&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> title_msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># æ·»åŠ æ•°æ® åœ¨ä¸‹è½½ä¸­é—´ä»¶ä¸­ è¿›è¡Œåˆ¤æ–­,</span></span>
<span class="line">            self<span class="token punctuation">.</span>exists_msg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>title_url<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">yield</span> items</span>
<span class="line">            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>title_url<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>handler_random_page<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">handler_random_page</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token string">&quot;çŠ¶æ€ç &quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token string">&quot;resp.url&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line">        pas</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é…åˆseleniumçˆ¬å–" tabindex="-1"><a class="header-anchor" href="#é…åˆseleniumçˆ¬å–"><span>é…åˆseleniumçˆ¬å–</span></a></h4><blockquote><p>åœ¨spiderçˆ¬è™«æ–‡ä»¶è¿›è¡Œåˆå§‹é…ç½®</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># spiderçˆ¬è™«æ–‡ä»¶</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># è®¾ç½®seleniumå¤„ç†</span></span>
<span class="line">        self<span class="token punctuation">.</span>options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># self.options.add_argument(&quot;--headless&quot;)# æ— å¤´æ¨¡å¼</span></span>
<span class="line">        self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&quot;--no-sandbox&quot;</span><span class="token punctuation">)</span><span class="token comment"># æ²™ç›’æ¨¡å¼</span></span>
<span class="line">    self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">&#39;excludeSwitches&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;enable-automation&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">        self<span class="token punctuation">.</span>browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>self<span class="token punctuation">.</span>options<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># è®¾ç½®çš„å†…å®¹,å¯ä»¥åœ¨ä¸‹è½½ä¸­é—´ä»¶è·å–åˆ°</span></span>
<span class="line">        self<span class="token punctuation">.</span>exists_msg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">     </span>
<span class="line"><span class="token comment"># æ–¹æ³•ä¼šè‡ªåŠ¨æ‰§è¡Œ  å…³é—­æµè§ˆå™¨</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    self<span class="token punctuation">.</span>browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span>       </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ä¸‹è½½ä¸­é—´ä»¶: é€šè¿‡seleniumè·å–æ•°æ®,å°†seleniumè·å–çš„æ•°æ®è¿›è¡Œå°è£…, å†è¿›è¡Œè¿”å›</p></blockquote><p>Seleniumè·å–é¡µé¢æºä»£ç åï¼Œä½¿ç”¨HtmlResponseæ„å»ºä¸€ä¸ªResponseå¯¹è±¡ï¼Œä»¥ä¾¿ç”¨Scrapyçš„Selectoræ¥è§£æ</p><p><strong>æ³¨æ„: å½“seleniumé‡Œé¢çš„ä»£ç å‡ºç°é—®é¢˜æ—¶,æ˜¯æ— æ³•è¿”å›æ•°æ®çš„</strong></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># é€šè¿‡HtmlResponseåˆ›å»ºå“åº”æ•°æ®,æ–¹ä¾¿scrapyè¿›è¡Œè§£æ</span></span>
<span class="line"><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>http <span class="token keyword">import</span> HtmlResponse</span>
<span class="line"></span>
<span class="line"><span class="token comment"># åœ¨çˆ¬è™«ä¸­é—´ä»¶ä¸­è¿›è¡Œ </span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">process_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">	</span>
<span class="line">   <span class="token comment"># åªå¤„ç†åœ¨spider.urlsåˆ—è¡¨ä¸­çš„URL</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>url <span class="token keyword">in</span> spider<span class="token punctuation">.</span>exists_msg<span class="token punctuation">:</span></span>
<span class="line">        spider<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># æ‰§è¡Œseleniumæ“ä½œ è·å–é¡µé¢æ•°æ®</span></span>
<span class="line">        <span class="token comment"># æ»šåŠ¨åˆ°æœ€ä¸‹æ–¹</span></span>
<span class="line">spider<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">&quot;window.scrollTo(0,document.body.scrollHeight)&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        wait <span class="token operator">=</span> WebDriverWait<span class="token punctuation">(</span>spider<span class="token punctuation">.</span>driver<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">        but <span class="token operator">=</span> wait<span class="token punctuation">.</span>until<span class="token punctuation">(</span>EC<span class="token punctuation">.</span>element_to_be_clickable<span class="token punctuation">(</span></span>
<span class="line">                <span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        but<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># è·å–ç½‘é¡µæºç æ•°æ®</span></span>
<span class="line">        page_text <span class="token operator">=</span> spider<span class="token punctuation">.</span>driver<span class="token punctuation">.</span>page_source<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># å…³é”®ä¿®å¤ï¼šæ‰‹åŠ¨è°ƒç”¨è¯·æ±‚çš„å›è°ƒå‡½æ•°     </span></span>
<span class="line">        <span class="token comment"># å¦‚æœæ²¡æœ‰åŠæ³•è‡ªåŠ¨å›è°ƒ éœ€è¦æ‰‹åŠ¨è°ƒç”¨  </span></span>
<span class="line">        <span class="token keyword">if</span> request<span class="token punctuation">.</span>callback<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> request<span class="token punctuation">.</span>callback<span class="token punctuation">(</span>new_response<span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># åˆ›å»ºæ–°çš„å“åº”å¯¹è±¡</span></span>
<span class="line">        new_response <span class="token operator">=</span> HtmlResponse<span class="token punctuation">(</span></span>
<span class="line">            url<span class="token operator">=</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span></span>
<span class="line">            body<span class="token operator">=</span>page_text<span class="token punctuation">,</span></span>
<span class="line">            encoding<span class="token operator">=</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            request<span class="token operator">=</span>request</span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span> new_response</span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> response</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="drissionpage" tabindex="-1"><a class="header-anchor" href="#drissionpage"><span>DrissionPage</span></a></h3><p>ä¸ä¸Šåºçš„seleniumæ“ä½œä¸€æ ·çš„</p><h2 id="è‡ªåŠ¨æŠ“å–é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨æŠ“å–é“¾æ¥"><span>è‡ªåŠ¨æŠ“å–é“¾æ¥</span></a></h2><h3 id="åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€"><span>åŸºç¡€</span></a></h3><blockquote><p><code>from scrapy.spiders import CrawlSpider, Rule</code></p></blockquote><p>Scrapy æ¡†æ¶ä¸­ç”¨äºæ„å»º <strong>è§„åˆ™çˆ¬è™«ï¼ˆCrawlSpiderï¼‰</strong> çš„å…³é”®å¯¼å…¥è¯­å¥</p><ul><li><code>CrawlSpider</code> æ˜¯Scrapyæä¾›çš„ä¸€ä¸ªé€šç”¨çˆ¬è™«ï¼Œå…è®¸ä½ å®šä¹‰ä¸€äº›è§„åˆ™è¿›è¡Œè‡ªåŠ¨æå–é“¾æ¥å¹¶æ‰“å¼€é¡µé¢è·å–æ•°æ®</li><li>ç‰¹ç‚¹ï¼š <ul><li>è‡ªåŠ¨æ ¹æ®é¢„è®¾è§„åˆ™ï¼ˆ<code>Rule</code>ï¼‰æå–é¡µé¢ä¸­çš„é“¾æ¥ã€‚</li><li>é€‚åˆçˆ¬å–ç›®å½•å‹ç½‘ç«™ï¼ˆå¦‚æ–°é—»ç½‘ç«™ã€åšå®¢ã€ç”µå•†å•†å“åˆ—è¡¨ï¼‰</li></ul></li><li><code>Rule</code> å®šä¹‰çˆ¬è™«çš„é“¾æ¥æå–å’Œè·Ÿè¿›è§„åˆ™, ä¸»è¦åŒ…æ‹¬ï¼š <ul><li><strong>å¦‚ä½•ä»é¡µé¢æå–é“¾æ¥</strong>ï¼ˆä½¿ç”¨ <code>LinkExtractor</code>ï¼‰ã€‚</li><li><strong>æ˜¯å¦è·Ÿè¿›è¿™äº›é“¾æ¥</strong>ï¼ˆ<code>follow=True/False</code>ï¼‰ã€‚ <ul><li><code>True</code>: æå–é“¾æ¥å¯¹åº”çš„Aé¡µé¢ä¹‹å, ä¼šç»§ç»­ä½¿ç”¨ç›¸åŒçš„Rule,ä»Aé¡µé¢ä¸­æå–é“¾æ¥,å¹¶è·Ÿè¿›åˆ°ä¸‹ä¸€é¡µé¢ä¸­</li><li><code>False</code>: åªæå–ä¸€æ¬¡; <ul><li>ä¼šæå–é“¾æ¥,å¹¶æå–é“¾æ¥å¯¹åº”çš„é¡µé¢, ä½†ä¸ä¼šä»è¿™ä¸ªé¡µé¢ä¸­ç»§ç»­æå–é“¾æ¥å¹¶è·Ÿè¿›</li><li>æ‰§è¡Œ <code>callback</code> æŒ‡å®šçš„è§£æå‡½æ•°å¤„ç†è¿™ä¸ªé¡µé¢</li></ul></li></ul></li><li><strong>å¦‚ä½•å¤„ç†æå–çš„é“¾æ¥</strong>ï¼ˆå›è°ƒå‡½æ•° <code>callback</code>ï¼‰ã€‚</li></ul></li></ul><blockquote><p><code>from scrapy.linkextractors import LinkExtractor</code></p></blockquote><p>æ˜¯ Scrapy æ¡†æ¶ä¸­ç”¨äº <strong>ä»ç½‘é¡µä¸­è‡ªåŠ¨æå–é“¾æ¥</strong> çš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šå¸¸ä¸ <code>CrawlSpider</code> å’Œ <code>Rule</code> é…åˆä½¿ç”¨</p><ul><li><p><code>LinkExtractor</code>: å®šä¹‰å¦‚ä½•ä»é¡µé¢æå–é“¾æ¥ã€‚</p><ul><li><p>ç”¨XPathé™å®šæå–é“¾æ¥çš„åŒºåŸŸ</p><ul><li>restrict_xpaths=&#39;//div[@class=&quot;pagination&quot;]&#39;</li></ul></li><li><p>ç”¨CSSé€‰æ‹©å™¨é™å®šæå–åŒºåŸŸ</p><ul><li>restrict_css=&#39;.pagination&#39;</li></ul></li><li><p>ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å…è®¸çš„é“¾æ¥</p><ul><li>allow=r&#39;/product/\\d+&#39;ï¼ˆåŒ¹é… /product/123/ï¼‰</li></ul></li></ul></li></ul><h3 id="ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨"><span>ä½¿ç”¨</span></a></h3><h4 id="åˆ†é¡µè·å–" tabindex="-1"><a class="header-anchor" href="#åˆ†é¡µè·å–"><span>åˆ†é¡µè·å–</span></a></h4><ul><li>parseæ˜¯é»˜è®¤æ‰§è¡Œå‡½æ•°,ç”¨äºå¤„ç†ruleè§„åˆ™,ä¸å¯ä¿®æ”¹</li><li><strong><code>parse_start_url</code></strong> : ä¸“é—¨å¤„ç† <code>start_urls </code>ä¸­çš„åˆå§‹é¡µé¢</li><li>æ²¡æœ‰è¯¦æƒ…çš„æ—¶å€™,ä¼šä½¿ç”¨</li></ul><p><code>handles_message</code>å‡½æ•°è·å–çš„æ˜¯ç¬¬äºŒé¡µçš„æ•°æ®,</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># é€šè¿‡LinkExtractorè¿›è¡Œè‡ªåŠ¨ç¿»é¡µ</span></span>
<span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> CrawlSpider<span class="token punctuation">,</span> Rule</span>
<span class="line"><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>linkextractors <span class="token keyword">import</span> LinkExtractor</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ExampleSpider</span><span class="token punctuation">(</span>CrawlSpider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;example&quot;</span></span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;toscrape.com&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://books.toscrape.com/&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    rules <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">        Rule<span class="token punctuation">(</span></span>
<span class="line">            LinkExtractor<span class="token punctuation">(</span></span>
<span class="line">                <span class="token comment"># ä¼šè‡ªåŠ¨æå–è¿™ä¸ªaæ ‡ç­¾çš„href</span></span>
<span class="line">                restrict_xpaths<span class="token operator">=</span><span class="token string">&#39;//li[@class=&quot;next&quot;]/a&#39;</span></span>
<span class="line">            <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            callback<span class="token operator">=</span><span class="token string">&#39;handles_message&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token comment"># true é€šè¿‡é“¾æ¥è·å–å½“å‰é¡µé¢ä¹‹å,åœ¨è·å–å½“å‰é¡µé¢çš„ä¸‹æ¬¡</span></span>
<span class="line">            <span class="token comment"># è¿æ¥è¿›è¡Œæ‰“å¼€,</span></span>
<span class="line">            follow<span class="token operator">=</span><span class="token boolean">True</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">    </span>
<span class="line">     <span class="token comment"># é¦–é¡µçš„æ•°æ®ä¼šè¿›å…¥æ­¤å¤„</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse_start_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token triple-quoted-string string">&quot;&quot;&quot;ä¸“é—¨å¤„ç†èµ·å§‹URLï¼ˆé¦–é¡µï¼‰&quot;&quot;&quot;</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>parse_page<span class="token punctuation">(</span>response<span class="token punctuation">)</span>  <span class="token comment"># è°ƒç”¨é€šç”¨é¡µé¢è§£æ</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># é€šç”¨è§£æ åªä¼šç¬¬äºŒé¡µçš„æ•°æ®, ç¬¬ä¸€é¡µä¸ä¼šè·å–</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">handles_message</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># è‡ªåŠ¨è¿›è¡Œç¿»é¡µå¤„ç†</span></span>
<span class="line">        title <span class="token operator">=</span> res<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token string">&quot;æ•°æ®&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;============&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è¯¦æƒ…é¡µé¢æ•°æ®" tabindex="-1"><a class="header-anchor" href="#è¯¦æƒ…é¡µé¢æ•°æ®"><span>è¯¦æƒ…é¡µé¢æ•°æ®</span></a></h4><p>åœ¨è¯¦æƒ…é¡µé¢è·å–æ‰€æœ‰æ•°æ®, ä¸éœ€è¦é¦–é¡µè®¾ç½®</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># æ­£å¸¸æƒ…å†µä¸‹, è¯¦æƒ…é¡µå¯ä»¥è·å–åˆ°æ‰€æœ‰çš„æ•°æ®, ç¿»é¡µä¸­ä¸éœ€è¦è·å–æ•°æ®</span></span>
<span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"><span class="token keyword">from</span> dianying<span class="token punctuation">.</span>items <span class="token keyword">import</span> DianyingItem</span>
<span class="line"><span class="token keyword">import</span> re</span>
<span class="line"><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> CrawlSpider<span class="token punctuation">,</span> Rule</span>
<span class="line"><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>linkextractors <span class="token keyword">import</span> LinkExtractor</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ExampleSpider</span><span class="token punctuation">(</span>CrawlSpider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;example&quot;</span></span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;toscrape.com&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://books.toscrape.com/&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    rules <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token comment"># è·å–è¯¦æƒ…é¡µé¢</span></span>
<span class="line">        Rule<span class="token punctuation">(</span></span>
<span class="line">            LinkExtractor<span class="token punctuation">(</span></span>
<span class="line">                <span class="token comment"># ä¼šè‡ªåŠ¨æå–è¿™ä¸ªaæ ‡ç­¾çš„href</span></span>
<span class="line">                restrict_xpaths<span class="token operator">=</span><span class="token string">&#39;//article[@class=&quot;product_pod&quot;]/h3/a&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            callback<span class="token operator">=</span><span class="token string">&quot;handler_message_info&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            follow<span class="token operator">=</span><span class="token boolean">False</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token comment"># è·å–ç¿»é¡µè¿æ¥</span></span>
<span class="line">        Rule<span class="token punctuation">(</span></span>
<span class="line">            LinkExtractor<span class="token punctuation">(</span></span>
<span class="line">                <span class="token comment"># ä¼šè‡ªåŠ¨æå–è¿™ä¸ªaæ ‡ç­¾çš„href</span></span>
<span class="line">                LinkExtractor<span class="token punctuation">(</span>restrict_css<span class="token operator">=</span><span class="token string">&quot;.next a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            follow<span class="token operator">=</span><span class="token boolean">True</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">handler_message_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        items <span class="token operator">=</span> DianyingItem<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        price <span class="token operator">=</span> res<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        items<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> price</span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> <span class="token string">&quot;ä»·æ ¼&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">yield</span> items</span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åˆ†é¡µå’Œè¯¦æƒ…åŒæ—¶" tabindex="-1"><a class="header-anchor" href="#åˆ†é¡µå’Œè¯¦æƒ…åŒæ—¶"><span>åˆ†é¡µå’Œè¯¦æƒ…åŒæ—¶</span></a></h4><ul><li>å°†ä¸Šåºçš„åˆ†é¡µå’Œè¯¦æƒ…ä¸€èµ·è®¾ç½®</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">rules <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token comment"># è·å–è¯¦æƒ…é¡µé¢</span></span>
<span class="line">    Rule<span class="token punctuation">(</span></span>
<span class="line">        LinkExtractor<span class="token punctuation">(</span></span>
<span class="line">            restrict_xpaths<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        callback<span class="token operator">=</span><span class="token string">&quot;page_next&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        follow<span class="token operator">=</span><span class="token boolean">False</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment"># è·å–ç¿»é¡µè¿æ¥</span></span>
<span class="line">    Rule<span class="token punctuation">(</span></span>
<span class="line">        LinkExtractor<span class="token punctuation">(</span>restrict_css<span class="token operator">=</span><span class="token string">&quot;.next a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        callback<span class="token operator">=</span><span class="token string">&quot;handles_message&quot;</span><span class="token punctuation">,</span> </span>
<span class="line">        follow<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> </span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># é¦–é¡µçš„æ•°æ®ä¼šè¿›å…¥æ­¤å¤„</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">parse_start_url</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;ä¸“é—¨å¤„ç†èµ·å§‹URLï¼ˆé¦–é¡µï¼‰&quot;&quot;&quot;</span></span>
<span class="line">    <span class="token keyword">return</span> self<span class="token punctuation">.</span>handles_message<span class="token punctuation">(</span>response<span class="token punctuation">)</span>  <span class="token comment"># è°ƒç”¨é€šç”¨é¡µé¢è§£æ</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç¿»é¡µè§£æ </span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">handles_message</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># è‡ªåŠ¨è¿›è¡Œç¿»é¡µå¤„ç†</span></span>
<span class="line">    title <span class="token operator">=</span> res<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token string">&quot;æ•°æ®&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;============&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è¯¦æƒ…è§£æ</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">page_next</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status<span class="token punctuation">,</span> <span class="token string">&quot;çŠ¶æ€ç &quot;</span><span class="token punctuation">)</span></span>
<span class="line">        title <span class="token operator">=</span> res<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> <span class="token string">&quot;æ•°æ®&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç”µå½±æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#ç”µå½±æ¡ˆä¾‹"><span>ç”µå½±æ¡ˆä¾‹</span></a></h3><blockquote><p>https://login2.scrape.center/login</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"> rules <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token comment"># è·å–è¯¦æƒ…é¡µé¢</span></span>
<span class="line">        Rule<span class="token punctuation">(</span></span>
<span class="line">            LinkExtractor<span class="token punctuation">(</span></span>
<span class="line">                <span class="token comment"># ä¼šè‡ªåŠ¨æå–è¿™ä¸ªaæ ‡ç­¾çš„href</span></span>
<span class="line">                restrict_xpaths<span class="token operator">=</span><span class="token string">&#39;//a[@class=&quot;name&quot;]&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            callback<span class="token operator">=</span><span class="token string">&quot;handler_message_info&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            follow<span class="token operator">=</span><span class="token boolean">False</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token comment"># è·å–ç¿»é¡µè¿æ¥</span></span>
<span class="line">        Rule<span class="token punctuation">(</span></span>
<span class="line">            LinkExtractor<span class="token punctuation">(</span></span>
<span class="line">                <span class="token comment"># ä¼šè‡ªåŠ¨æå–è¿™ä¸ªaæ ‡ç­¾çš„href</span></span>
<span class="line">                restrict_css<span class="token operator">=</span><span class="token string">&#39;.el-pager+a&#39;</span></span>
<span class="line">            <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            follow<span class="token operator">=</span><span class="token boolean">True</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">handler_message_info</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        items <span class="token operator">=</span> DianyingItem<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        price <span class="token operator">=</span> res<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//h2[@class=&quot;m-b-sm&quot;]/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        items<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> price</span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> <span class="token string">&quot;ä»·æ ¼&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">yield</span> items</span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,138)])])}const o=n(t,[["render",l]]),u=JSON.parse('{"path":"/spider/09-Scrapy.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"scrapyçš„æ¦‚å¿µ","slug":"scrapyçš„æ¦‚å¿µ","link":"#scrapyçš„æ¦‚å¿µ","children":[]},{"level":2,"title":"çˆ¬è™«å·¥ä½œæµç¨‹","slug":"çˆ¬è™«å·¥ä½œæµç¨‹","link":"#çˆ¬è™«å·¥ä½œæµç¨‹","children":[{"level":3,"title":"scrapyçš„æµç¨‹","slug":"scrapyçš„æµç¨‹","link":"#scrapyçš„æµç¨‹","children":[]},{"level":3,"title":"Scrapy","slug":"scrapy","link":"#scrapy","children":[]},{"level":3,"title":"çˆ¬å–æ•°æ®","slug":"çˆ¬å–æ•°æ®","link":"#çˆ¬å–æ•°æ®","children":[]},{"level":3,"title":"Shellæµ‹è¯•","slug":"shellæµ‹è¯•","link":"#shellæµ‹è¯•","children":[]}]},{"level":2,"title":"scrapyè¿›é˜¶","slug":"scrapyè¿›é˜¶","link":"#scrapyè¿›é˜¶","children":[{"level":3,"title":"postè¯·æ±‚","slug":"postè¯·æ±‚","link":"#postè¯·æ±‚","children":[]},{"level":3,"title":"Cookieè®¾ç½®","slug":"cookieè®¾ç½®","link":"#cookieè®¾ç½®","children":[]},{"level":3,"title":"scrapyé…ç½®","slug":"scrapyé…ç½®","link":"#scrapyé…ç½®","children":[]},{"level":3,"title":"ç®¡é“è®¾ç½®","slug":"ç®¡é“è®¾ç½®","link":"#ç®¡é“è®¾ç½®","children":[]},{"level":3,"title":"ä¸­é—´ä»¶è®¾ç½®","slug":"ä¸­é—´ä»¶è®¾ç½®","link":"#ä¸­é—´ä»¶è®¾ç½®","children":[]},{"level":3,"title":"è¯·æ±‚ä»£ç†","slug":"è¯·æ±‚ä»£ç†","link":"#è¯·æ±‚ä»£ç†","children":[]}]},{"level":2,"title":"seleniumå’ŒDirssionPage","slug":"seleniumå’Œdirssionpage","link":"#seleniumå’Œdirssionpage","children":[{"level":3,"title":"selenium","slug":"selenium","link":"#selenium","children":[]},{"level":3,"title":"DrissionPage","slug":"drissionpage","link":"#drissionpage","children":[]}]},{"level":2,"title":"è‡ªåŠ¨æŠ“å–é“¾æ¥","slug":"è‡ªåŠ¨æŠ“å–é“¾æ¥","link":"#è‡ªåŠ¨æŠ“å–é“¾æ¥","children":[{"level":3,"title":"åŸºç¡€","slug":"åŸºç¡€","link":"#åŸºç¡€","children":[]},{"level":3,"title":"ä½¿ç”¨","slug":"ä½¿ç”¨","link":"#ä½¿ç”¨","children":[]},{"level":3,"title":"ç”µå½±æ¡ˆä¾‹","slug":"ç”µå½±æ¡ˆä¾‹","link":"#ç”µå½±æ¡ˆä¾‹","children":[]}]}],"git":{},"filePathRelative":"spider/09-Scrapy.md"}');export{o as comp,u as data};
