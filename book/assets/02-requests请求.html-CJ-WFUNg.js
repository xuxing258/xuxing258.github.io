import{_ as n,c as a,a as p,o as e}from"./app-B89-99AF.js";const t={};function l(i,s){return e(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="requests" tabindex="-1"><a class="header-anchor" href="#requests"><span>requests</span></a></h2><p><code>requests</code>是一个广泛使用的 HTTP 库，由 Kenneth Reitz 开发。它简化了 Python 与 HTTP 协议的交互，使得发送各种 HTTP 请求变得轻而易举，避免了使用 Python 标准库<code>urllib</code>时复杂的操作，极大地提升了开发效率</p><div class="language-npm line-numbers-mode" data-highlighter="prismjs" data-ext="npm"><pre><code><span class="line">pip install requests</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="初步使用" tabindex="-1"><a class="header-anchor" href="#初步使用"><span>初步使用</span></a></h3><blockquote><p>以搜索引擎为示例进行爬取网页数据</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> requests</span>
<span class="line">respones <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://www.sogou.com/&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>  <span class="token comment">#  .status_code 查看响应状态码</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  <span class="token comment"># 查看网页内容 </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>200 请求成功</li><li>301 302 请求发生跳转</li><li>404 页面没找到</li><li>500 502 503服务器内部错误</li></ul><blockquote><p>User-Agent: 表示用户用什么设备发起请求, 设置后进行伪装让后端不在让认为你是一个自动化程序</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 搜狗网站首页搜索</span></span>
<span class="line">url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&#39;https://www.sogou.com/web?query=</span><span class="token interpolation"><span class="token punctuation">{</span>val<span class="token punctuation">}</span></span><span class="token string">&#39;</span></span></span>
<span class="line"><span class="token comment">#  设置后进行伪装让后端不在让认为你是一个自动化程序, 处理一个小小的反爬</span></span>
<span class="line">headers <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">)</span> <span class="token comment"># 查看请求头  未设置UA时:不是正常的设置请求数据</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="请求类型" tabindex="-1"><a class="header-anchor" href="#请求类型"><span>请求类型</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;http://httpbin.org/get&#39;</span><span class="token punctuation">)</span>   <span class="token comment"># GET请求</span></span>
<span class="line">requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&#39;http://httpbin.org/post&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># POST请求</span></span>
<span class="line">requests<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">&#39;http://httpbin.org/put&#39;</span><span class="token punctuation">)</span></span>
<span class="line">requests<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token string">&#39;http://httpbin.org/delete&#39;</span><span class="token punctuation">)</span></span>
<span class="line">requests<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token string">&#39;http://httpbin.org/get&#39;</span><span class="token punctuation">)</span></span>
<span class="line">requests<span class="token punctuation">.</span>options<span class="token punctuation">(</span><span class="token string">&#39;http://httpbin.org/get&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="get请求数据" tabindex="-1"><a class="header-anchor" href="#get请求数据"><span>GET请求数据</span></a></h3><blockquote><p>查询GET参数</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;http://httpbin.org/get?name=66&amp;age=18&#39;</span><span class="token punctuation">)</span>  </span>
<span class="line"><span class="token comment"># 自适应网站</span></span>
<span class="line">url1 <span class="token operator">=</span> <span class="token string">&#39;http://httpbin.org/get&#39;</span></span>
<span class="line">resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url1<span class="token punctuation">,</span>params<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>  </span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  <span class="token comment"># 获取文本字符串</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取json格式</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 获取json数据格式  </span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 通过属性名取值就知道.是否为json了</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="post请求携带数据" tabindex="-1"><a class="header-anchor" href="#post请求携带数据"><span>post请求携带数据</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> json</span>
<span class="line"><span class="token comment"># 百度翻译</span></span>
<span class="line">url <span class="token operator">=</span> <span class="token string">&#39;https://fanyi.baidu.com/sug&#39;</span></span>
<span class="line">haha <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;kw&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;dog&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> data<span class="token operator">=</span>haha<span class="token punctuation">)</span>  <span class="token comment"># data参数:携带POST请求参数</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>  <span class="token comment"># .status_code 查看响应状态码</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  <span class="token comment"># 获取文本字符串</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取json数据格式</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 获取json数据格式  </span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="二进制数据" tabindex="-1"><a class="header-anchor" href="#二进制数据"><span>二进制数据</span></a></h3><p>图片/pdf/视频为二进制数据, <code>bytes</code> 类型是一种不可变的数据类型，用于表示二进制数据</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"><span class="token comment"># 请求图片地址</span></span>
<span class="line">r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://img0.baidu.com/it/u=2852563613,929482691&amp;fm=253&amp;fmt=auto&amp;app=138&amp;f=JPEG?w=800&amp;h=1400&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>  <span class="token comment"># 乱码 </span></span>
<span class="line"></span>
<span class="line">data <span class="token operator">=</span> r<span class="token punctuation">.</span>content   <span class="token comment"># .content获取二进制数据 </span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># bytes 二进制数据格式</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将数据保存到本地</span></span>
<span class="line"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&#39;bbtp.gif&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;wb&#39;</span><span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span> </span>
<span class="line">    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="response属性" tabindex="-1"><a class="header-anchor" href="#response属性"><span>response属性</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"><span class="token comment"># 简书</span></span>
<span class="line">url <span class="token operator">=</span> <span class="token string">&#39;http://www.jianshu.com&#39;</span></span>
<span class="line">headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&#39;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span></span>
<span class="line">r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span> </span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>headers<span class="token punctuation">)</span> <span class="token comment"># 查看响应头信息</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token comment"># 查看url</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="高级操作" tabindex="-1"><a class="header-anchor" href="#高级操作"><span>高级操作</span></a></h2><p>写爬虫的时候,有一些网站你必须登录之后才能进行访问, 存在这种需求的时候你就必须要先登录才能访问,http/https 协议 是一种无状态的协议，对事物处理无记忆功能的,那么我们的浏览器是如何来记录这个登录的过程, 需要通过cookie来完成</p><h3 id="cookie维持会话" tabindex="-1"><a class="header-anchor" href="#cookie维持会话"><span>cookie维持会话</span></a></h3><p>通过cookie设置用户信息（账号+密码） 只是维持登录状态</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"><span class="token comment"># 将cookie的身份信息放入了 </span></span>
<span class="line">headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;cookie&#39;</span><span class="token punctuation">:</span><span class="token string">&#39;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">:</span> <span class="token string">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36&#39;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 17k小说网站   需要设置登录之后设置cookie才能获取到对应的数据</span></span>
<span class="line">resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://user.17k.com/ck/author2/shelf?page=1&amp;appKey=2406394919&quot;</span><span class="token punctuation">,</span>headers <span class="token operator">=</span> headers<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 未设置cookie 会返回未登录</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>直接使用<code>Cookies</code>请求时，需要手动管理<code>Cookies</code>。你要明确获取<code>Cookies</code>信息，并在每次请求时将其添加到请求中, 后续cookie发生变化时,也需要重新设置</p><h3 id="session会话连接" tabindex="-1"><a class="header-anchor" href="#session会话连接"><span>session会话连接</span></a></h3><p>会话能让我们在跨请求时候保持某些参数，比如在同一个 Session 实例发出的所有请求之间保持 cookie</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 视频网址 https://login2.scrape.center/  必须先登录</span></span>
<span class="line"></span>
<span class="line">ssion<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;登录接口&quot;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> requests  <span class="token comment"># https://login2.scrape.center/login</span></span>
<span class="line"><span class="token comment"># 创建session对象，可以保存Cookie值</span></span>
<span class="line">ssion <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 处理 headers</span></span>
<span class="line">headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 需要登录的用户名和密码</span></span>
<span class="line">data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span>  </span>
<span class="line"></span>
<span class="line"><span class="token comment"># 发送附带用户名和密码的请求，并获取登录后的Cookie值，保存在ssion里</span></span>
<span class="line">ssion<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;https://login2.scrape.center/login&quot;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ssion包含用户登录后的Cookie值，可以直接访问那些登录后才可以访问的页面</span></span>
<span class="line">response <span class="token operator">=</span> ssion<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://login2.scrape.center/detail/2&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#  打印响应内容</span></span>
<span class="line"><span class="token keyword">print</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Session<code>是</code>requests<code>库中用于管理会话的对象，它会自动处理和管理</code>Cookies<code>。在一个</code>Session<code>对象中发起的多次请求，</code>Session<code>会自动保存服务器返回的</code>Cookies<code>，并在后续请求中自动携带这些</code>Cookies</p><p>能一直保持通信</p><h3 id="超时设置" tabindex="-1"><a class="header-anchor" href="#超时设置"><span>超时设置</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">url<span class="token operator">=</span> <span class="token string">&#39;https://www.baidu.com&#39;</span></span>
<span class="line">r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout <span class="token operator">=</span><span class="token number">0.00000001</span><span class="token punctuation">)</span>  <span class="token comment"># 秒  timeout =(30,30) 请求 响应</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="异常处理" tabindex="-1"><a class="header-anchor" href="#异常处理"><span>异常处理</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">try</span><span class="token punctuation">:</span>  <span class="token comment"># 处理异常，可能出现异常的代码都写在try方法里面</span></span>
<span class="line">    url<span class="token operator">=</span> <span class="token string">&#39;https://www.baidu.com&#39;</span></span>
<span class="line">    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout <span class="token operator">=</span> <span class="token number">0.00000000001</span><span class="token punctuation">)</span>  <span class="token comment"># 秒</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">except</span><span class="token punctuation">:</span> <span class="token comment"># 出现异常怎么处理</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;timeout!&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="案例" tabindex="-1"><a class="header-anchor" href="#案例"><span>案例</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> requests </span>
<span class="line"><span class="token comment"># 1\\. 创建session对象，可以保存Cookie值</span></span>
<span class="line">ssion <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2\\. 处理 headers</span></span>
<span class="line">headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;User-Agent&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3\\. 需要登录的用户名和密码</span></span>
<span class="line">data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span>  </span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4\\. 发送附带用户名和密码的请求，并获取登录后的Cookie值，保存在ssion里</span></span>
<span class="line">ssion<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">&quot;https://login2.scrape.center/login&quot;</span><span class="token punctuation">,</span> data <span class="token operator">=</span> data<span class="token punctuation">,</span>headers <span class="token operator">=</span> headers<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 5\\. ssion包含用户登录后的Cookie值，可以直接访问那些登录后才可以访问的页面</span></span>
<span class="line">response <span class="token operator">=</span> ssion<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://login2.scrape.center/detail/2&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 6\\. 打印响应页面内容</span></span>
<span class="line"><span class="token keyword">print</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取对应的数据</span></span>
<span class="line">data <span class="token operator">=</span> response<span class="token punctuation">.</span>text</span>
<span class="line"><span class="token comment"># 解析对应的页面</span></span>
<span class="line">xml <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 通过xpath获取对于的文本内容</span></span>
<span class="line">title <span class="token operator">=</span> xml<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//*[@id=&quot;detail&quot;]/div[1]/div/div/div[1]/div/div[2]/a/h2//text()&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="代理设置" tabindex="-1"><a class="header-anchor" href="#代理设置"><span>代理设置</span></a></h3><p>通过代理被封ip无法爬取数据</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 获取私密代理IP API   根据快代理文档书写</span></span>
<span class="line"><span class="token keyword">import</span> requests</span>
<span class="line">api <span class="token operator">=</span> <span class="token string">&quot;https://dps.kdlapi.com/api/getdps&quot;</span></span>
<span class="line"><span class="token comment"># 请求参数</span></span>
<span class="line">params <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;secret_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;o4zsfebj9j4nm0izhp7s&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;signature&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ocoxalcpllkatvl57beyisep1vzj58p8&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;num&quot;</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>   <span class="token comment"># 提取数量</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment"># 获取响应内容</span></span>
<span class="line">response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>api<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token comment"># 获取私密请求的ip地址</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 进行代理认证</span></span>
<span class="line">proxy_ip<span class="token punctuation">,</span> proxy_port <span class="token operator">=</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 分</span></span>
<span class="line">proxy_user <span class="token operator">=</span> <span class="token string">&quot;d2089925381&quot;</span>  <span class="token comment"># 快代理订单备注中的用户名</span></span>
<span class="line">proxy_pass <span class="token operator">=</span> <span class="token string">&quot;8ujkam0p&quot;</span>  <span class="token comment"># 快代理订单备注中的密码</span></span>
<span class="line">proxy_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;http://</span><span class="token interpolation"><span class="token punctuation">{</span>proxy_user<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>proxy_pass<span class="token punctuation">}</span></span><span class="token string">@</span><span class="token interpolation"><span class="token punctuation">{</span>proxy_ip<span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span>proxy_port<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>  <span class="token comment"># 设置代理地址</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 代理配置</span></span>
<span class="line">p <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&#39;http&#39;</span><span class="token punctuation">:</span> proxy_url<span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;https&#39;</span><span class="token punctuation">:</span> proxy_url<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment"># 进行请求</span></span>
<span class="line">response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://httpbin.org/ip&quot;</span><span class="token punctuation">,</span> proxies<span class="token operator">=</span> p<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"><span class="token comment"># 提取代理API接口，获取1个代理IP</span></span>
<span class="line">api_url <span class="token operator">=</span> <span class="token string">&quot;https://dps.kdlapi.com/api/getdps/?secret_id=o4zsfebj9j4nm0izhp7s&amp;signature=ocoxalcpllkatvl57beyisep1vzj58p8&amp;num=1&amp;sep=1&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取API接口返回的代理IP</span></span>
<span class="line">proxy_ip <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>api_url<span class="token punctuation">)</span><span class="token punctuation">.</span>text</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 用户名密码认证(私密代理/独享代理)</span></span>
<span class="line">username <span class="token operator">=</span> <span class="token string">&quot;d2089925381&quot;</span></span>
<span class="line">password <span class="token operator">=</span> <span class="token string">&quot;8ujkam0p&quot;</span></span>
<span class="line">proxies <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;http&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://%(user)s:%(pwd)s@%(proxy)s/&quot;</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">&quot;pwd&quot;</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span> <span class="token string">&quot;proxy&quot;</span><span class="token punctuation">:</span> proxy_ip<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;https&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://%(user)s:%(pwd)s@%(proxy)s/&quot;</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">&quot;pwd&quot;</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span> <span class="token string">&quot;proxy&quot;</span><span class="token punctuation">:</span> proxy_ip<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 要访问的目标网页</span></span>
<span class="line">target_url <span class="token operator">=</span> <span class="token string">&quot;https://dev.kdlapi.com/testproxy&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 使用代理IP发送请求</span></span>
<span class="line">response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>target_url<span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取页面内容</span></span>
<span class="line"><span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,42)])])}const c=n(t,[["render",l]]),u=JSON.parse('{"path":"/spider/02-requests%E8%AF%B7%E6%B1%82.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"requests","slug":"requests","link":"#requests","children":[{"level":3,"title":"初步使用","slug":"初步使用","link":"#初步使用","children":[]},{"level":3,"title":"请求类型","slug":"请求类型","link":"#请求类型","children":[]},{"level":3,"title":"GET请求数据","slug":"get请求数据","link":"#get请求数据","children":[]},{"level":3,"title":"post请求携带数据","slug":"post请求携带数据","link":"#post请求携带数据","children":[]},{"level":3,"title":"二进制数据","slug":"二进制数据","link":"#二进制数据","children":[]},{"level":3,"title":"response属性","slug":"response属性","link":"#response属性","children":[]}]},{"level":2,"title":"高级操作","slug":"高级操作","link":"#高级操作","children":[{"level":3,"title":"cookie维持会话","slug":"cookie维持会话","link":"#cookie维持会话","children":[]},{"level":3,"title":"session会话连接","slug":"session会话连接","link":"#session会话连接","children":[]},{"level":3,"title":"超时设置","slug":"超时设置","link":"#超时设置","children":[]},{"level":3,"title":"异常处理","slug":"异常处理","link":"#异常处理","children":[]}]},{"level":2,"title":"案例","slug":"案例","link":"#案例","children":[{"level":3,"title":"代理设置","slug":"代理设置","link":"#代理设置","children":[]}]}],"git":{},"filePathRelative":"spider/02-requests请求.md"}');export{c as comp,u as data};
