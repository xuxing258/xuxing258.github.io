import{_ as n,c as a,a as e,o as p}from"./app-DLp8zu_T.js";const t={};function l(i,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="cookie和session" tabindex="-1"><a class="header-anchor" href="#cookie和session"><span>cookie和session</span></a></h1><p>http协议是一个无状态的协议.无状态的意思就是每次请求都是独立的.他的执行情况和结果与前面的请求和后面的请求都没有直接关系.不受前面的请求响应影响,也不会影响后面的请求响应情况.</p><p>状态可以理解为客户端和服务器在交互的过程中产生的数据,无状态的意思就是这些数据不会被保存.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">以登录功能为例<span class="token punctuation">:</span>如果不保存用户登录状态<span class="token punctuation">,</span>也就意味着每次访问网站都需要重复输入用户名和密码</span>
<span class="line">    早期<span class="token punctuation">:</span></span>
<span class="line">        当用户第一次登录成功之后<span class="token punctuation">,</span>将用户的用户名和密码返回给浏览器<span class="token punctuation">,</span>让浏览器保存在本地<span class="token punctuation">.</span>之后访问网站的时候浏览器自动将保存在浏览器上的用户名和密码发送给服务端<span class="token punctuation">,</span>服务端获取之后自动校验</span>
<span class="line">        </span>
<span class="line">    优化<span class="token punctuation">:</span></span>
<span class="line">        当用户登录成功之后<span class="token punctuation">,</span>服务器产生一个随机字符串交给客户端浏览器保存</span>
<span class="line">        服务器上保存数据<span class="token punctuation">,</span>以kv键值对的形式<span class="token punctuation">:</span></span>
<span class="line">        	随机字符串<span class="token punctuation">:</span>用户相关信息</span>
<span class="line">        之后访问服务器时<span class="token punctuation">,</span>都带着这个随机字符串<span class="token punctuation">,</span>服务端比对数据库中是否有对应的随机字符串<span class="token punctuation">,</span>如果有就获取对应的用户相关信息</span>
<span class="line">        </span>
<span class="line"><span class="token punctuation">(</span>除了保存用户登录状态信息之外<span class="token punctuation">,</span>还可以利用cookie和session将一个变量从一个视图函数传递给另一个视图函数使用<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="cookie" tabindex="-1"><a class="header-anchor" href="#cookie"><span>cookie</span></a></h2><p>​ 一段小信息,是服务器发送出来的保存在浏览器上的一组组键值对</p><p>​ 服务器保存在浏览器上的信息都可以称之为cookie</p><h3 id="cookie操作" tabindex="-1"><a class="header-anchor" href="#cookie操作"><span>cookie操作</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">obj <span class="token operator">=</span> HttpRepsonse<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 利用返回值对象操作cookie</span></span>
<span class="line">obj<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">return</span> obj</span>
<span class="line"></span>
<span class="line">obj1 <span class="token operator">=</span> render<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">obj1<span class="token punctuation">.</span>操作cookie<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">return</span> obj1</span>
<span class="line"></span>
<span class="line">obj2 <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">obj2<span class="token punctuation">.</span>操作cookie<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">return</span> obj2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 设置cookie</span></span>
<span class="line"><span class="token comment"># obj.set_cookie(k, v)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">&#39;admin&#39;</span> <span class="token keyword">and</span> password <span class="token operator">==</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 跳转到一个需要用户登录之后才能看的页面</span></span>
<span class="line">            obj <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/home/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment"># 让浏览器保存cookie数据</span></span>
<span class="line">            obj<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> obj</span>
<span class="line">    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;login.html&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取cookie</span></span>
<span class="line"><span class="token comment"># request.COOKIES.get(k)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 获取cookie信息</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;这个是home页面,需要登录才能进来&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 没有登录应该跳转到登录页面</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>多个视图函数需要进行登录校验</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 登录认证的装饰器</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 在调用函数之前</span></span>
<span class="line">        <span class="token keyword">if</span> request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">:</span></span>
<span class="line">            obj <span class="token operator">=</span> func<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            obj <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 调用函数之后</span></span>
<span class="line">        <span class="token keyword">return</span> obj</span>
<span class="line">    <span class="token keyword">return</span> inner</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 其他需要认证的视图函数</span></span>
<span class="line"><span class="token decorator annotation punctuation">@outer</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;这个是home页面,需要登录才能进来&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@outer</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;这个是func页面,需要登录才能进来&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>登录功能优化</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 用户在没有登录的情况下想访问某一个需要登录的页面时,那么会先跳转到登录页面,用户输入用户名密码登录成功之后,应该跳转到用户之前想要访问的页面去,而不是每次登录成功默认到home页面</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 登录认证装饰器</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 获取用户上次访问的地址</span></span>
<span class="line">        target_url <span class="token operator">=</span> request<span class="token punctuation">.</span>get_full_path<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># /func/</span></span>
<span class="line">        <span class="token comment"># 在调用函数之前</span></span>
<span class="line">        <span class="token keyword">if</span> request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">:</span></span>
<span class="line">            obj <span class="token operator">=</span> func<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 在这里告诉用户上次访问的地址是什么</span></span>
<span class="line">            obj <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/?next=%s&#39;</span> <span class="token operator">%</span> target_url<span class="token punctuation">)</span>  <span class="token comment"># /login/?next=/func/</span></span>
<span class="line">        <span class="token comment"># 调用函数之后</span></span>
<span class="line">        <span class="token keyword">return</span> obj</span>
<span class="line">    <span class="token keyword">return</span> inner</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 登录功能</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">&#39;admin&#39;</span> <span class="token keyword">and</span> password <span class="token operator">==</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 获取用户上次访问的地址:# /login/?next=/func/</span></span>
<span class="line">            target_url <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;next&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment"># 跳转到一个需要用户登录之后才能看的页面</span></span>
<span class="line">            <span class="token keyword">if</span> target_url<span class="token punctuation">:</span></span>
<span class="line">                obj <span class="token operator">=</span> redirect<span class="token punctuation">(</span>target_url<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 没有上次访问的地址,默认返回到home页面</span></span>
<span class="line">                obj <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/home/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment"># 让浏览器保存cookie数据</span></span>
<span class="line">            obj<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> obj</span>
<span class="line">    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;login.html&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="设置过期时间" tabindex="-1"><a class="header-anchor" href="#设置过期时间"><span>设置过期时间</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># obj.set_cookie(k, v, max_age=秒)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">&#39;admin&#39;</span> <span class="token keyword">and</span> password <span class="token operator">==</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 获取用户上次访问的地址:# /login/?next=/func/</span></span>
<span class="line">            target_url <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;next&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment"># 跳转到一个需要用户登录之后才能看的页面</span></span>
<span class="line">            <span class="token keyword">if</span> target_url<span class="token punctuation">:</span></span>
<span class="line">                obj <span class="token operator">=</span> redirect<span class="token punctuation">(</span>target_url<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 没有上次访问的地址,默认返回到home页面</span></span>
<span class="line">                obj <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/home/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment"># 让浏览器保存cookie数据</span></span>
<span class="line">            obj<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 超过10秒过期</span></span>
<span class="line">            <span class="token keyword">return</span> obj</span>
<span class="line">    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;login.html&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除cookie" tabindex="-1"><a class="header-anchor" href="#删除cookie"><span>删除cookie</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># obj.delete_cookie(键)</span></span>
<span class="line"><span class="token decorator annotation punctuation">@outer</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    obj <span class="token operator">=</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    obj<span class="token punctuation">.</span>delete_cookie<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> obj</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="session" tabindex="-1"><a class="header-anchor" href="#session"><span>session</span></a></h2><p>​ 数据是保存在服务端的并且表现形式也是k:v键值对</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">默认情况下操作数据库迁移两条命令<span class="token punctuation">,</span>会产生django所需要的很多的表<span class="token punctuation">,</span>django_session就是其中的一张<span class="token punctuation">,</span>用来保存session数据的<span class="token punctuation">.</span>这是操作session必须要要的表</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="session操作" tabindex="-1"><a class="header-anchor" href="#session操作"><span>session操作</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 客户端: sessionid:随机字符串</span></span>
<span class="line"><span class="token comment"># 服务器: 随机字符串:用户信息</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>设置session</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># request.session[键] = 值</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">set_session</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;hobby&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;唱&#39;</span></span>
<span class="line">    request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;sex&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;女&#39;</span></span>
<span class="line">    request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;18&#39;</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;设置成功&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">1.django内部会自动帮你生成一个随机字符串</span>
<span class="line">2.django内部自动将随机字符串和对应的数据存储到djang_session表</span>
<span class="line">	2.1先在内存中产生操作数据的缓存</span>
<span class="line">	2.2在响应经过django中间件的时候才真正的操作数据库</span>
<span class="line">3.将产生的随机字符串返回给客户端浏览器保存</span>
<span class="line">&#39;&#39;&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>获取session</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># request.session.get(键)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_session</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    ses1 <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;hobby&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    ses2 <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;sex&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    ses3 <span class="token operator">=</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>ses1<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>ses2<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>ses3<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;获取成功&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">1.自动从浏览器请求中获取sessionid对应的随机字符串</span>
<span class="line">2.拿着该随机字符串去django_session表中查找对应的数据</span>
<span class="line">3.</span>
<span class="line">	如果比对上了,则将对应的数据取出并以字典的形式封装到request.session中</span>
<span class="line">	如果比对不上,则request.session.get(键)返回的是None</span>
<span class="line">&#39;&#39;&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">如果给一个session设置多个值<span class="token punctuation">,</span>在数据库中只会有一条数据的<span class="token punctuation">,</span>但是在获取的时候可以获取到不同键对应的值</span>
<span class="line">同一台计算机上的同一个浏览器只会有一条数据生效<span class="token punctuation">(</span>当session过期的时候可能出现多条数据对应一个浏览器<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="设置过期时间-1" tabindex="-1"><a class="header-anchor" href="#设置过期时间-1"><span>设置过期时间</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>set_expiry<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># set_expiry()括号内可以传入四种类型的参数:</span></span>
<span class="line">	<span class="token number">1.</span> 整数<span class="token punctuation">:</span>多少秒</span>
<span class="line">    <span class="token number">2.</span> 日期对象<span class="token punctuation">:</span>到指定日期过期</span>
<span class="line">    <span class="token number">3.</span> <span class="token number">0</span><span class="token punctuation">:</span>一旦关闭浏览器窗口就过期</span>
<span class="line">    <span class="token number">4.</span> 不写<span class="token punctuation">:</span>过期时间取决于django内部session默认的过期时间<span class="token punctuation">(</span>两周<span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line"><span class="token keyword">def</span> <span class="token function">set_session</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;hobby&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;唱&#39;</span></span>
<span class="line">    request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>set_expiry<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;设置成功&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="清除session" tabindex="-1"><a class="header-anchor" href="#清除session"><span>清除session</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># request.session.flush():浏览器和服务器的都清空</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">del_session</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;注销了&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="session登录认证" tabindex="-1"><a class="header-anchor" href="#session登录认证"><span>session登录认证</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">:</span></span>
<span class="line">        username <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        password <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;password&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> username <span class="token operator">==</span> <span class="token string">&#39;admin&#39;</span> <span class="token keyword">and</span> password <span class="token operator">==</span> <span class="token string">&#39;123456&#39;</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 获取用户上次想要访问的地址</span></span>
<span class="line">            target_url <span class="token operator">=</span> request<span class="token punctuation">.</span>GET<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;next&#39;</span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment"># 设置session</span></span>
<span class="line">            request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&#39;admin&#39;</span></span>
<span class="line">            <span class="token keyword">if</span> target_url<span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>target_url<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/home/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&#39;login.html&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">login_auth</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 获取用户没有登录之前想要访问的地址</span></span>
<span class="line">        target_url <span class="token operator">=</span> request<span class="token punctuation">.</span>get_full_path<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 判断用户是否登录(获取session)</span></span>
<span class="line">        <span class="token keyword">if</span> request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;username&#39;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> func<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">&#39;/login/?next=%s&#39;</span> <span class="token operator">%</span> target_url<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> inner</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@login_auth</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;这是home页面,需要用户登录才能进入&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@login_auth</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;这是func页面,需要用户登录才能进入&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="利用cookie或session给另一个视图函数传值" tabindex="-1"><a class="header-anchor" href="#利用cookie或session给另一个视图函数传值"><span>利用cookie或session给另一个视图函数传值</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">&#39;%Y-%m-%d %H:%M:%S&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    obj <span class="token operator">=</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;这是home页面,需要用户登录才能进入&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    obj<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">&#39;date&#39;</span><span class="token punctuation">,</span> now<span class="token punctuation">)</span>  <span class="token comment"># 设置cookie</span></span>
<span class="line">    request<span class="token punctuation">.</span>session<span class="token punctuation">[</span><span class="token string">&#39;date&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> now  <span class="token comment"># 设置session</span></span>
<span class="line">    <span class="token keyword">return</span> obj</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;date&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取session</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>COOKIES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;date&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 获取cookie</span></span>
<span class="line">    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">&#39;这是func页面,需要用户登录才能进入&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,36)])])}const o=n(t,[["render",l]]),u=JSON.parse('{"path":"/django/17-cookie%E5%92%8Csession.html","title":"cookie和session","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"cookie","slug":"cookie","link":"#cookie","children":[{"level":3,"title":"cookie操作","slug":"cookie操作","link":"#cookie操作","children":[]},{"level":3,"title":"设置过期时间","slug":"设置过期时间","link":"#设置过期时间","children":[]},{"level":3,"title":"删除cookie","slug":"删除cookie","link":"#删除cookie","children":[]}]},{"level":2,"title":"session","slug":"session","link":"#session","children":[{"level":3,"title":"session操作","slug":"session操作","link":"#session操作","children":[]},{"level":3,"title":"设置过期时间","slug":"设置过期时间-1","link":"#设置过期时间-1","children":[]},{"level":3,"title":"清除session","slug":"清除session","link":"#清除session","children":[]},{"level":3,"title":"session登录认证","slug":"session登录认证","link":"#session登录认证","children":[]}]},{"level":2,"title":"利用cookie或session给另一个视图函数传值","slug":"利用cookie或session给另一个视图函数传值","link":"#利用cookie或session给另一个视图函数传值","children":[]}],"git":{},"filePathRelative":"django/17-cookie和session.md"}');export{o as comp,u as data};
