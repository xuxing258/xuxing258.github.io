import{_ as n,c as a,a as p,o as e}from"./app-cH5Xd749.js";const t={};function l(i,s){return e(),a("div",null,[...s[0]||(s[0]=[p(`<h2 id="scrapyçš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#scrapyçš„æ¦‚å¿µ"><span>scrapyçš„æ¦‚å¿µ</span></a></h2><p><strong>Scrapyæ˜¯ä¸€ä¸ªPythonç¼–å†™çš„å¼€æºç½‘ç»œçˆ¬è™«æ¡†æ¶ã€‚å®ƒæ˜¯ä¸€ä¸ªè¢«è®¾è®¡ç”¨äºçˆ¬å–ç½‘ç»œæ•°æ®ã€æå–ç»“æ„æ€§æ•°æ®çš„æ¡†æ¶ã€‚</strong></p><p>ä½œç”¨: é€šè¿‡å°‘é‡çš„ä»£ç ï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿçš„æŠ“å– ,æ¡†æ¶æ˜¯ä»£ç çš„åŠæˆå“ï¼Œæé«˜æ•ˆç‡ï¼ˆçˆ¬è™«æ•ˆç‡å’Œå¼€å‘æ•ˆç‡ï¼‰</p><p>å®˜ç½‘åœ°å€: http://scrapy-chs.readthedocs.io/zh_CN/1.0/intro/overview.html</p><h3 id="çˆ¬è™«å·¥ä½œæµç¨‹" tabindex="-1"><a class="header-anchor" href="#çˆ¬è™«å·¥ä½œæµç¨‹"><span>çˆ¬è™«å·¥ä½œæµç¨‹</span></a></h3><p>å¯ä»¥ä½¿ç”¨pptè¿›è¡Œæ›´æ”¹è®²è§£</p><img src="https://api2.mubu.com/v3/document_image/7637318_11a2b4a1-fc75-4202-eaa6-95215793b058.png" referrerpolicy="no-referrer"><p>å¯ä»¥æ”¹å†™æˆä¸‹æ–¹ç¤ºä¾‹:</p><img src="https://api2.mubu.com/v3/document_image/7637318_ea21ff4c-ec67-4333-e4e6-f4b560014ecf.png" referrerpolicy="no-referrer"><h3 id="scrapyçš„æµç¨‹" tabindex="-1"><a class="header-anchor" href="#scrapyçš„æµç¨‹"><span>scrapyçš„æµç¨‹</span></a></h3><img src="https://api2.mubu.com/v3/document_image/7637318_a5056c84-9f58-486e-d1a0-5a5429600ce4.png" referrerpolicy="no-referrer"><h4 id="å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹" tabindex="-1"><a class="header-anchor" href="#å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹"><span>å…¶æµç¨‹å¯ä»¥æè¿°å¦‚ä¸‹ï¼š</span></a></h4><p>ç”¨æˆ·è¿è¡Œçˆ¬è™«è„šæœ¬åï¼ŒScrapy Engine åˆå§‹åŒ–ï¼Œå¹¶åŠ è½½ Spider ä¸­å®šä¹‰çš„èµ·å§‹ URL</p><ol><li>å°†Spidersçš„URL <ul><li>ä¼ è¾“ â†’ Spider Middlewares(çˆ¬è™«ä¸­é—´ä»¶)è¿›è¡Œè®¾ç½®è¯·æ±‚å¯¹è±¡</li><li>ä¼ è¾“ â†’ Scrapy Engine(å¼•æ“ ==&gt; æ§åˆ¶ä¸­å¿ƒ)</li></ul></li><li>Scrapy Engineæ¥æ”¶spider middleware æ•°æ®ä¿¡æ¯ <ul><li>å°†æ•°æ®ä¿¡æ¯å‘é€ â†’ scheduler(è°ƒåº¦å™¨)è¿›è¡Œå¤„ç†</li></ul></li><li>schedulerå°†æ¥æ”¶åˆ°çš„æ•°æ®ä¿¡æ¯(request)ç”Ÿæˆé˜Ÿåˆ— (ç®¡ç†requestè¯·æ±‚çš„) <ul><li>å°†requestè¯·æ±‚ä¿¡æ¯å‘é€ â†’ Engineå¼•æ“,å†å‘é€ â†’ Downloader middleware(ä¸‹è½½ä¸­é—´ä»¶)</li><li>ä»ä¸‹è½½ä¸­é—´ä»¶å‘é€ â†’ downloader(ä¸‹è½½å™¨)</li></ul></li><li>downloaderæ¥æ”¶è¯·æ±‚ä¿¡æ¯ <ul><li>downloader è·å–è¯·æ±‚ä¿¡æ¯å,ä¼šè¯·æ±‚å¯¹äºçš„ç½‘ç»œåœ°å€çš„æ•°æ®,å¹¶è¿”å›æ•°æ®response</li><li>å°†responseæ•°æ®è¿”å› â†’ Downloader middleware(ä¸‹è½½ä¸­é—´ä»¶) â†’ Engineå¼•æ“å°†responseæ•°æ®å‘é€ â†’ Spider Middlewares(çˆ¬è™«ä¸­é—´ä»¶) â†’ Spiders</li></ul></li><li>Spiders è§£æ <code>Response</code>ï¼Œæå–æ•°æ®æˆ–æ–°é“¾æ¥ <ul><li><strong>æ–° Request</strong> â†’ è¿”å›ç»™ Engineï¼Œè¿›å…¥ä¸‹ä¸€è½®è°ƒåº¦</li><li><strong>ç»“æ„åŒ–æ•°æ®ï¼ˆItemï¼‰</strong> â†’ å¼•æ“â†’ äº¤ç»™ <code>Item Pipeline</code> å¤„ç†ã€‚</li></ul></li></ol><p>æ³¨æ„: å»é‡æ˜¯æ ¹æ®urlè¿›è¡Œå»é‡çš„</p><h4 id="æ¨¡å—ä½œç”¨" tabindex="-1"><a class="header-anchor" href="#æ¨¡å—ä½œç”¨"><span>æ¨¡å—ä½œç”¨</span></a></h4><ul><li><p>å¼•æ“(engine)ï¼šè´Ÿè´£æ•°æ®å’Œä¿¡å·åœ¨ä¸åŒæ¨¡å—é—´çš„ä¼ é€’(ä¸­æ¢æ§åˆ¶å™¨ï¼Œåè°ƒæ‰€æœ‰ç»„ä»¶çš„æ•°æ®æµ)</p></li><li><p>è°ƒåº¦å™¨(scheduler)ï¼šç®¡ç†å¾…çˆ¬å–çš„ <code>Request</code> é˜Ÿåˆ—ï¼ˆURL æ„æˆçš„è¯·æ±‚å¯¹è±¡ï¼‰æ¯”å¦‚: å»é‡</p></li><li><p>ä¸‹è½½å™¨(downloader)ï¼šå‘é€å¼•æ“å‘è¿‡æ¥çš„requestè¯·æ±‚ï¼Œè·å–å“åº”ï¼Œå¹¶å°†å“åº”äº¤ç»™å¼•æ“</p></li><li><p>çˆ¬è™«(spider)ï¼šå¤„ç†å¼•æ“å‘è¿‡æ¥çš„responseï¼Œæå–æ•°æ®ï¼Œæå–urlï¼Œå¹¶äº¤ç»™å¼•æ“</p></li><li><p>ç®¡é“(pipeline)ï¼šå¤„ç†å¼•æ“ä¼ é€’è¿‡æ¥çš„æ•°æ®ï¼Œæ¯”å¦‚å­˜å‚¨</p></li><li><p>ä¸‹è½½ä¸­é—´ä»¶(downloader middleware)ï¼šå¯ä»¥è‡ªå®šä¹‰çš„ä¸‹è½½æ‰©å±•ï¼Œæ¯”å¦‚è®¾ç½®ä»£ç†ip</p><ul><li>é¢„å¤„ç† <code>Request</code>ï¼ˆå¦‚è‡ªåŠ¨é‡è¯•ã€æ›´æ¢ä»£ç†ï¼‰</li><li>åå¤„ç† <code>Response</code>ï¼ˆå¦‚ä¿®æ”¹å“åº”å†…å®¹ã€è¿‡æ»¤å¼‚å¸¸é¡µé¢)</li></ul></li><li><p>çˆ¬è™«ä¸­é—´ä»¶(spider middleware)ï¼šå¯ä»¥è‡ªå®šä¹‰requestè¯·æ±‚å’Œè¿›è¡Œresponseè¿‡æ»¤ï¼Œä¸ä¸‹è½½ä¸­é—´ä»¶ä½œç”¨é‡å¤</p><ul><li>å¹²é¢„ Spider çš„è¾“å…¥ï¼ˆ<code>Response</code>ï¼‰å’Œè¾“å‡ºï¼ˆ<code>Item/Request</code>ï¼‰</li></ul></li></ul><img src="https://api2.mubu.com/v3/document_image/7637318_54251048-c8c4-4629-8cb7-b91ad1ab0c95.png" referrerpolicy="no-referrer"><h3 id="scrapy" tabindex="-1"><a class="header-anchor" href="#scrapy"><span>Scrapy</span></a></h3><blockquote><p>windows/Macå®‰è£…å‘½ä»¤</p></blockquote><p><code>pip/pip3 install scrapy </code></p><blockquote><p>é¡¹ç›®æµç¨‹å‘½ä»¤</p></blockquote><ol><li>åˆ›å»ºé¡¹ç›®: <code>scrapy startproject é¡¹ç›®å</code></li><li>åˆ›å»ºä¸€ä¸ªçˆ¬è™«: <code>scrapy genspider æ–‡ä»¶åç§° çˆ¬è™«çš„ç½‘é¡µåŸŸå</code><ul><li>åˆ›å»ºåä¼šç”Ÿæˆåœ¨spideræ–‡ä»¶å¤¹ä¸­</li><li>ç¤ºä¾‹: <code>scrapy genspider lianjia cs.lianjia.com</code></li></ul></li><li>æå–æ•°æ®: æ ¹æ®ç½‘ç«™ç»“æ„åœ¨spiderä¸­å®ç°æ•°æ®é‡‡é›†ç›¸å…³å†…å®¹</li><li>ä¿å­˜æ•°æ®: ä½¿ç”¨pipelineè¿›è¡Œæ•°æ®åç»­å¤„ç†å’Œä¿å­˜</li></ol><h4 id="ç›®å½•ç»“æ„å¦‚ä¸‹" tabindex="-1"><a class="header-anchor" href="#ç›®å½•ç»“æ„å¦‚ä¸‹"><span>ç›®å½•ç»“æ„å¦‚ä¸‹</span></a></h4><p><img src="https://api2.mubu.com/v3/document_image/7637318_8ab03997-2137-455d-da96-95bfc4b41fbd.png" alt=""></p><ul><li><code>scrapy.cfg</code> é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œ ä¸éœ€è¦åšæ”¹åŠ¨</li><li><code>items.py</code> å®šä¹‰æ•°æ®å­˜å‚¨æ¨¡å‹</li><li><code>middlewares.py</code> ç”¨äºç¼–å†™ä¸­é—´ä»¶ï¼ˆä¸‹è½½ä¸­é—´ä»¶+çˆ¬è™«ä¸­é—´ä»¶ï¼‰ -- æ— ç‰¹æ®Šéœ€æ±‚ï¼Œä¸€èˆ¬ä¸éœ€è¦ç¼–å†™</li><li>spidersæ–‡ä»¶å¤¹å®šä¹‰çš„çˆ¬è™«æ–‡ä»¶ <code>lianjia.py </code>ï¼ˆçˆ¬è™«æ–‡ä»¶,æ–‡ä»¶åç§°è‡ªå·±å®šä¹‰ï¼‰ [åé¢å†æ¥å®Œå–„è¯¥çˆ¬è™«æ¨¡å—]</li><li><code>pipelines.py</code> ç®¡é“ -- ä¸»è¦ç”¨äºç¼–å†™æ•°æ®å¤„ç†æ­¥éª¤ ï¼ˆæ•°æ®çš„æ¸…æ´—+ä¿å­˜ï¼‰</li><li><code>settings.py</code> è¯¦ç»†çš„é…ç½®ä¿¡æ¯ï¼ˆè®¾ç½®æ–‡ä»¶USER_AGENT å¹¶å¯åŠ¨ç®¡é“)</li></ul><h4 id="åˆæ­¥ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#åˆæ­¥ä½¿ç”¨"><span>åˆæ­¥ä½¿ç”¨</span></a></h4><blockquote><p>ä¸å…è®¸ä¸­æ–‡æ³¨é‡Š</p></blockquote><p><code>settings.py</code> æ–‡ä»¶ åªéœ€ä¿®æ”¹<code>ROBOTSTXT_OBEY</code></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># ğŸ”µã€åŸºç¡€é…ç½®ã€‘</span></span>
<span class="line">BOT_NAME <span class="token operator">=</span> <span class="token string">&quot;scrapymax&quot;</span>  <span class="token comment"># ğŸŸ¢ é¡¹ç›®æ ‡è¯†ï¼ˆä¼šä½œä¸ºé»˜è®¤User-Agentå‰ç¼€ï¼‰</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸŸ£ã€çˆ¬è™«è·¯å¾„é…ç½®ã€‘</span></span>
<span class="line">SPIDER_MODULES <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;scrapymax.spiders&quot;</span><span class="token punctuation">]</span>  <span class="token comment"># ğŸ”µ æŒ‡å®šçˆ¬è™«æ¨¡å—è·¯å¾„</span></span>
<span class="line">NEWSPIDER_MODULE <span class="token operator">=</span> <span class="token string">&quot;scrapymax.spiders&quot;</span>  <span class="token comment"># ğŸ”µ æ–°å»ºçˆ¬è™«çš„é»˜è®¤ä½ç½®</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸŸ ã€æ‰©å±•æ’ä»¶ã€‘ï¼ˆéœ€æ‰‹åŠ¨æ·»åŠ ï¼‰</span></span>
<span class="line">ADDONS <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># ğŸŸ¡ é¢„ç•™çš„è‡ªå®šä¹‰æ‰©å±•é…ç½®å­—å…¸</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸ”´ã€çˆ¬è™«ä¼ªè£…ã€‘ # ğŸŸ¤ å»ºè®®å–æ¶ˆæ³¨é‡Šå¹¶ä¿®æ”¹ä¸ºçœŸå®UA</span></span>
<span class="line">USER_AGENT <span class="token operator">=</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36&quot;</span>  </span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸŸ¢ã€çˆ¬è™«åè®®ã€‘ åº”ä¸ºfalse</span></span>
<span class="line">ROBOTSTXT_OBEY <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># ğŸŸ  æ˜¯å¦éµå®ˆrobots.txtè§„åˆ™ï¼ˆæ­£å¼ç¯å¢ƒå»ºè®®Trueï¼‰</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ğŸŸ¢ çœŸå®æµè§ˆå™¨UA</span></span>
<span class="line">USER_AGENT <span class="token operator">=</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span>  </span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ§åˆ¶ â€‹â€‹å¹¶å‘è¯·æ±‚æ•°é‡â€‹â€‹ </span></span>
<span class="line">CONCURRENT_REQUESTS <span class="token operator">=</span> <span class="token number">4</span></span>
<span class="line"><span class="token comment"># å¯¹åŒä¸€ä¸ªåŸŸåï¼ˆç½‘ç«™ï¼‰**åŒæ—¶æœ€å¤šå‘ 2 ä¸ªè¯·æ±‚**ï¼ˆé¿å…è¯·æ±‚å¤ªçŒ›è¢«å°ï¼‰ã€‚</span></span>
<span class="line">CONCURRENT_REQUESTS_PER_DOMAIN <span class="token operator">=</span> <span class="token number">2</span></span>
<span class="line"><span class="token comment"># æ¯å‘ä¸€ä¸ªè¯·æ±‚åï¼Œ**ç­‰å¾… 1 ç§’**å†å‘ä¸‹ä¸€ä¸ªï¼ˆé™ä½é¢‘ç‡ï¼Œé˜²æ­¢è¢«å°ï¼‰</span></span>
<span class="line">DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ä¿å®ˆç­–ç•¥ï¼ˆé€‚åˆæ–°æ‰‹æˆ–æ•æ„Ÿç½‘ç«™ï¼‰â€‹</span></span>
<span class="line">CONCURRENT_REQUESTS <span class="token operator">=</span> <span class="token number">4</span>  <span class="token comment"># å…¨å±€å¹¶å‘4</span></span>
<span class="line">CONCURRENT_REQUESTS_PER_DOMAIN <span class="token operator">=</span> <span class="token number">2</span>  <span class="token comment"># æ¯ä¸ªåŸŸåå¹¶å‘2</span></span>
<span class="line">DOWNLOAD_DELAY <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># æ¯æ¬¡è¯·æ±‚é—´éš”1ç§’</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ç®¡é“é…ç½®</span></span>
<span class="line">ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token string">&quot;scrapymax.pipelines.ScrapymaxPipeline&quot;</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">#ç®¡é“æ–‡ä»¶åœ°å€ä»¥åŠæ–‡ä»¶ä¸­çš„ç±»å   æ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜</span></span>
<span class="line">    	</span>
<span class="line">    <span class="token comment"># å¤šä¸ªç®¡é“</span></span>
<span class="line">    <span class="token string">&quot;scrapymax.pipelines.DeduplicationPipeline&quot;</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>  <span class="token comment"># å†å»é‡</span></span>
<span class="line">    <span class="token string">&quot;scrapymax.pipelines.MongoDBPipeline&quot;</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>  <span class="token comment"># æœ€åå­˜æ•°æ®åº“</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>items.py</code> å®šä¹‰çˆ¬è™«çš„æ•°æ®ç±»å‹(å­—æ®µ)</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># æ–¹ä¾¿åç»­çš„ç®¡ç†, å®šä¹‰itemå³æå‰è§„åˆ’å¥½é‚£äº›å­—æ®µéœ€è¦æŠ“,é˜²æ­¢æ‰‹è¯¯,</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ScrapymaxItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># define the fields for your item here like:</span></span>
<span class="line">    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># æ ‡é¢˜</span></span>
<span class="line">    price <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ä»·æ ¼</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>çˆ¬è™«æ–‡ä»¶.py</code> å®šä¹‰çˆ¬è™«</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">LianjiaSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;lianjia&quot;</span> <span class="token comment">#çˆ¬è™«æ–‡ä»¶çš„åç§°</span></span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;cs.lianjia.com&quot;</span><span class="token punctuation">]</span> <span class="token comment"># åŸŸå</span></span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://cs.lianjia.com&quot;</span><span class="token punctuation">]</span> <span class="token comment"># èµ·å§‹çš„è¯·æ±‚è¿æ¥</span></span>
<span class="line">	</span>
<span class="line">    <span class="token comment"># è¯¥æ–¹æ³•ä¼šæ¥æ”¶å¼•æ“ä¼ é€’çš„response</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token comment"># å“åº”ä½“å¯¹è±¡</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token comment">#è¿”å›çš„æ•°æ® æ˜¯bytes ç±»å‹</span></span>
<span class="line">        response<span class="token punctuation">.</span>text  <span class="token comment"># æ–‡æœ¬æ ¼å¼</span></span>
<span class="line">        <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="è¿è¡Œ" tabindex="-1"><a class="header-anchor" href="#è¿è¡Œ"><span>è¿è¡Œ</span></a></h4><blockquote><p>scrapy crawl çˆ¬è™«æ–‡ä»¶å</p></blockquote><p>ä¼šå‡ºç°æ—¥å¿—ä¿¡æ¯,å¯é€šè¿‡æŒ‡ä»¤ä¸æ˜¾ç¤º</p><blockquote><p>scrapy crawl çˆ¬è™«æ–‡ä»¶å --nolog</p></blockquote><p>ä¸ä¼šå‡ºç°æ—¥å¿—ä¿¡æ¯</p><blockquote><p>è®¾ç½®å¯åŠ¨æ–‡ä»¶,ä¸éœ€è¦å‘½ä»¤å»å¯åŠ¨,</p></blockquote><p>æ³¨æ„: æ–‡ä»¶å¿…é¡»åˆ›å»ºåœ¨é¡¹ç›®çš„æ ¹ç›®å½•</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># è‡ªå®šä¹‰åç§°.py </span></span>
<span class="line"><span class="token keyword">from</span> scrapy <span class="token keyword">import</span> cmdline</span>
<span class="line">cmdline<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;scrapy&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;crawl&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;çˆ¬è™«æ–‡ä»¶åç§°&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">cmdline<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;scrapy&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;crawl&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;lianjia&#39;</span><span class="token punctuation">,</span><span class="token string">&quot;--nolog&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># å»é™¤æ—¥å¿—</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># çˆ¬è™«æ–‡ä»¶</span></span>
<span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"><span class="token keyword">from</span> scrapymax<span class="token punctuation">.</span>items <span class="token keyword">import</span> ScrapymaxItem</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">LianjiaSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;lianjia&quot;</span> <span class="token comment">#çˆ¬è™«æ–‡ä»¶çš„åç§°</span></span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;cs.lianjia.com&quot;</span><span class="token punctuation">]</span> <span class="token comment"># åŸŸå</span></span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://cs.lianjia.com/zufang/&quot;</span><span class="token punctuation">]</span> <span class="token comment"># èµ·å§‹çš„è¯·æ±‚è¿æ¥</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># extractåªéœ€è¦Selectorå…¶ä¸­çš„æ–‡æœ¬</span></span>
<span class="line">        title <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//a[@class=&quot;twoline&quot;]/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        pre <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//span[@class=&quot;content__list--item-price&quot;]/em/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">        <span class="token keyword">for</span> titl<span class="token punctuation">,</span>pric <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>pre<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            item <span class="token operator">=</span> ScrapymaxItem<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            item<span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> titl<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            item<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pric</span>
<span class="line">            <span class="token comment"># å°†ç»„ä»¶å¥½çš„dictå½¢å¼æ•°æ®é€šè¿‡ yieldè¿”å›ç»™å¼•æ“  ç”±å¼•æ“åˆ¤æ–­æ˜¯å¦è¿”å›ç»™ç®¡é“æ–‡ä»¶</span></span>
<span class="line">            <span class="token keyword">yield</span> item</span>
<span class="line"></span>
<span class="line"><span class="token comment"># itemsæ•°æ®æ–‡ä»¶</span></span>
<span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"><span class="token comment"># è®¾è®¡è·å–çš„æ•°æ®å­—å…¸</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ScrapymaxItem</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Item<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    price <span class="token operator">=</span> scrapy<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># pipelines ç®¡é“æ–‡ä»¶ ä¸»è¦ç”¨äºç¼–å†™æ•°æ®å¤„ç†æ­¥éª¤  éœ€è¦åˆ°settings.pyä¸­å¼€å¯ç®¡é“</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ScrapymaxPipeline</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span><span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;./12.json&quot;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># print(type(item), &quot;å¼•æ“å‘é€çš„&quot;) è·å–çš„æ˜¯ä¸€ä¸ªclassçš„æ•°æ®</span></span>
<span class="line">        dict_item <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment">#  ensure_ascii=False ç¦ç”¨ASCIIè½¬ä¹‰â€‹â€‹ï¼Œç›´æ¥è¾“å‡ºåŸå§‹å­—ç¬¦</span></span>
<span class="line">        data <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>dict_item<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\\n&quot;</span></span>
<span class="line">        self<span class="token punctuation">.</span><span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>item<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># ä¸èƒ½åˆ é™¤,æ•°æ®éœ€è¦è¿›è¡Œè¿”å›å¼•æ“çš„</span></span>
<span class="line">        <span class="token keyword">return</span> item</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ä¸‹è½½ä¸­é—´å™¨(downloader middleware)ä½¿ç”¨</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># middlewares.py   è®¾ç½®ä¸‹è½½ä¸­é—´ä»¶æˆ–çˆ¬è™«ä¸­é—´ä»¶</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ScrapymaxDownloaderMiddleware</span><span class="token punctuation">:</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># åœ¨è¯·æ±‚è¢«å‘é€åˆ°ä¸‹è½½å™¨ä¹‹å‰æ‹¦æˆªå¹¶å¤„ç†è¯·æ±‚</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;requests&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>url<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># éœ€è¦åœ¨setting.pyè¿›è¡Œé…ç½®</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># æ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰ã€‚Scrapy å†…ç½®ä¸­é—´ä»¶çš„ä¼˜å…ˆçº§é€šå¸¸åœ¨ 500-800 ä¹‹é—´</span></span>
<span class="line">DOWNLOADER_MIDDLEWARES <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment"># ç±»åä½ç½®</span></span>
<span class="line">   <span class="token string">&quot;scrapymax.middlewares.ScrapymaxDownloaderMiddleware&quot;</span><span class="token punctuation">:</span> <span class="token number">543</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="requestä¸responseå±æ€§" tabindex="-1"><a class="header-anchor" href="#requestä¸responseå±æ€§"><span>requestä¸responseå±æ€§</span></a></h4><p>requestè¯·æ±‚å¯¹è±¡çš„å¸¸ç”¨å±æ€§</p><ol><li>request.urlï¼ˆå¿…é€‰ï¼‰ï¼šè¯·æ±‚é¡µé¢çš„urlåœ°å€ï¼Œbytesæˆ–strç±»å‹ã€‚</li><li>request.callbackï¼šé¡µé¢è§£æå‡½æ•°ï¼ŒCallbackç±»å‹ï¼ŒRequestè¯·æ±‚å¯¹è±¡çš„é¡µé¢ä¸‹è½½å®Œæˆåï¼Œç”±è¯¥å‚æ•°æŒ‡å®šçš„é¡µé¢è§£æå‡½æ•°è§£æé¡µé¢ï¼Œå¦‚æœæœªä¼ é€’è¯¥å‚æ•°ï¼Œé»˜è®¤è°ƒç”¨Spiderçš„parseæ–¹æ³•ã€‚</li><li>request.methodï¼šHTTPè¯·æ±‚çš„æ–¹æ³•ï¼Œé»˜è®¤ä¸ºâ€˜GETâ€™ã€‚</li><li>request.headersï¼šHTTPè¯·æ±‚çš„å¤´éƒ¨å­—å…¸ï¼Œdict ç±»å‹ã€‚</li><li>request.metaï¼šRequest çš„å…ƒæ•°æ®å­—å…¸ï¼Œdict ç±»å‹ï¼Œç”¨äºç»™æ¡†æ¶ä¸­å…¶ä»–ç»„ä»¶ä¼ é€’ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸­é—´ä»¶ Item Pipelineã€‚å…¶ä»–ç»„ä»¶å¯ä»¥ä½¿ç”¨Request å¯¹è±¡çš„ meta å±æ€§è®¿é—®è¯¥å…ƒæ•°æ®å­—å…¸ (request.meta), ä¹Ÿç”¨äºç»™å“åº”å¤„ç†å‡½æ•°ä¼ é€’ä¿¡æ¯ã€‚</li><li>request.encodingï¼šurl å’Œ body å‚æ•°çš„ç¼–ç é»˜è®¤ä¸º&#39;utf-8&#39;ã€‚å¦‚æœä¼ å…¥çš„urlæˆ–bodyå‚æ•°æ˜¯str ç±»å‹ï¼Œå°±ä½¿ç”¨è¯¥å‚æ•°è¿›è¡Œç¼–ç ã€‚</li><li>request.dont_filterï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ˆdont_filter=Falseï¼‰,å¯¹åŒä¸€ä¸ªurlåœ°å€å¤šæ¬¡æäº¤ä¸‹è½½è¯·æ±‚ï¼Œåé¢çš„è¯·æ±‚ä¼šè¢«å»é‡è¿‡æ»¤å™¨è¿‡æ»¤ï¼ˆé¿å…é‡å¤ä¸‹è½½ï¼‰ã€‚å¦‚æœå°†è¯¥å‚æ•°ç½®ä¸ºTrueï¼Œå¯ä»¥ä½¿è¯·æ±‚é¿å…è¢«è¿‡æ»¤ï¼Œå¼ºåˆ¶ä¸‹è½½ã€‚ä¾‹å¦‚ï¼šåœ¨å¤šæ¬¡çˆ¬å–ä¸€ä¸ªå†…å®¹éšæ—¶é—´è€Œå˜åŒ–çš„é¡µé¢æ—¶ï¼ˆæ¯æ¬¡ä½¿ç”¨ç›¸åŒçš„urlï¼‰ï¼Œå¯ä»¥å°†è¯¥å‚æ•°è®¾ç½®ä¸ºTrueã€‚</li></ol><p>responseå“åº”å¯¹è±¡çš„å¸¸ç”¨å±æ€§</p><ol><li>response.urlï¼šè·å–å½“å‰å“åº”çš„urlåœ°å€</li><li>response.request.urlï¼šè·å–å½“å‰å“åº”å¯¹åº”çš„è¯·æ±‚çš„urlåœ°å€</li><li>response.headersï¼šè·å–å“åº”å¤´</li><li>response.urljoin(url) ï¼šç”¨äºæ„é€ ç»å¯¹url, å½“ä¼ å…¥çš„urlå‚æ•°æ˜¯ä¸€ä¸ªç›¸å¯¹åœ°å€æ—¶, æ ¹æ®response.urlè®¡ç®—å‡ºç›¸åº”çš„ç»å¯¹url.</li><li>response.bodyï¼šè·å–å“åº”ä½“ï¼Œä¹Ÿå°±æ˜¯htmlä»£ç ï¼Œbyteç±»å‹</li><li>response.textï¼š è·å–å“åº”ä½“ï¼Œstrç±»å‹</li><li>response.statusï¼šè·å–å“åº”çŠ¶æ€ç </li></ol><h4 id="ç¿»é¡µ" tabindex="-1"><a class="header-anchor" href="#ç¿»é¡µ"><span>ç¿»é¡µ</span></a></h4><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">1</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># extractåªéœ€è¦Selectorå…¶ä¸­çš„æ–‡æœ¬</span></span>
<span class="line"></span>
<span class="line">        title <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//div[@class=&quot;content__list--item&quot;]/a[@class=&quot;content__list--item--aside&quot;]/@title&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        pre <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//span[@class=&quot;content__list--item-price&quot;]/em/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">for</span> titl<span class="token punctuation">,</span> pric <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> pre<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            items <span class="token operator">=</span> ScrapymaxItem<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            items<span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> titl<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            items<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pric</span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;itemssssss&#39;</span><span class="token punctuation">,</span>items<span class="token punctuation">)</span></span>
<span class="line">            <span class="token comment"># å°†ç»„ä»¶å¥½çš„dictå½¢å¼æ•°æ®é€šè¿‡ yieldè¿”å›ç»™å¼•æ“  ç”±å¼•æ“åˆ¤æ–­æ˜¯å¦è¿”å›ç»™ç®¡é“æ–‡ä»¶</span></span>
<span class="line">            <span class="token keyword">yield</span> items</span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span> self<span class="token punctuation">.</span>index <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span></span>
<span class="line">            self<span class="token punctuation">.</span>index <span class="token operator">+=</span> <span class="token number">1</span></span>
<span class="line">            <span class="token comment"># æ„å»ºå¤šæ¬¡è¯·æ±‚åœ°å€</span></span>
<span class="line">            page_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&#39;https://cs.lianjia.com/zufang/pg</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>index<span class="token punctuation">}</span></span><span class="token string">&#39;</span></span></span>
<span class="line">            <span class="token comment"># å°†æ–°çš„urlåœ°å€å‘é€åˆ°å¼•æ“   callbackè®¾ç½®åç»­è¯·æ±‚åæ•°æ®äº¤ç»™é‚£ä¸ªå‡½æ•°è¿›è¡Œå¤„ç†</span></span>
<span class="line">            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>page_url<span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="scrapy-shellä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#scrapy-shellä½¿ç”¨"><span>scrapy Shellä½¿ç”¨</span></a></h3><p>ç”±äºScrapyæ˜¯ä¸€ä¸ªé‡é‡çº§æ¡†æ¶ï¼Œæ¯æ¬¡è¿è¡Œèµ·æ¥éƒ½è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå› æ­¤è¦å»éªŒè¯æˆ‘ä»¬ä¹¦å†™çš„è§„åˆ™æ˜¯å¦æ­£ç¡®ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„äº‹æƒ…ï¼Œå› æ­¤Scrapyæä¾›äº†ä¸€ä¸ªshellï¼Œç”¨èµ·æ¥æ–¹ä¾¿æµ‹è¯•è§„åˆ™</p><p>æ‰“å¼€cmdç»ˆç«¯ï¼Œè¿›å…¥åˆ°Scrapyé¡¹ç›®æ‰€åœ¨ç›®å½•ï¼Œè¿›å…¥åˆ°Scrapyæ¡†æ¶æ‰€åœ¨çš„ç¯å¢ƒä¸­</p><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd"><pre><code><span class="line"># scrapy shell éœ€è¦æµ‹è¯•çš„ç½‘ç»œåœ°å€</span>
<span class="line">scrapy shell https://cs.lianjia.com/zufang/</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">title = response.xpath(&#39;//div[@class=&quot;content__list--item&quot;]/a[@class=&quot;content__list--item--aside&quot;]/@title&#39;).extract()</span>
<span class="line"></span>
<span class="line"># æ„Ÿè§‰ä¸å¯¹åŠ², ä¸å¥½ç”¨</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="scrapyè¿›é˜¶" tabindex="-1"><a class="header-anchor" href="#scrapyè¿›é˜¶"><span>scrapyè¿›é˜¶</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># setting.py</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># è®¾ç½®è¯·æ±‚å¤´ä¿¡æ¯  è¿™é‡Œçš„user-Agentå†™äº† ä¸Šæ–¹çš„å¯ä»¥ä¸ç”¨å†™</span></span>
<span class="line">DEFAULT_REQUEST_HEADERS <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">   <span class="token string">&quot;Accept&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;</span><span class="token punctuation">,</span></span>
<span class="line">   <span class="token string">&quot;Accept-Language&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;en&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;cookie&quot;</span><span class="token punctuation">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">,</span>  </span>
<span class="line">    <span class="token string">&quot;User-Agent&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä»£ç†" tabindex="-1"><a class="header-anchor" href="#ä»£ç†"><span>ä»£ç†</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># ç§å¯†ä»£ç†</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">wangyeMide</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;ä¸­é—´:</span><span class="token interpolation"><span class="token punctuation">{</span>request<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># æå–ä»£ç†APIæ¥å£ï¼Œè·å–1ä¸ªä»£ç†IP</span></span>
<span class="line">        api_url <span class="token operator">=</span> <span class="token string">&quot;https://dps.kdlapi.com/api/getdps/?secret_id=o4zsfebj9j4nm0izhp7s&amp;signature=ocoxalcpllkatvl57beyisep1vzj58p8&amp;num=1&amp;sep=1&quot;</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># è·å–APIæ¥å£è¿”å›çš„ä»£ç†IP</span></span>
<span class="line">        proxy_ip <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>api_url<span class="token punctuation">)</span><span class="token punctuation">.</span>text</span>
<span class="line"></span>
<span class="line">        <span class="token comment"># ç”¨æˆ·åå¯†ç è®¤è¯(ç§å¯†ä»£ç†/ç‹¬äº«ä»£ç†)</span></span>
<span class="line">        username <span class="token operator">=</span> <span class="token string">&quot;d2089925381&quot;</span></span>
<span class="line">        password <span class="token operator">=</span> <span class="token string">&quot;8ujkam0p&quot;</span></span>
<span class="line">        proxies <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;http&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://%(user)s:%(pwd)s@%(proxy)s/&quot;</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">&quot;pwd&quot;</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span> <span class="token string">&quot;proxy&quot;</span><span class="token punctuation">:</span> proxy_ip<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token string">&quot;https&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;http://%(user)s:%(pwd)s@%(proxy)s/&quot;</span> <span class="token operator">%</span> <span class="token punctuation">{</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">:</span> username<span class="token punctuation">,</span> <span class="token string">&quot;pwd&quot;</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span> <span class="token string">&quot;proxy&quot;</span><span class="token punctuation">:</span> proxy_ip<span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># ä½¿ç”¨ä»£ç†IPå‘é€è¯·æ±‚</span></span>
<span class="line">        request<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">&#39;proxy&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> proxies<span class="token punctuation">[</span><span class="token string">&#39;https&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token boolean">None</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è·å–è¯¦ç»†ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#è·å–è¯¦ç»†ä¿¡æ¯"><span>è·å–è¯¦ç»†ä¿¡æ¯</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># çˆ¬è™«æ–‡ä»¶</span></span>
<span class="line"><span class="token keyword">import</span> scrapy</span>
<span class="line"><span class="token keyword">from</span> scrapymax<span class="token punctuation">.</span>items <span class="token keyword">import</span> ScrapymaxItem</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">LianjiaSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;lianjia&quot;</span> <span class="token comment">#çˆ¬è™«æ–‡ä»¶çš„åç§°</span></span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;cs.lianjia.com&quot;</span><span class="token punctuation">]</span> <span class="token comment"># åŸŸå</span></span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://cs.lianjia.com/zufang/&quot;</span><span class="token punctuation">]</span> <span class="token comment"># èµ·å§‹çš„è¯·æ±‚è¿æ¥</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># extractåªéœ€è¦Selectorå…¶ä¸­çš„æ–‡æœ¬</span></span>
<span class="line">        title <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//a[@class=&quot;twoline&quot;]/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        pre <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//span[@class=&quot;content__list--item-price&quot;]/em/text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      </span>
<span class="line">        <span class="token keyword">for</span> titl<span class="token punctuation">,</span>pric <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>pre<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            item <span class="token operator">=</span> ScrapymaxItem<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            item<span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> titl<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            item<span class="token punctuation">[</span><span class="token string">&#39;price&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> pric</span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># ä¸éœ€è¦å†™, ç”±åç»­çš„å†…å®¹è¿›è¡Œä¼ é€’äº†</span></span>
<span class="line">            <span class="token comment"># yield items_all</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># è·å–è¯¦æƒ…é¡µé¢çš„æ•°æ®ä¿¡æ¯</span></span>
<span class="line">            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>items_all<span class="token punctuation">[</span><span class="token string">&quot;link&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_msg<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">&quot;items_all&quot;</span><span class="token punctuation">:</span> items_all<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">parse_msg</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        items <span class="token operator">=</span> response<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">&#39;items_all&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        text <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&#39;//div[@class=&quot;intro&quot;]//text()&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        items<span class="token punctuation">[</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> text</span>
<span class="line">        <span class="token comment"># å°†è·å–çš„æ•°æ®å‘é€åˆ°å¼•æ“ åœ¨å‘é€åˆ°ç®¡é“</span></span>
<span class="line">        <span class="token keyword">yield</span> items</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¸­é—´ä»¶ä¸­è®¾ç½®ua" tabindex="-1"><a class="header-anchor" href="#ä¸­é—´ä»¶ä¸­è®¾ç½®ua"><span>ä¸­é—´ä»¶ä¸­è®¾ç½®UA</span></a></h3><p><code>setting.pyæ–‡ä»¶</code> éœ€è¦è¿›è¡Œå¯¹äºçš„è®¾ç½®, æ•°å€¼è¶Šå°</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> random</span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">UserAgentDownloadMiddleware</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    user_agent <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token string">&#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:77.0) Gecko/20190101 Firefox/77.0&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&#39;Opera/9.80 (X11; Linux i686; Ubuntu/14.10) Presto/2.12.388 Version/12.16.2&#39;</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line">    <span class="token comment"># æ–¹æ³•åæ˜¯scrapyè§„å®šçš„æ–¹æ³• ï¼ˆåå•†æœºåˆ¶ï¼‰</span></span>
<span class="line">    <span class="token comment"># æ¯ä¸ªäº¤ç»™ä¸‹è½½å™¨çš„requestå¯¹è±¡éƒ½ä¼šç»è¿‡è¯¥æ–¹æ³•ï¼Œå¹¶æœŸæœ›è¿”å›response</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">process_request</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># è·å–éšæœºè¯·æ±‚å¤´  random.choiceä»åˆ—è¡¨ä¸­éšæœºè·å–ä¸€ä¸ª</span></span>
<span class="line">        u_a <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_agent<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># è®¾ç½®è¯·æ±‚å¤´</span></span>
<span class="line">        request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">&#39;User-Agent&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> u_a</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="postè¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#postè¯·æ±‚"><span>postè¯·æ±‚</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># çˆ¬è™«æ–‡ä»¶.py </span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># ä½œç”¨: æ­¤æ–¹æ³•æ˜¯scraoyçš„å®šåˆ¶æ–¹æ³•,æ˜¯ä¸€ä¸ªé‡å†™è¯·æ±‚çš„æ–¹æ³•,ä¸èƒ½ä¿®æ”¹åç§°å’Œå‚æ•°</span></span>
<span class="line">    <span class="token comment"># é‡ä¿®æ„é€ çœ‹ä¸€ä¸ªèµ·å§‹çš„è¯·æ±‚,å¹¶ä¸”è¯·æ±‚æ–¹å¼ä¸ºpost</span></span>
<span class="line">    <span class="token comment">#  body: æºå¸¦Postè¯·æ±‚æ•°æ® Method: è¯·æ±‚æ–¹å¼</span></span>
<span class="line">    </span>
<span class="line">   	<span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span>method<span class="token operator">=</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">,</span>body<span class="token operator">=</span><span class="token string">&quot;æ•°æ®&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="scrapyä¸selenium" tabindex="-1"><a class="header-anchor" href="#scrapyä¸selenium"><span>scrapyä¸selenium</span></a></h2><p>seleniumä¹¦å†™åœ¨ä¸‹è½½ä¸­é—´ä»¶çš„è¿”å›æ•°æ®ä½ç½®, é€šè¿‡seleniumé‡æ–°è·å–æ•°æ®,å†æ¬¡å°è£…æ•°æ®,è¿”å›ç»™å¼•æ“,åœ¨è¿”å›spider</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    self<span class="token punctuation">.</span>options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">&#39;excludeSwitches&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;enable-automation&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># å†™å…¥å‚æ•°</span></span>
<span class="line">    self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">&quot;--disable-blink-features=AutomationControlled&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># å…³é”®ï¼éšè—è‡ªåŠ¨åŒ–æ ‡å¿—</span></span>
<span class="line">    self<span class="token punctuation">.</span>options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">&quot;useAutomationExtension&quot;</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>  <span class="token comment"># ç¦ç”¨è‡ªåŠ¨åŒ–æ‰©å±•</span></span>
<span class="line">    self<span class="token punctuation">.</span>browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>self<span class="token punctuation">.</span>options<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># ä½¿ç”¨ç‰¹å®šç”¨æˆ·æ•°æ®ç›®å½• (ä¿å­˜cookiesã€ç¼“å­˜ç­‰)</span></span>
<span class="line">    self<span class="token punctuation">.</span>urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">__del__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    self<span class="token punctuation">.</span>browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">process_response</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># åªå¤„ç†åœ¨spider.urlsåˆ—è¡¨ä¸­çš„URL</span></span>
<span class="line">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>url <span class="token keyword">in</span> spider<span class="token punctuation">.</span>urls<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Processing URL with selenium: </span><span class="token interpolation"><span class="token punctuation">{</span>request<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        browser <span class="token operator">=</span> spider<span class="token punctuation">.</span>browser</span>
<span class="line">        browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span></span>
<span class="line">        browser<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">&quot;window.scrollTo(0, document.body.scrollHeight)&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">        page_text <span class="token operator">=</span> browser<span class="token punctuation">.</span>page_source<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># åˆ›å»ºæ–°çš„å“åº”å¯¹è±¡</span></span>
<span class="line">        new_response <span class="token operator">=</span> HtmlResponse<span class="token punctuation">(</span></span>
<span class="line">            url<span class="token operator">=</span>request<span class="token punctuation">.</span>url<span class="token punctuation">,</span></span>
<span class="line">            body<span class="token operator">=</span>page_text<span class="token punctuation">,</span></span>
<span class="line">            encoding<span class="token operator">=</span><span class="token string">&#39;utf-8&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            request<span class="token operator">=</span>request</span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Selenium processed response for </span><span class="token interpolation"><span class="token punctuation">{</span>request<span class="token punctuation">.</span>url<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># å…³é”®ä¿®å¤ï¼šæ‰‹åŠ¨è°ƒç”¨è¯·æ±‚çš„å›è°ƒå‡½æ•°     ç”µè„‘ç‰ˆæœ¬æ²¡æœ‰åŠæ³•è‡ªåŠ¨å›è°ƒ éœ€è¦æ‰‹åŠ¨è°ƒç”¨  </span></span>
<span class="line">        <span class="token keyword">if</span> request<span class="token punctuation">.</span>callback<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">return</span> request<span class="token punctuation">.</span>callback<span class="token punctuation">(</span>new_response<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">return</span> new_response</span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> response</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="è‡ªåŠ¨æŠ“å–é“¾æ¥" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨æŠ“å–é“¾æ¥"><span>è‡ªåŠ¨æŠ“å–é“¾æ¥</span></a></h2><p><code>rom scrapy.spiders import CrawlSpider, Rule</code> æ˜¯ Scrapy æ¡†æ¶ä¸­ç”¨äºæ„å»º <strong>è§„åˆ™çˆ¬è™«ï¼ˆCrawlSpiderï¼‰</strong> çš„å…³é”®å¯¼å…¥è¯­å¥</p><blockquote><p>CrawlSpider</p></blockquote><ul><li><strong>ç”¨é€”</strong>ï¼š<code>CrawlSpider</code> æ˜¯ Scrapy æä¾›çš„ä¸€ä¸ªé«˜çº§çˆ¬è™«ç±»ï¼Œä¸“é—¨ç”¨äº <strong>æŒ‰è§„åˆ™è‡ªåŠ¨è·Ÿè¸ªé“¾æ¥</strong> çš„çˆ¬å–åœºæ™¯ï¼ˆæ¯”å¦‚æ•´ç«™çˆ¬å–ï¼‰ã€‚</li><li>ç‰¹ç‚¹ï¼š <ul><li>è‡ªåŠ¨æ ¹æ®é¢„è®¾è§„åˆ™ï¼ˆ<code>Rule</code>ï¼‰æå–é¡µé¢ä¸­çš„é“¾æ¥ï¼Œå¹¶å†³å®šæ˜¯å¦è·Ÿè¿›ã€‚</li><li>é€‚åˆçˆ¬å–ç›®å½•å‹ç½‘ç«™ï¼ˆå¦‚æ–°é—»ç½‘ç«™ã€åšå®¢ã€ç”µå•†å•†å“åˆ—è¡¨ï¼‰</li></ul></li></ul><blockquote><p>Rule</p></blockquote><ul><li>ä½œç”¨ï¼šå®šä¹‰çˆ¬è™«çš„é“¾æ¥æå–å’Œè·Ÿè¿›è§„åˆ™, ä¸»è¦åŒ…æ‹¬ï¼š <ul><li><strong>å¦‚ä½•ä»é¡µé¢æå–é“¾æ¥</strong>ï¼ˆä½¿ç”¨ <code>LinkExtractor</code>ï¼‰ã€‚</li><li><strong>æ˜¯å¦è·Ÿè¿›è¿™äº›é“¾æ¥</strong>ï¼ˆ<code>follow=True/False</code>ï¼‰ã€‚</li><li><strong>å¦‚ä½•å¤„ç†æå–çš„é“¾æ¥</strong>ï¼ˆå›è°ƒå‡½æ•° <code>callback</code>ï¼‰ã€‚</li></ul></li></ul><blockquote><p>LinkExtractor</p></blockquote><p><code>from scrapy.linkextractors import LinkExtractor</code> æ˜¯ Scrapy æ¡†æ¶ä¸­ç”¨äº <strong>ä»ç½‘é¡µä¸­è‡ªåŠ¨æå–é“¾æ¥</strong> çš„æ ¸å¿ƒç»„ä»¶ï¼Œé€šå¸¸ä¸ <code>CrawlSpider</code> å’Œ <code>Rule</code> é…åˆä½¿ç”¨</p><ul><li>restrict_xpaths ç”¨XPathé™å®šæå–é“¾æ¥çš„åŒºåŸŸ <ul><li>restrict_xpaths=&#39;//div[@class=&quot;pagination&quot;]&#39;ï¼ˆåªä»åˆ†é¡µåŒºåŸŸæå–ï¼‰</li></ul></li><li>restrict_css ç”¨CSSé€‰æ‹©å™¨é™å®šæå–åŒºåŸŸ <ul><li>restrict_css=&#39;.pagination&#39;</li></ul></li><li>allow ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å…è®¸çš„é“¾æ¥ <ul><li>allow=r&#39;/product/\\d+&#39;ï¼ˆåŒ¹é… /product/123/ï¼‰</li></ul></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>spiders <span class="token keyword">import</span> CrawlSpider<span class="token punctuation">,</span> Rule</span>
<span class="line"><span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>linkextractors <span class="token keyword">import</span> LinkExtractor</span>
<span class="line"><span class="token keyword">from</span> books<span class="token punctuation">.</span>items <span class="token keyword">import</span> BooksItem</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">BooksMsgSpider</span><span class="token punctuation">(</span>CrawlSpider<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    name <span class="token operator">=</span> <span class="token string">&quot;books_msg&quot;</span></span>
<span class="line">    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;toscrape.com&quot;</span><span class="token punctuation">]</span></span>
<span class="line">    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://books.toscrape.com/&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">    rules <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">        Rule<span class="token punctuation">(</span></span>
<span class="line">            <span class="token comment"># æŠ“å–å¯¹äºåœ°å€, å¹¶ä¸”è·Ÿè¿›è·å–è¯¦æƒ…é¡µé¢,æ‰§è¡Œå›è°ƒå‡½æ•°,åç»­ä¸éœ€è¦å†è¿›è¡Œè·³è½¬</span></span>
<span class="line">            LinkExtractor<span class="token punctuation">(</span>restrict_css<span class="token operator">=</span><span class="token string">&quot;.product_pod&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            callback<span class="token operator">=</span><span class="token string">&#39;parse&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            follow<span class="token operator">=</span> <span class="token boolean">False</span></span>
<span class="line">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        Rule<span class="token punctuation">(</span> </span>
<span class="line">            <span class="token comment"># æŠ“å–å¯¹äºåœ°å€, è¿›è¡Œè·³è½¬,åç»­åœ¨è¿›è¡ŒæŠ“å–   follow = True åç»­ç»§ç»­ä½¿ç”¨è¯¥æ–¹å¼æŠ“å–æ•°æ®è¿æ¥,è¿›è¡Œè·³è½¬</span></span>
<span class="line">            LinkExtractor<span class="token punctuation">(</span>restrict_xpaths<span class="token operator">=</span><span class="token string">&#39;//li[@class=&quot;next&quot;]/a&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">            follow <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,81)])])}const o=n(t,[["render",l]]),u=JSON.parse('{"path":"/spider/09-Scrapy.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"scrapyçš„æ¦‚å¿µ","slug":"scrapyçš„æ¦‚å¿µ","link":"#scrapyçš„æ¦‚å¿µ","children":[{"level":3,"title":"çˆ¬è™«å·¥ä½œæµç¨‹","slug":"çˆ¬è™«å·¥ä½œæµç¨‹","link":"#çˆ¬è™«å·¥ä½œæµç¨‹","children":[]},{"level":3,"title":"scrapyçš„æµç¨‹","slug":"scrapyçš„æµç¨‹","link":"#scrapyçš„æµç¨‹","children":[]},{"level":3,"title":"Scrapy","slug":"scrapy","link":"#scrapy","children":[]},{"level":3,"title":"scrapy Shellä½¿ç”¨","slug":"scrapy-shellä½¿ç”¨","link":"#scrapy-shellä½¿ç”¨","children":[]}]},{"level":2,"title":"scrapyè¿›é˜¶","slug":"scrapyè¿›é˜¶","link":"#scrapyè¿›é˜¶","children":[{"level":3,"title":"ä»£ç†","slug":"ä»£ç†","link":"#ä»£ç†","children":[]},{"level":3,"title":"è·å–è¯¦ç»†ä¿¡æ¯","slug":"è·å–è¯¦ç»†ä¿¡æ¯","link":"#è·å–è¯¦ç»†ä¿¡æ¯","children":[]},{"level":3,"title":"ä¸­é—´ä»¶ä¸­è®¾ç½®UA","slug":"ä¸­é—´ä»¶ä¸­è®¾ç½®ua","link":"#ä¸­é—´ä»¶ä¸­è®¾ç½®ua","children":[]},{"level":3,"title":"postè¯·æ±‚","slug":"postè¯·æ±‚","link":"#postè¯·æ±‚","children":[]}]},{"level":2,"title":"scrapyä¸selenium","slug":"scrapyä¸selenium","link":"#scrapyä¸selenium","children":[]},{"level":2,"title":"è‡ªåŠ¨æŠ“å–é“¾æ¥","slug":"è‡ªåŠ¨æŠ“å–é“¾æ¥","link":"#è‡ªåŠ¨æŠ“å–é“¾æ¥","children":[]}],"git":{},"filePathRelative":"spider/09-Scrapy.md"}');export{o as comp,u as data};
