import{_ as s,c as a,a as p,o as e}from"./app-DOVazbfl.js";const t={};function l(i,n){return e(),a("div",null,[...n[0]||(n[0]=[p(`<h2 id="drissionpage" tabindex="-1"><a class="header-anchor" href="#drissionpage"><span>DrissionPage</span></a></h2><p>DrissionPage 是一个基于 Python 的网页自动化库，结合了 <strong>Selenium</strong> 的浏览器控制能力和 <strong>requests</strong> 的高效网络请求功能，适用于爬虫、自动化测试和 RPA（机器人流程自动化）</p><blockquote><p>安装: <code>pip install DrissionPage </code> 安装对应第三方模块</p></blockquote><h3 id="selenium和drissionpage的区别" tabindex="-1"><a class="header-anchor" href="#selenium和drissionpage的区别"><span>selenium和DrissionPage的区别</span></a></h3><p>Selenium和DrissionPage都是用于Web自动化和数据采集的Python库, DrissionPage可以看作是Selenium的现代化改进版本，特别适合<strong>以数据采集为主要目的</strong>的场景。它解决了Selenium在速度和反检测方面的痛点，提供了更优雅的API。而Selenium在<strong>传统自动化测试领域</strong>仍然有其不可替代的地位，特别是需要严格遵循测试标准和跨浏览器测试的场景</p><blockquote><p>Selenium</p></blockquote><ul><li>主要进行Web应用功能测试</li><li>支持多种浏览器</li><li>团队熟悉Selenium</li></ul><blockquote><p>DrissionPage</p></blockquote><ul><li>主要进行数据采集和爬虫开发</li><li>需要绕过复杂的反爬机制</li><li>追求更高的执行效率</li><li>喜欢更简洁的API设计</li><li>处理大量页面时关注资源消耗</li></ul><h2 id="基础使用" tabindex="-1"><a class="header-anchor" href="#基础使用"><span>基础使用</span></a></h2><h3 id="基础属性与方法" tabindex="-1"><a class="header-anchor" href="#基础属性与方法"><span>基础属性与方法</span></a></h3><ul><li>标签对象.html属性: 获取当前页面的html源码</li><li>标签对象.title属性: 获取网页的title标签内容</li><li>标签对象.url属性: 获取网页的url信息</li><li>browser.quit(): 关闭浏览器</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Chromium用于控制浏览器页面对象 </span></span>
<span class="line"><span class="token keyword">from</span> DrissionPage <span class="token keyword">import</span> Chromium</span>
<span class="line"><span class="token comment"># 连接浏览器</span></span>
<span class="line">browser <span class="token operator">=</span> Chromium<span class="token punctuation">(</span><span class="token punctuation">)</span>  </span>
<span class="line"><span class="token comment"># 获取最新标签页对象</span></span>
<span class="line">tab <span class="token operator">=</span> browser<span class="token punctuation">.</span>latest_tab  </span>
<span class="line"><span class="token comment"># 访问网页</span></span>
<span class="line">tab<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://www.baidu.com&#39;</span><span class="token punctuation">)</span>  </span>
<span class="line"><span class="token comment"># 获取当前页面的html源码</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>tab<span class="token punctuation">.</span>html<span class="token punctuation">)</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="标签页管理" tabindex="-1"><a class="header-anchor" href="#标签页管理"><span>标签页管理</span></a></h3><blockquote><p>位置: 标签页管理</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 标签页一 tab</span></span>
<span class="line">tab <span class="token operator">=</span> browser<span class="token punctuation">.</span>latest_tab  </span>
<span class="line">tab<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://www.baidu.com&#39;</span><span class="token punctuation">)</span>  </span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>tab<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token comment"># 获取网页的标题</span></span>
<span class="line">time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 标签页 新建一个标签页并访问网址tab2网页</span></span>
<span class="line">tab2 <span class="token operator">=</span> browser<span class="token punctuation">.</span>new_tab<span class="token punctuation">(</span><span class="token string">&#39;https://www.taob.com&#39;</span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>tab2<span class="token punctuation">.</span>title<span class="token punctuation">)</span> <span class="token comment"># 获取网页的标题</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 新建一个标签页并访问网址</span></span>
<span class="line">tab3 <span class="token operator">=</span> browser<span class="token punctuation">.</span>new_tab<span class="token punctuation">(</span><span class="token string">&#39;https://drissionpage.cn/&#39;</span><span class="token punctuation">)</span>  </span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>tab3<span class="token punctuation">.</span>title<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>get_tab() 通过浏览器对象 参数切换对应标签页面</p></blockquote><p>标签页没有焦点的概念，多个标签页可以并行操作 , 不需要显示对应的页面也能操作</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">browser <span class="token operator">=</span> Chromium<span class="token punctuation">(</span><span class="token punctuation">)</span>  </span>
<span class="line"><span class="token comment"># 通过标签页索引进行获取</span></span>
<span class="line">dom <span class="token operator">=</span> browser<span class="token punctuation">.</span>get_tab<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 注意是倒置的</span></span>
<span class="line"><span class="token comment"># 通过网页标题进行选择</span></span>
<span class="line">dom <span class="token operator">=</span> browser<span class="token punctuation">.</span>get_tab<span class="token punctuation">(</span>title<span class="token operator">=</span>tab1<span class="token punctuation">.</span>title<span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 通过网页地址进行选择</span></span>
<span class="line">dom <span class="token operator">=</span> browser<span class="token punctuation">.</span>get_tab<span class="token punctuation">(</span>url<span class="token operator">=</span>tab1<span class="token punctuation">.</span>url<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 浏览器显示那个页面 这个序号是倒置的最前面的在最后面</span></span>
<span class="line">browser<span class="token punctuation">.</span>activate_tab<span class="token punctuation">(</span>browser<span class="token punctuation">.</span>tab_ids<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>管理单个页面的历史记录</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">browser <span class="token operator">=</span> Chromium<span class="token punctuation">(</span><span class="token punctuation">)</span> </span>
<span class="line">tab <span class="token operator">=</span> browser<span class="token punctuation">.</span>latest_tab  </span>
<span class="line">tab<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://www.baidu.com/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">tab<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://www.taobao.com/&#39;</span><span class="token punctuation">)</span></span>
<span class="line">time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">tab<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://www.jd.com/&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">tab<span class="token punctuation">.</span>back<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># 后退</span></span>
<span class="line">time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">)</span></span>
<span class="line">tab<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 前进</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="浏览器配置" tabindex="-1"><a class="header-anchor" href="#浏览器配置"><span>浏览器配置</span></a></h3><blockquote><p>位置: 浏览器启动设置</p></blockquote><ul><li><code>set_paths(browser_path,local_port,user_data_path)</code><ul><li>browser_path: 浏览器可执行文件路径</li><li>local_port: 浏览器要使用的本地端口号</li><li>download_path: 下载文件默认保存路径</li><li>user_data_path: 用户数据文件夹路径</li></ul></li><li><code>co1.set_timeouts(10, 10, 10)</code> 用于设置几种超时时间，单位为秒。 <ul><li><code>&#39;base&#39;</code>： 默认值None, 超时时间，用于元素等待</li><li><code>&#39;page_load&#39;</code>： 默认值None 页面加载超时时间</li><li><code>&#39;script&#39;</code>： 默认值None 网络请求运行超时时间</li></ul></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment">#  ChromiumOptions设置配置信息</span></span>
<span class="line"><span class="token keyword">from</span> DrissionPage <span class="token keyword">import</span> Chromium<span class="token punctuation">,</span>ChromiumOptions</span>
<span class="line">options <span class="token operator">=</span> ChromiumOptions<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 无头模式 不显示浏览器&#39;</span></span>
<span class="line">options<span class="token punctuation">.</span>headless<span class="token punctuation">(</span><span class="token punctuation">)</span>  	 </span>
<span class="line"><span class="token comment"># 设置浏览器最大显示</span></span>
<span class="line">options<span class="token punctuation">.</span>set_argument<span class="token punctuation">(</span><span class="token string">&#39;--start-maximized&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 匿名模式 浏览器无痕模式</span></span>
<span class="line">options<span class="token punctuation">.</span>incognito<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 禁用GPU加速，通常用于解决一些图形相关的问题,(减少内存使用)</span></span>
<span class="line">options<span class="token punctuation">.</span>set_argument<span class="token punctuation">(</span><span class="token string">&quot;--disable-gpu&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 设置全局元素加载超时、页面超时和 网络请求超时各为 10 秒</span></span>
<span class="line">options<span class="token punctuation">.</span>set_timeouts<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 禁用沙盒模式(提高权限)  在liunx系统中需要设置</span></span>
<span class="line">options<span class="token punctuation">.</span>set_argument<span class="token punctuation">(</span><span class="token string">&#39;--no-sandbox&#39;</span><span class="token punctuation">)</span>  </span>
<span class="line"><span class="token comment"># 设置用户数据存储</span></span>
<span class="line">options<span class="token punctuation">.</span>set_paths<span class="token punctuation">(</span>local_port<span class="token operator">=</span><span class="token number">9111</span><span class="token punctuation">,</span> user_data_path<span class="token operator">=</span><span class="token string">r&#39;C:/Users/15116/Desktop/lianxi/userdata&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 以该配置创建浏览器页面对象</span></span>
<span class="line">page <span class="token operator">=</span> Chromium<span class="token punctuation">(</span>addr_or_opts<span class="token operator">=</span>options<span class="token punctuation">)</span><span class="token punctuation">.</span>latest_tab</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="网页处理" tabindex="-1"><a class="header-anchor" href="#网页处理"><span>网页处理</span></a></h2><h3 id="查询元素" tabindex="-1"><a class="header-anchor" href="#查询元素"><span>查询元素</span></a></h3><ul><li><code>ele </code> 用于查找其内部第一个符合条件的元素</li><li><code>eles</code> 此方法与<code>ele()</code>相似，返回匹配到的所有元素组成的列表 <ul><li>timeout 等待元素出现的超时时间(秒)</li></ul></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># id选择器  超过2秒未返回None</span></span>
<span class="line">text_input <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&quot;#key&quot;</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> </span>
<span class="line"></span>
<span class="line"><span class="token comment"># xpath 方式查找元素</span></span>
<span class="line">text_input <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;xpath://*[@id=&quot;key&quot;]&#39;</span><span class="token punctuation">)</span> </span>
<span class="line"></span>
<span class="line"><span class="token comment"># 用selector 方式查找元素</span></span>
<span class="line">ele <span class="token operator">=</span> tab<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;css:#s-top-left&gt;a&#39;</span><span class="token punctuation">)</span>  </span>
<span class="line">ele <span class="token operator">=</span> tab<span class="token punctuation">.</span>eles<span class="token punctuation">(</span><span class="token string">&#39;css:#s-top-left&gt;a&#39;</span><span class="token punctuation">)</span>  </span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ele<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token comment">#获取元素文本内容</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># page.get(&quot;https://www.mi.com/shop&quot;)</span></span>
<span class="line"><span class="token comment"># 小米网站: 浏览器对象page页也能直接获取元素节点</span></span>
<span class="line">ele <span class="token operator">=</span> page<span class="token punctuation">(</span><span class="token string">&#39;#J_siteDownloadApp&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ele<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">ele_msg <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;.site-topbar&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ele_msg<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&quot;#J_miniCartTrigger&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">ele_msg <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;xpath://*[@id=&quot;app&quot;]/div[1]/div/div[2]/div[1]/div[1]/a[9]&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">原写法</th><th style="text-align:center;">简化写法</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;"><code>@id</code></td><td style="text-align:center;"><code>#</code></td><td style="text-align:center;">表示 id 属性，简化写法只在语句最前面且单独使用时生效</td></tr><tr><td style="text-align:center;"><code>@class</code></td><td style="text-align:center;"><code>.</code></td><td style="text-align:center;">表示 class 属性，简化写法只在语句最前面且单独使用时生效</td></tr><tr><td style="text-align:center;"><code>text</code></td><td style="text-align:center;"><code>tx</code></td><td style="text-align:center;">按文本匹配</td></tr><tr><td style="text-align:center;"><code>@text()</code></td><td style="text-align:center;"><code>@tx()</code></td><td style="text-align:center;">按文本查找，与 @ 或 @@ 配合使用时</td></tr><tr><td style="text-align:center;"><code>tag</code></td><td style="text-align:center;"><code>t</code></td><td style="text-align:center;">按标签类型匹配</td></tr><tr><td style="text-align:center;"><code>@tag()</code></td><td style="text-align:center;"><code>@t()</code></td><td style="text-align:center;">按元素名查找，与 @ 或 @@ 配合使用时</td></tr><tr><td style="text-align:center;"><code>xpath</code></td><td style="text-align:center;"><code>x</code></td><td style="text-align:center;">用 xpath 方式查找元素</td></tr><tr><td style="text-align:center;"><code>css</code></td><td style="text-align:center;"><code>c</code></td><td style="text-align:center;">用 css selector 方式查找元素</td></tr></tbody></table><h3 id="获取内容和属性" tabindex="-1"><a class="header-anchor" href="#获取内容和属性"><span>获取内容和属性</span></a></h3><blockquote><p>位置: 获取元素信息</p></blockquote><ul><li><code>tag</code> 此属性返回元素的标签名</li><li><code>text </code> 此属性返回元素内所有文本组合成的字符串</li><li><code>link </code> 此方法返回元素的href或src属性，没有对应属性则返回None</li><li><code>attr</code> 此方法返回元素某个 attribute 属性值</li><li><code>attrs</code> 此属性以字典形式返回元素所有属性及值</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ele<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token comment">#获取元素文本内容</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>ele<span class="token punctuation">.</span>attr<span class="token punctuation">(</span><span class="token string">&quot;href&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#获取元素属性</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 获取所有子节点的文本</span></span>
<span class="line">page<span class="token punctuation">.</span>eles<span class="token punctuation">(</span><span class="token string">&quot;css:.topbar-nav a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">.</span>texts<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取所有元素的href属性或src属性</span></span>
<span class="line">page<span class="token punctuation">.</span>eles<span class="token punctuation">(</span><span class="token string">&quot;css:.topbar-nav a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">.</span>links<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="iframe内容" tabindex="-1"><a class="header-anchor" href="#iframe内容"><span>iframe内容</span></a></h3><p>菜鸟教程的<code>iframe</code>通过ele可以直接获取</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 本库可以直接查找同域\` iframe \`里面的元素 </span></span>
<span class="line">page<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">dom <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&quot;#draggable&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于跨域的<code>iframe</code>，无法通过页面直接查找里面的元素，可以先获取到<code>iframe </code>元素，再在其下查找</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">tab <span class="token operator">=</span> Chromium<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>latest_tab</span>
<span class="line">iframe <span class="token operator">=</span> tab<span class="token punctuation">(</span><span class="token string">&#39;#iframe1&#39;</span><span class="token punctuation">)</span></span>
<span class="line">ele <span class="token operator">=</span> iframe<span class="token punctuation">(</span><span class="token string">&#39;#abc&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="等待" tabindex="-1"><a class="header-anchor" href="#等待"><span>等待</span></a></h3><blockquote><p>与全局超时进行互补,这是指定等待</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 设置全局超时（后备保障）</span></span>
<span class="line">options<span class="token punctuation">.</span>set_timeouts<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 先获取元素对象（可能此时元素尚未显示）</span></span>
<span class="line">element <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;tag:div&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 此方法用于等待元素从隐藏状态变成显示状态 </span></span>
<span class="line"><span class="token keyword">if</span> element<span class="token punctuation">.</span>wait<span class="token punctuation">.</span>displayed<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;元素已经显示&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 进行后续操作，比如点击</span></span>
<span class="line">    element<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 页面操作...</span></span>
<span class="line">tab<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://example.com&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 对关键元素使用显式等待（更精确控制）</span></span>
<span class="line"><span class="token keyword">if</span> tab<span class="token punctuation">.</span>wait<span class="token punctuation">.</span>ele_displayed<span class="token punctuation">(</span><span class="token string">&#39;tag:div&#39;</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 可以覆盖全局设置</span></span>
<span class="line">    <span class="token comment"># 元素已显示，继续操作</span></span>
<span class="line">    element <span class="token operator">=</span> tab<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;tag:div&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="交互元素" tabindex="-1"><a class="header-anchor" href="#交互元素"><span>交互元素</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 引入按键交互  </span></span>
<span class="line"><span class="token keyword">from</span> DrissionPage<span class="token punctuation">.</span>common <span class="token keyword">import</span> Keys</span>
<span class="line"><span class="token comment"># 输入内容</span></span>
<span class="line">text_input<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;美食&quot;</span><span class="token punctuation">)</span></span>
<span class="line">text_input<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 回车触发</span></span>
<span class="line">time<span class="token punctuation">.</span>seep<span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">)</span></span>
<span class="line">text_input<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#清空内容</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 进行下拉到底部</span></span>
<span class="line">page<span class="token punctuation">.</span>scroll<span class="token punctuation">.</span>to_bottom<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 等待2s</span></span>
<span class="line">time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 进行下拉到底部</span></span>
<span class="line">page<span class="token punctuation">.</span>scroll<span class="token punctuation">.</span>to_bottom<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 获取网页源码</span></span>
<span class="line">msg_data <span class="token operator">=</span> page<span class="token punctuation">.</span>html</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>msg_data<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="点击" tabindex="-1"><a class="header-anchor" href="#点击"><span>点击</span></a></h4><blockquote><p><code>click和click.left</code>用于左键点击元素。可选择模拟点击或 js 点击</p></blockquote><p>默认点击是: 自动选择最佳点击方式 (此处可不讲)</p><table><thead><tr><th style="text-align:center;">参数名称</th><th style="text-align:center;">类型</th><th style="text-align:center;">默认值</th><th>说明</th></tr></thead><tbody><tr><td style="text-align:center;"><code>by_js</code></td><td style="text-align:center;"><code>bool</code></td><td style="text-align:center;"><code>False</code></td><td>指定点击行为方式。 为<code>None</code>时，如不被遮挡，用模拟点击，否则用 js 点击 ,为<code>True</code>时直接用 js 点击； 为<code>False</code>时强制模拟点击，被遮挡也会进行点击</td></tr><tr><td style="text-align:center;"><code>timeout</code></td><td style="text-align:center;"><code>float</code></td><td style="text-align:center;"><code>1.5</code></td><td>模拟点击的超时时间（秒），等待元素可见、可用、进入视口</td></tr><tr><td style="text-align:center;"><code>wait_stop</code></td><td style="text-align:center;"><code>bool</code></td><td style="text-align:center;"><code>True</code></td><td>点击前是否等待元素停止运动</td></tr></tbody></table><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 获取点击元素</span></span>
<span class="line">but_page <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;xpath://&#39;</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 进行点击</span></span>
<span class="line">but_page<span class="token punctuation">.</span>click<span class="token punctuation">(</span>by_js<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">but_page<span class="token punctuation">.</span>click<span class="token punctuation">.</span>left<span class="token punctuation">(</span>by_js<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="动作链" tabindex="-1"><a class="header-anchor" href="#动作链"><span>动作链</span></a></h3><p>动作链可以在浏览器上完成一系列交互行为，如鼠标移动、鼠标点击、键盘输入</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">page <span class="token operator">=</span> browser<span class="token punctuation">.</span>latest_tab</span>
<span class="line">page<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://www.runoob.com/try/try.php?filename=jqueryui-api-droppable&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 左键按住元素</span></span>
<span class="line">page<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>hold<span class="token punctuation">(</span><span class="token string">&#39;#draggable&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 向右移动鼠标300像素</span></span>
<span class="line">page<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>right<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 释放左键</span></span>
<span class="line">page<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 小米网站进行鼠标移动</span></span>
<span class="line">page<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&#39;https://www.mi.com/shop&#39;</span><span class="token punctuation">)</span></span>
<span class="line">xiao <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;xpath://*[@id=&quot;J_siteDownloadApp&quot;]&#39;</span><span class="token punctuation">)</span></span>
<span class="line">page<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>move_to<span class="token punctuation">(</span>ele_or_loc<span class="token operator">=</span>xiao<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="京东案例" tabindex="-1"><a class="header-anchor" href="#京东案例"><span>京东案例</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> DrissionPage <span class="token keyword">import</span> Chromium<span class="token punctuation">,</span> ChromiumOptions</span>
<span class="line"><span class="token keyword">from</span> DrissionPage<span class="token punctuation">.</span>common <span class="token keyword">import</span> Keys</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree</span>
<span class="line"><span class="token keyword">from</span> DrissionPage<span class="token punctuation">.</span>errors <span class="token keyword">import</span> <span class="token operator">*</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">init_browser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    options <span class="token operator">=</span> ChromiumOptions<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 设置浏览器最大显示</span></span>
<span class="line">    options<span class="token punctuation">.</span>set_argument<span class="token punctuation">(</span><span class="token string">&#39;--start-maximized&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 禁用GPU加速，通常用于解决一些图形相关的问题,(减少内存使用)</span></span>
<span class="line">    options<span class="token punctuation">.</span>set_argument<span class="token punctuation">(</span><span class="token string">&quot;--disable-gpu&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 设置全局元素加载超时、页面超时和 网络请求超时各为 10 秒</span></span>
<span class="line">    options<span class="token punctuation">.</span>set_timeouts<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 禁用沙盒模式(提高权限)  在liunx系统中需要设置</span></span>
<span class="line">    options<span class="token punctuation">.</span>set_argument<span class="token punctuation">(</span><span class="token string">&#39;--no-sandbox&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 设置用户数据存储</span></span>
<span class="line">    options<span class="token punctuation">.</span>set_paths<span class="token punctuation">(</span>local_port<span class="token operator">=</span><span class="token number">9111</span><span class="token punctuation">,</span> user_data_path<span class="token operator">=</span><span class="token string">r&#39;C:\\Users\\15116\\Desktop\\lianxi\\jdmsg&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    browser <span class="token operator">=</span> Chromium<span class="token punctuation">(</span>addr_or_opts<span class="token operator">=</span>options<span class="token punctuation">)</span></span>
<span class="line">    page <span class="token operator">=</span> browser<span class="token punctuation">.</span>latest_tab</span>
<span class="line">    page<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://www.jd.com/&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    switch_html<span class="token punctuation">(</span>page<span class="token punctuation">,</span> browser<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">switch_html</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> browser<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 选择器进行输入内容 跳转新页面</span></span>
<span class="line">    inp <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&quot;#key&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    inp<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;衣服&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    inp<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">(</span>Keys<span class="token punctuation">.</span>ENTER<span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">    get_page_html<span class="token punctuation">(</span>page<span class="token punctuation">,</span> browser<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">get_page_html</span><span class="token punctuation">(</span>page<span class="token punctuation">,</span> browser<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    page<span class="token punctuation">.</span>scroll<span class="token punctuation">.</span>to_bottom<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">    page<span class="token punctuation">.</span>scroll<span class="token punctuation">.</span>to_bottom<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    dom <span class="token operator">=</span> page<span class="token punctuation">.</span>eles<span class="token punctuation">(</span><span class="token string">&#39;xpath://div[@class=&quot;_wrapper_1h3wy_3 plugin_goodsCardWrapper _row_6_1h3wy_13&quot;]&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    title <span class="token operator">=</span> page<span class="token punctuation">.</span>eles<span class="token punctuation">(</span><span class="token string">&#39;xpath://div[@class=&quot;_wrapper_1h3wy_3 plugin_goodsCardWrapper _row_6_1h3wy_13&quot;]//div[@class=&quot;_wrapper_8g5fc_1&quot;]&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> i<span class="token punctuation">,</span> tit <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>dom<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>tit<span class="token punctuation">.</span>attr<span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        i<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 获取新页面的窗口信息</span></span>
<span class="line">        dom <span class="token operator">=</span> browser<span class="token punctuation">.</span>get_tab<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>title<span class="token punctuation">)</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">        dom<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">        next_dom <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&quot;._pagination_next_1jczn_8&quot;</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">        next_dom<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        get_page_html<span class="token punctuation">(</span>page<span class="token punctuation">,</span> browser<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">except</span> ElementNotFoundError <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">&quot;成功&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># xml = etree.HTML(page.html)</span></span>
<span class="line">    <span class="token comment"># xml.xpath(&#39;//div[@class=&quot;_wrapper_1h3wy_3 plugin_goodsCardWrapper _row_6_1h3wy_13&quot;]//div[@class=&quot;_wrapper_8g5fc_1&quot;]/@title&#39;)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    init_browser<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="滑块验证案例" tabindex="-1"><a class="header-anchor" href="#滑块验证案例"><span>滑块验证案例</span></a></h2><p>云码平台: <code>https://console.jfbym.com/own/index/index.html</code></p><ul><li>选择产品和测试, 选择对应类型进入对应文档</li><li>在线测试: <ul><li>slide_image 滑块图片</li><li>background_image 背景图片 <ul><li>上传两种图片可以做测试</li><li>可以测试出滑块需要移动的距离</li></ul></li></ul></li><li>可以演示多个接口的操作</li></ul><p>测试有赞平台: <code>https://account.youzan.com/login</code></p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> DrissionPage <span class="token keyword">import</span> Chromium<span class="token punctuation">,</span> ChromiumOptions</span>
<span class="line"><span class="token keyword">from</span> DrissionPage<span class="token punctuation">.</span>common <span class="token keyword">import</span> Actions</span>
<span class="line"><span class="token keyword">import</span> time<span class="token punctuation">,</span> json</span>
<span class="line"><span class="token keyword">import</span> base64</span>
<span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"><span class="token keyword">from</span> jsonpath <span class="token keyword">import</span> jsonpath</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置打开浏览器 并且设置默认值</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">set_spider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    options <span class="token operator">=</span> ChromiumOptions<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    options<span class="token punctuation">.</span>set_paths<span class="token punctuation">(</span>local_port<span class="token operator">=</span><span class="token string">&quot;9333&quot;</span><span class="token punctuation">,</span> user_data_path<span class="token operator">=</span><span class="token string">&#39;C:/Users/15116/Desktop/lianxi/youzhan&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 无沙盒模式</span></span>
<span class="line">    options<span class="token punctuation">.</span>set_argument<span class="token punctuation">(</span><span class="token string">&#39;--no-sandbox&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 禁用 GPU 加速，通常用于解决一些图形相关的问题</span></span>
<span class="line">    options<span class="token punctuation">.</span>set_argument<span class="token punctuation">(</span><span class="token string">&quot;--disable-gpu&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">#  设置页面加载超时、脚本超时和网络超时的时间为 10 秒</span></span>
<span class="line">    options<span class="token punctuation">.</span>set_timeouts<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 以该配置创建浏览器页面对象</span></span>
<span class="line">    browser <span class="token operator">=</span> Chromium<span class="token punctuation">(</span>addr_or_opts<span class="token operator">=</span>options<span class="token punctuation">)</span></span>
<span class="line">    page <span class="token operator">=</span> browser<span class="token punctuation">.</span>latest_tab</span>
<span class="line">    spider_msg<span class="token punctuation">(</span>page<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">spider_msg</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    page<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;https://account.youzan.com/login?from_source=baidu_pz_shouye_l5&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 选择对应元素</span></span>
<span class="line">    but_click <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;xpath://*[@id=&quot;app&quot;]/div/div[1]/div/div/div[1]/div&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    but_click<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 等待1s</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span></span>
<span class="line">    pho_inp_con <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;xpath://*[@id=&quot;app&quot;]/div/div[1]/div/div/form/div[1]/div[2]/input&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    che_msg <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;xpath://*[@id=&quot;app&quot;]/div/div[1]/div/div/form/div[3]/div[1]/label/span/input&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 输入内容</span></span>
<span class="line">    pho_inp_con<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;12345678911&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    che_msg<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 点击获取验证码</span></span>
<span class="line">    yuanma <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;xpath://*[@id=&quot;app&quot;]/div/div[1]/div/div/form/div[2]/div[2]&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    yuanma<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 获取整个滑块的大小</span></span>
<span class="line">    box_size <span class="token operator">=</span> page<span class="token punctuation">.</span>ele<span class="token punctuation">(</span><span class="token string">&#39;xpath:/html/body/div[4]/div/div/div&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 进行等待元素的显示</span></span>
<span class="line">    bol <span class="token operator">=</span> box_size<span class="token punctuation">.</span>wait<span class="token punctuation">.</span>displayed<span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> bol<span class="token punctuation">:</span></span>
<span class="line">        log <span class="token operator">=</span> bol<span class="token punctuation">.</span>rect<span class="token punctuation">.</span>corners</span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># 进行截图, 保存到本地</span></span>
<span class="line">        page<span class="token punctuation">.</span>get_screenshot<span class="token punctuation">(</span>path<span class="token operator">=</span><span class="token string">&#39;./img&#39;</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">&#39;pic.jpg&#39;</span><span class="token punctuation">,</span> left_top<span class="token operator">=</span>log<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> right_bottom<span class="token operator">=</span>log<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">        ver_data<span class="token punctuation">(</span>page<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取图片进行自动化滑块验证</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">ver_data</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;./img/pic.jpg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;rb&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 读取图片的数据</span></span>
<span class="line">        data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        verify<span class="token punctuation">(</span>data<span class="token punctuation">,</span> page<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置云码函数</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">verify</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    url <span class="token operator">=</span> <span class="token string">&quot;http://api.jfbym.com/api/YmServer/customApi&quot;</span></span>
<span class="line">    data <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;token&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;RJYp5oyWpTsacY3dlxYlxKh61ekP1XpiIZfwJU6sFUM&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;22222&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;image&quot;</span><span class="token punctuation">:</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    _headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> headers<span class="token operator">=</span>_headers<span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    data_size <span class="token operator">=</span> jsonpath<span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token string">&#39;$..data..data&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>data_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;data_size&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 设置动作链</span></span>
<span class="line">    ac <span class="token operator">=</span> Actions<span class="token punctuation">(</span>page<span class="token punctuation">)</span>  <span class="token comment"># //*[@id=&quot;slideBlockRef&quot;] //*[@id=&quot;slideIconRef&quot;]</span></span>
<span class="line">    ac<span class="token punctuation">.</span>hold<span class="token punctuation">(</span><span class="token string">&#39;xpath://*[@class=&quot;icon arrow&quot;]&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span>right<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>data_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span></span>
<span class="line">    ac<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 释放鼠标左键</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    set_spider<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="图片验证" tabindex="-1"><a class="header-anchor" href="#图片验证"><span>图片验证</span></a></h2>`,63)])])}const o=s(t,[["render",l]]),u=JSON.parse('{"path":"/spider/06-DrissionPage.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"DrissionPage","slug":"drissionpage","link":"#drissionpage","children":[{"level":3,"title":"selenium和DrissionPage的区别","slug":"selenium和drissionpage的区别","link":"#selenium和drissionpage的区别","children":[]}]},{"level":2,"title":"基础使用","slug":"基础使用","link":"#基础使用","children":[{"level":3,"title":"基础属性与方法","slug":"基础属性与方法","link":"#基础属性与方法","children":[]},{"level":3,"title":"标签页管理","slug":"标签页管理","link":"#标签页管理","children":[]},{"level":3,"title":"浏览器配置","slug":"浏览器配置","link":"#浏览器配置","children":[]}]},{"level":2,"title":"网页处理","slug":"网页处理","link":"#网页处理","children":[{"level":3,"title":"查询元素","slug":"查询元素","link":"#查询元素","children":[]},{"level":3,"title":"获取内容和属性","slug":"获取内容和属性","link":"#获取内容和属性","children":[]},{"level":3,"title":"iframe内容","slug":"iframe内容","link":"#iframe内容","children":[]},{"level":3,"title":"等待","slug":"等待","link":"#等待","children":[]},{"level":3,"title":"交互元素","slug":"交互元素","link":"#交互元素","children":[]},{"level":3,"title":"动作链","slug":"动作链","link":"#动作链","children":[]}]},{"level":2,"title":"京东案例","slug":"京东案例","link":"#京东案例","children":[]},{"level":2,"title":"滑块验证案例","slug":"滑块验证案例","link":"#滑块验证案例","children":[]},{"level":2,"title":"图片验证","slug":"图片验证","link":"#图片验证","children":[]}],"git":{},"filePathRelative":"spider/06-DrissionPage.md"}');export{o as comp,u as data};
