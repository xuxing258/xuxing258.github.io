<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>笔记分析</title><meta name="description" content="即使是微小的进步,日积月累也会产生惊人的变化">
    <link rel="preload" href="/book/assets/style-QXEKf4Y2.css" as="style"><link rel="stylesheet" href="/book/assets/style-QXEKf4Y2.css">
    <link rel="modulepreload" href="/book/assets/app-hJI7UlmO.js"><link rel="modulepreload" href="/book/assets/07-进程和线程与协程.html-BXeUlvt0.js">
    <link rel="prefetch" href="/book/assets/index.html-DwuSY1Ye.js" as="script"><link rel="prefetch" href="/book/assets/01-开班学习.html-CAmGmGYr.js" as="script"><link rel="prefetch" href="/book/assets/02-基础标签.html-DEFN28cp.js" as="script"><link rel="prefetch" href="/book/assets/03-css基础知识.html-DmbWXYbN.js" as="script"><link rel="prefetch" href="/book/assets/04-盒模型.html-DNUF0NDO.js" as="script"><link rel="prefetch" href="/book/assets/05-元素类型.html-B_vJRhCQ.js" as="script"><link rel="prefetch" href="/book/assets/06-文本文字属性.html-CrWc8Z4W.js" as="script"><link rel="prefetch" href="/book/assets/07-背景属性.html-CuWA0RC-.js" as="script"><link rel="prefetch" href="/book/assets/08-圆角、透明、渐变、鼠标.html-DwGXk65z.js" as="script"><link rel="prefetch" href="/book/assets/09-浮动.html-DEYRtN2b.js" as="script"><link rel="prefetch" href="/book/assets/10-定位.html-CH_jyASp.js" as="script"><link rel="prefetch" href="/book/assets/11-表单与表格.html-Dcz9pPW9.js" as="script"><link rel="prefetch" href="/book/assets/12-选择器高级.html-DsqiK370.js" as="script"><link rel="prefetch" href="/book/assets/13-过渡与动画.html-C1AkDGgv.js" as="script"><link rel="prefetch" href="/book/assets/14-transform变形.html-CLN62QCB.js" as="script"><link rel="prefetch" href="/book/assets/15-弹性盒模型.html-8dFm4IGV.js" as="script"><link rel="prefetch" href="/book/assets/16-响应式布局、阿里图标等.html-DzE3LAWL.js" as="script"><link rel="prefetch" href="/book/assets/17-网格布局.html-BuO9iqfI.js" as="script"><link rel="prefetch" href="/book/assets/HTML_CSS规范.html-Co_EGEKb.js" as="script"><link rel="prefetch" href="/book/assets/index.html-DuPmovVc.js" as="script"><link rel="prefetch" href="/book/assets/补充.html-DTFvZeUX.js" as="script"><link rel="prefetch" href="/book/assets/01-web服务器.html-0o6QMVRE.js" as="script"><link rel="prefetch" href="/book/assets/02-django介绍.html-BPcp2OJn.js" as="script"><link rel="prefetch" href="/book/assets/03-路由层.html-CAp7B5J2.js" as="script"><link rel="prefetch" href="/book/assets/04-路由层和视图层.html-CRTQTza_.js" as="script"><link rel="prefetch" href="/book/assets/05-视图层.html-BVlmo3UD.js" as="script"><link rel="prefetch" href="/book/assets/06-模板层.html-T5t39Dhc.js" as="script"><link rel="prefetch" href="/book/assets/07-orm.html-zAJwxh76.js" as="script"><link rel="prefetch" href="/book/assets/08-orm.html-DWof-Frb.js" as="script"><link rel="prefetch" href="/book/assets/09-orm.html-8fXrG3G9.js" as="script"><link rel="prefetch" href="/book/assets/10-orm.html-D4DD7xrK.js" as="script"><link rel="prefetch" href="/book/assets/11-orm.html-DKJGPkkX.js" as="script"><link rel="prefetch" href="/book/assets/12-图书管理系统.html-Cn47LekT.js" as="script"><link rel="prefetch" href="/book/assets/13-图书管理系统.html-0cR1yTqT.js" as="script"><link rel="prefetch" href="/book/assets/14-ajax.html-BfEHDTa3.js" as="script"><link rel="prefetch" href="/book/assets/15-form组件.html-nyKEB8_X.js" as="script"><link rel="prefetch" href="/book/assets/16-forms组件.html-LrhmJVpa.js" as="script"><link rel="prefetch" href="/book/assets/17-cookie和session.html-BsZekYGM.js" as="script"><link rel="prefetch" href="/book/assets/18-django中间件.html-Bwjyi6nR.js" as="script"><link rel="prefetch" href="/book/assets/19-auth模块.html-Dhvm7o5q.js" as="script"><link rel="prefetch" href="/book/assets/20-博客园项目.html-DFx4lRs6.js" as="script"><link rel="prefetch" href="/book/assets/21-博客园项目.html-C8YOr7VU.js" as="script"><link rel="prefetch" href="/book/assets/22-博客园项目.html-OGCE39Fu.js" as="script"><link rel="prefetch" href="/book/assets/23-博客园项目.html-BKkqdJJX.js" as="script"><link rel="prefetch" href="/book/assets/24-博客园项目.html-DsSjo92B.js" as="script"><link rel="prefetch" href="/book/assets/25-博客园项目.html-BPMnJ-1w.js" as="script"><link rel="prefetch" href="/book/assets/26-博客园项目.html-DgRRall3.js" as="script"><link rel="prefetch" href="/book/assets/27-博客园项目.html-BkYwWN--.js" as="script"><link rel="prefetch" href="/book/assets/28-linux基础.html-DFLu-9sv.js" as="script"><link rel="prefetch" href="/book/assets/28-vmware安装和ubuntu配置.html-BOLFLSbF.js" as="script"><link rel="prefetch" href="/book/assets/29-linux基础.html-Bv0antAh.js" as="script"><link rel="prefetch" href="/book/assets/30-linux进阶.html-Ccc8mLQz.js" as="script"><link rel="prefetch" href="/book/assets/31-部署.html-Duz0OYOQ.js" as="script"><link rel="prefetch" href="/book/assets/32-restful规范.html-C9VutdSZ.js" as="script"><link rel="prefetch" href="/book/assets/33-drf介绍.html-DEsfVcys.js" as="script"><link rel="prefetch" href="/book/assets/34-drf框架.html-M7z9NYjg.js" as="script"><link rel="prefetch" href="/book/assets/35-drf框架.html-BSygukHh.js" as="script"><link rel="prefetch" href="/book/assets/36-drf框架.html-DQx3UpK_.js" as="script"><link rel="prefetch" href="/book/assets/37-drf框架.html-AuoJQ94U.js" as="script"><link rel="prefetch" href="/book/assets/38-drf框架.html-ButlJBwm.js" as="script"><link rel="prefetch" href="/book/assets/39-drf项目.html-m206ePKh.js" as="script"><link rel="prefetch" href="/book/assets/day28-vmware安装和ubuntu配置.html-YS6Qdkp-.js" as="script"><link rel="prefetch" href="/book/assets/day29-linux基础.html-C_ibjDIO.js" as="script"><link rel="prefetch" href="/book/assets/day30-linux进阶.html-Cvu2lWkQ.js" as="script"><link rel="prefetch" href="/book/assets/day31-部署.html-B9OI21xK.js" as="script"><link rel="prefetch" href="/book/assets/Django总结.html-BKbH4NR2.js" as="script"><link rel="prefetch" href="/book/assets/index.html-BpI4Fd0a.js" as="script"><link rel="prefetch" href="/book/assets/01-认识JavaScript.html-B1gRLz1z.js" as="script"><link rel="prefetch" href="/book/assets/02-初学Javascript类型.html-DnDQjHff.js" as="script"><link rel="prefetch" href="/book/assets/03-运算符.html-BY7pP7U8.js" as="script"><link rel="prefetch" href="/book/assets/04-控制流程.html-D5yje75s.js" as="script"><link rel="prefetch" href="/book/assets/05-循环.html-CwHrgjZE.js" as="script"><link rel="prefetch" href="/book/assets/06-函数.html-XJFieblB.js" as="script"><link rel="prefetch" href="/book/assets/07-作用域.html-B8W1okN_.js" as="script"><link rel="prefetch" href="/book/assets/08-字符串与数组.html-DzPYaUjZ.js" as="script"><link rel="prefetch" href="/book/assets/09-定时器_Math.html-DlSBCAMF.js" as="script"><link rel="prefetch" href="/book/assets/10-日期对象.html-D0DBjUO_.js" as="script"><link rel="prefetch" href="/book/assets/11-ES6解构与扩展.html-hhhYgwpW.js" as="script"><link rel="prefetch" href="/book/assets/12-DOM基础.html-BkAg7NNJ.js" as="script"><link rel="prefetch" href="/book/assets/13-DOM与BOM.html-B7HAO0_b.js" as="script"><link rel="prefetch" href="/book/assets/14-事件.html-DQvAiGua.js" as="script"><link rel="prefetch" href="/book/assets/15-json与对象.html-DPgMbzSh.js" as="script"><link rel="prefetch" href="/book/assets/16-正则表达式.html-CWdskk-m.js" as="script"><link rel="prefetch" href="/book/assets/17-构造函数.html-BB2i7a91.js" as="script"><link rel="prefetch" href="/book/assets/18-Class类.html-Do7EtNZ2.js" as="script"><link rel="prefetch" href="/book/assets/19-promise和async.html-CRSHToP5.js" as="script"><link rel="prefetch" href="/book/assets/20-ajax.html-DHXjmqNy.js" as="script"><link rel="prefetch" href="/book/assets/21-本地存储.html-BbewLcu-.js" as="script"><link rel="prefetch" href="/book/assets/22-补充录播.html-0W83rdsD.js" as="script"><link rel="prefetch" href="/book/assets/23-补充录播代理.html-BWEoJV6i.js" as="script"><link rel="prefetch" href="/book/assets/index.html-BJY6gYkr.js" as="script"><link rel="prefetch" href="/book/assets/严格模式.html-CSYdycpy.js" as="script"><link rel="prefetch" href="/book/assets/时间线_异步加载.html-BulO7puk.js" as="script"><link rel="prefetch" href="/book/assets/知识补充.html-CImyt8Pg.js" as="script"><link rel="prefetch" href="/book/assets/01-react.html-DTXC3Aa3.js" as="script"><link rel="prefetch" href="/book/assets/02-函数组件.html-BcID9LmM.js" as="script"><link rel="prefetch" href="/book/assets/03-函数基础.html-Cc3FGhvi.js" as="script"><link rel="prefetch" href="/book/assets/04-组件通信.html-C5owQHgP.js" as="script"><link rel="prefetch" href="/book/assets/05-类组件的使用.html-km6b9bZj.js" as="script"><link rel="prefetch" href="/book/assets/06-脚手架.html-CBymxuX4.js" as="script"><link rel="prefetch" href="/book/assets/07-hook函数.html-BH5WDEg_.js" as="script"><link rel="prefetch" href="/book/assets/08-router.html-CtSsfVgO.js" as="script"><link rel="prefetch" href="/book/assets/09-reduc.html-CZNA9b1L.js" as="script"><link rel="prefetch" href="/book/assets/index.html-Cjmo_xjd.js" as="script"><link rel="prefetch" href="/book/assets/01-node.html-bvX0BJUk.js" as="script"><link rel="prefetch" href="/book/assets/02-fs模块.html-BkiFm3HC.js" as="script"><link rel="prefetch" href="/book/assets/03-模块化.html-Bq11nkqK.js" as="script"><link rel="prefetch" href="/book/assets/04-模块管理.html-CP2v48lA.js" as="script"><link rel="prefetch" href="/book/assets/05-http模块.html-PSXGC96O.js" as="script"><link rel="prefetch" href="/book/assets/06-express模块.html-COWtUUF2.js" as="script"><link rel="prefetch" href="/book/assets/07-koa模块.html-DqdUF0vw.js" as="script"><link rel="prefetch" href="/book/assets/08-mongoose.html-DXm_VX0T.js" as="script"><link rel="prefetch" href="/book/assets/09-mysql.html-zr0nvJbc.js" as="script"><link rel="prefetch" href="/book/assets/cookie跨域问题.html-Dv40ohBH.js" as="script"><link rel="prefetch" href="/book/assets/index.html-Bpds_5S1.js" as="script"><link rel="prefetch" href="/book/assets/模块补充.html-ugH5Aped.js" as="script"><link rel="prefetch" href="/book/assets/知识补充.html-CI7s1Kaq.js" as="script"><link rel="prefetch" href="/book/assets/阿里云程知识.html-D7YM0E65.js" as="script"><link rel="prefetch" href="/book/assets/01-python基础.html-n4WVEQ05.js" as="script"><link rel="prefetch" href="/book/assets/02-基本数据类型与变量.html-BcioS30q.js" as="script"><link rel="prefetch" href="/book/assets/03-用户交互与运算符.html-B3qZkAdc.js" as="script"><link rel="prefetch" href="/book/assets/04-流程控制-上.html-CQD1g-f5.js" as="script"><link rel="prefetch" href="/book/assets/05-流程控制-下.html-Cq6fP1lo.js" as="script"><link rel="prefetch" href="/book/assets/06_序列类型-字符串.html-ahHNaaHa.js" as="script"><link rel="prefetch" href="/book/assets/07_序列类型-列表_元组.html-C65Jejtg.js" as="script"><link rel="prefetch" href="/book/assets/08_散列类型-字典与集合.html-DKOAaQmI.js" as="script"><link rel="prefetch" href="/book/assets/09_函数基础上.html-CIs89lHC.js" as="script"><link rel="prefetch" href="/book/assets/10_函数基础下.html-DPT6tVTr.js" as="script"><link rel="prefetch" href="/book/assets/11_作用域与匿名函数.html-8SxKEx_v.js" as="script"><link rel="prefetch" href="/book/assets/12_匿名函数_内置高阶函数.html-BY1QdWop.js" as="script"><link rel="prefetch" href="/book/assets/13_装饰器_迭代器_生成器.html-CBlru0Uh.js" as="script"><link rel="prefetch" href="/book/assets/14_文件操作.html-OBqkuAVF.js" as="script"><link rel="prefetch" href="/book/assets/15_模块与包.html-q5EC8umR.js" as="script"><link rel="prefetch" href="/book/assets/16_第三方模块与常用模块.html-DiP3CTIp.js" as="script"><link rel="prefetch" href="/book/assets/17_初识面向对象.html-DCnZ2sXh.js" as="script"><link rel="prefetch" href="/book/assets/18_面向对象三大特征—封装.html--x8fqEpl.js" as="script"><link rel="prefetch" href="/book/assets/19_面向对象三大特征—继承_多态.html-Bq_Zh9_C.js" as="script"><link rel="prefetch" href="/book/assets/20_绑定方法_内置方法_异常.html-Do5GqPtD.js" as="script"><link rel="prefetch" href="/book/assets/21_网络编程基础.html-LlQ7_BJg.js" as="script"><link rel="prefetch" href="/book/assets/22_socket套接字.html-DtyCuXtB.js" as="script"><link rel="prefetch" href="/book/assets/23_非阻塞_IO多路复用.html-Ck9QnuAF.js" as="script"><link rel="prefetch" href="/book/assets/24_粘包_网盘项目.html-Dic44rXf.js" as="script"><link rel="prefetch" href="/book/assets/py总结.html-CBLEKBbM.js" as="script"><link rel="prefetch" href="/book/assets/index.html-C2VOCxlW.js" as="script"><link rel="prefetch" href="/book/assets/网盘项目.html-CFNmPhLB.js" as="script"><link rel="prefetch" href="/book/assets/01-爬虫简介.html-BUTOYV8s.js" as="script"><link rel="prefetch" href="/book/assets/02-requests请求.html-HBdd0Y0H.js" as="script"><link rel="prefetch" href="/book/assets/03-正则.html-CN56ymY7.js" as="script"><link rel="prefetch" href="/book/assets/04-解析数据.html-BJVVHnLi.js" as="script"><link rel="prefetch" href="/book/assets/05-selenium.html-CtVqinOj.js" as="script"><link rel="prefetch" href="/book/assets/06-DrissionPage.html-D8X6ReNb.js" as="script"><link rel="prefetch" href="/book/assets/07-进程和线程与协程2.html-oRXcuuGm.js" as="script"><link rel="prefetch" href="/book/assets/08-fiddler.html-DzV-yVRI.js" as="script"><link rel="prefetch" href="/book/assets/09-Scrapy.html-DHTzNp4Q.js" as="script"><link rel="prefetch" href="/book/assets/10-scrapy分布式.html-fr3UzX9_.js" as="script"><link rel="prefetch" href="/book/assets/11-Elasticsearch.html-DNJT7Eg6.js" as="script"><link rel="prefetch" href="/book/assets/11-Elasticsearch和Django.html-Dhb8orxW.js" as="script"><link rel="prefetch" href="/book/assets/12-js逆向-01.html-HFjBcJOT.js" as="script"><link rel="prefetch" href="/book/assets/12-js逆向-02.html-Cjh-USeQ.js" as="script"><link rel="prefetch" href="/book/assets/12-js逆向-03.html-Mt2aUmMz.js" as="script"><link rel="prefetch" href="/book/assets/13-逆向案例.html-ChCc05Cf.js" as="script"><link rel="prefetch" href="/book/assets/index.html-DUmgF7kj.js" as="script"><link rel="prefetch" href="/book/assets/补充.html-B333nMIa.js" as="script"><link rel="prefetch" href="/book/assets/h501-全屏与上传.html-hIqRw-e0.js" as="script"><link rel="prefetch" href="/book/assets/h502-拖拽.html-gul8L_o1.js" as="script"><link rel="prefetch" href="/book/assets/h503-视频-音频.html-DH_k6okQ.js" as="script"><link rel="prefetch" href="/book/assets/h504-原生移动端.html-BTQ_CE48.js" as="script"><link rel="prefetch" href="/book/assets/h505-canvas.html-CnjncuFa.js" as="script"><link rel="prefetch" href="/book/assets/h506-worker.html-oyCUmb_h.js" as="script"><link rel="prefetch" href="/book/assets/h507-map.html-DoXBMCmk.js" as="script"><link rel="prefetch" href="/book/assets/h508-WebSocket.html-0C44qP-f.js" as="script"><link rel="prefetch" href="/book/assets/index.html-CtOEEddY.js" as="script"><link rel="prefetch" href="/book/assets/ts01-TypeScript.html-BiJFxot0.js" as="script"><link rel="prefetch" href="/book/assets/ts02-类型.html-CaNN13nj.js" as="script"><link rel="prefetch" href="/book/assets/ts03-类型进级.html-B6AGK8Mr.js" as="script"><link rel="prefetch" href="/book/assets/ts04-补充.html-Bb3jPQVr.js" as="script"><link rel="prefetch" href="/book/assets/index.html-C82hFf51.js" as="script"><link rel="prefetch" href="/book/assets/vite-vueCli.html-guCd-tZ4.js" as="script"><link rel="prefetch" href="/book/assets/vue3-01开始.html-CPR4G8BS.js" as="script"><link rel="prefetch" href="/book/assets/vue3-02指令.html-BZxQX3h6.js" as="script"><link rel="prefetch" href="/book/assets/vue3-03响应式数据.html-a_UXVyMO.js" as="script"><link rel="prefetch" href="/book/assets/vue3-04选项式API.html-CCU-K64z.js" as="script"><link rel="prefetch" href="/book/assets/vue3-05组件-脚手架-生命周期.html-BF6rpJse.js" as="script"><link rel="prefetch" href="/book/assets/vue3-06组件与传值.html-CV3iyKYd.js" as="script"><link rel="prefetch" href="/book/assets/vue3-07内置内容.html-CkyRwTVz.js" as="script"><link rel="prefetch" href="/book/assets/vue3-08vuex.html-CGpc2Vwt.js" as="script"><link rel="prefetch" href="/book/assets/vue3-09Router.html-Sr9RBt-i.js" as="script"><link rel="prefetch" href="/book/assets/vue3-10组合式基础.html-BtCS25xx.js" as="script"><link rel="prefetch" href="/book/assets/vue3-11组合式内置.html-CDPfoUUe.js" as="script"><link rel="prefetch" href="/book/assets/vue3-12组合式API.html-B8AiCHgl.js" as="script"><link rel="prefetch" href="/book/assets/vue3-13pinia.html-OnzuYeZu.js" as="script"><link rel="prefetch" href="/book/assets/vue推荐风格.html-DGj0pclP.js" as="script"><link rel="prefetch" href="/book/assets/vue补充内容.html-Bv2JWrGh.js" as="script"><link rel="prefetch" href="/book/assets/配置文件.html-D3kQpfHK.js" as="script"><link rel="prefetch" href="/book/assets/404.html-ePYPX82r.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/book/"><!----><span class="vp-site-name" aria-hidden="true">笔记分析</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/htmlcss/" aria-label="HTML/CSS"><!--[--><!--[--><!--]--><!--]-->HTML/CSS<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/javaScript/" aria-label="JavaScript"><!--[--><!--[--><!--]--><!--]-->JavaScript<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/node/" aria-label="Node"><!--[--><!--[--><!--]--><!--]-->Node<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/vue/" aria-label="Vue"><!--[--><!--[--><!--]--><!--]-->Vue<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/react/" aria-label="React"><!--[--><!--[--><!--]--><!--]-->React<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/python/" aria-label="Python"><!--[--><!--[--><!--]--><!--]-->Python<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/django/" aria-label="Django"><!--[--><!--[--><!--]--><!--]-->Django<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/book/spider/" aria-label="Spider"><!--[--><!--[--><!--]--><!--]-->Spider<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/supplementary/" aria-label="补充知识"><!--[--><!--[--><!--]--><!--]-->补充知识<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/htmlcss/" aria-label="HTML/CSS"><!--[--><!--[--><!--]--><!--]-->HTML/CSS<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/javaScript/" aria-label="JavaScript"><!--[--><!--[--><!--]--><!--]-->JavaScript<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/node/" aria-label="Node"><!--[--><!--[--><!--]--><!--]-->Node<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/vue/" aria-label="Vue"><!--[--><!--[--><!--]--><!--]-->Vue<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/react/" aria-label="React"><!--[--><!--[--><!--]--><!--]-->React<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/python/" aria-label="Python"><!--[--><!--[--><!--]--><!--]-->Python<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/django/" aria-label="Django"><!--[--><!--[--><!--]--><!--]-->Django<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/book/spider/" aria-label="Spider"><!--[--><!--[--><!--]--><!--]-->Spider<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/book/supplementary/" aria-label="补充知识"><!--[--><!--[--><!--]--><!--]-->补充知识<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/01-%E7%88%AC%E8%99%AB%E7%AE%80%E4%BB%8B.html" aria-label="01-爬虫简介"><!--[--><!--[--><!--]--><!--]-->01-爬虫简介<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/02-requests%E8%AF%B7%E6%B1%82.html" aria-label="02-requests请求"><!--[--><!--[--><!--]--><!--]-->02-requests请求<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/03-%E6%AD%A3%E5%88%99.html" aria-label="03-正则"><!--[--><!--[--><!--]--><!--]-->03-正则<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/04-%E8%A7%A3%E6%9E%90%E6%95%B0%E6%8D%AE.html" aria-label="04-解析数据"><!--[--><!--[--><!--]--><!--]-->04-解析数据<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/05-selenium.html" aria-label="05-selenium"><!--[--><!--[--><!--]--><!--]-->05-selenium<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/06-DrissionPage.html" aria-label="06-DrissionPage"><!--[--><!--[--><!--]--><!--]-->06-DrissionPage<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/book/spider/07-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8D%8F%E7%A8%8B.html" aria-label="07-进程和线程与协程"><!--[--><!--[--><!--]--><!--]-->07-进程和线程与协程<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/07-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8D%8F%E7%A8%8B2.html" aria-label="07-进程和线程与协程2"><!--[--><!--[--><!--]--><!--]-->07-进程和线程与协程2<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/08-fiddler.html" aria-label="08-fiddler"><!--[--><!--[--><!--]--><!--]-->08-fiddler<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/09-Scrapy.html" aria-label="09-Scrapy"><!--[--><!--[--><!--]--><!--]-->09-Scrapy<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/10-scrapy%E5%88%86%E5%B8%83%E5%BC%8F.html" aria-label="10-scrapy分布式"><!--[--><!--[--><!--]--><!--]-->10-scrapy分布式<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/11-Elasticsearch.html" aria-label="11-Elasticsearch"><!--[--><!--[--><!--]--><!--]-->11-Elasticsearch<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/11-Elasticsearch%E5%92%8CDjango.html" aria-label="11-Elasticsearch和Django"><!--[--><!--[--><!--]--><!--]-->11-Elasticsearch和Django<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/12-js%E9%80%86%E5%90%91-01.html" aria-label="12-js逆向-01"><!--[--><!--[--><!--]--><!--]-->12-js逆向-01<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/12-js%E9%80%86%E5%90%91-02.html" aria-label="12-js逆向-02"><!--[--><!--[--><!--]--><!--]-->12-js逆向-02<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/12-js%E9%80%86%E5%90%91-03.html" aria-label="12-js逆向-03"><!--[--><!--[--><!--]--><!--]-->12-js逆向-03<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/13-%E9%80%86%E5%90%91%E6%A1%88%E4%BE%8B.html" aria-label="13-逆向案例"><!--[--><!--[--><!--]--><!--]-->13-逆向案例<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/book/spider/%E8%A1%A5%E5%85%85.html" aria-label="补充"><!--[--><!--[--><!--]--><!--]-->补充<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h2 id="多任务概述" tabindex="-1"><a class="header-anchor" href="#多任务概述"><span>多任务概述</span></a></h2><blockquote><p>爬虫多任务是指在数据采集过程中，同时执行<strong>多个爬虫任务</strong></p></blockquote><p>假如你需要获取一万条数据, 如何提高效率<img src="https://api2.mubu.com/v3/document_image/7637318_0d4588d0-2a60-415a-d3b0-1da08559848a.png" referrerpolicy="no-referrer"></p><ul><li>爬虫程序中同时执行多个任务，以提高数据采集的效率和性能。减少等待时间，加快数据采集速度</li><li>多任务爬虫常见的实现方式包括多线程、多进程, 协程等</li></ul><h2 id="进程与线程概述" tabindex="-1"><a class="header-anchor" href="#进程与线程概述"><span>进程与线程概述</span></a></h2><h3 id="进程概述" tabindex="-1"><a class="header-anchor" href="#进程概述"><span>进程概述</span></a></h3><p>进程是操作系统中最核心的概念之一，可以理解为 <strong>“正在运行的程序”</strong>。但它不仅仅是静态的代码，而是程序在运行时的动态实体，包含了程序执行所需的所有资源和状态 (程序的整体,程序的一次执行)</p><img src="https://api2.mubu.com/v3/document_image/7637318_7beddbce-cda2-4b6f-d950-a33dbdddbb62.png" referrerpolicy="no-referrer"><blockquote><p>对于操作系统来说，一个任务就是一个进程</p></blockquote><ul><li>打开一个记事本就启动了一个记事本进程</li><li>打开两个记事本就启动了两个记事本进程</li><li>一个Word就启动了一个Word进程</li></ul><blockquote><p>你同时打开两个软件：<strong>浏览器</strong> 和 <strong>音乐播放器</strong></p></blockquote><ul><li>浏览器是一个<strong>进程</strong>，它有自己的内存、代码、数据、打开的文件（如网页缓存）。</li><li>音乐播放器是另一个<strong>进程</strong>，它也有独立的内存、音频解码器、播放列表等。</li></ul><p>这两个进程互不干扰，即使浏览器崩溃了，音乐播放器仍然能正常运行。这就是进程的 <strong>独立性</strong></p><h4 id="进程总结" tabindex="-1"><a class="header-anchor" href="#进程总结"><span>进程总结</span></a></h4><ol><li>每个进程都拥有独立的地址空间和系统资源（如内存、文件等） <ul><li>不同进程之间相互隔离，一个进程崩溃通常不会影响其他进程。</li></ul></li><li>所有进程由操作系统进行统一管理</li><li>进程之间不通过直接共享信息, 需要通过IPC(<strong>进程间通信</strong>)<strong>机制</strong></li></ol><p>例子:</p><ul><li>一个老板: 有三家公司 <ul><li>三家公司是不同的进程 <ul><li>每家公司都有自己的业务（程序代码），并且独立运行。但是它们都受老板（操作系统）的统一管理</li><li>一家公司倒闭,不影响另外两家公司的运行</li></ul></li><li>老板就是操作系统进行统一管理</li></ul></li></ul><p>操作系统就是个超级老板，把电脑资源（CPU、内存、硬盘、网络）合理分给各个进程（程序），让它们既能各自干活，又不打架，还防止谁干坏事影响别人</p><p>其实你每开一个程序，就是请这位“<strong>老板</strong>”又成立了一家新公司</p><h3 id="线程概述" tabindex="-1"><a class="header-anchor" href="#线程概述"><span>线程概述</span></a></h3><ol><li>线程是进程中的一个子任务,是进程中的实际执行单位,每个进程最少有一个线程 <ul><li>假如开的是一个奶茶店(进程): 是不是最少要一个人去干活 <ul><li>听顾客点单（收钱）,转身去做奶茶（煮茶、加料、摇匀）,把奶茶递给顾客</li><li>一个线程一次只能专心做一件事。效率很低，顾客排队很长，怨声载道</li></ul></li></ul></li><li>所有线程运行在同一个进程中,共享进程的全部资源（内存、数据） <ul><li>比如: 音乐播放器进程, 我可以一边听歌一边下载歌曲, 如果只有一个线程那你就不能同时操作,必须等待另一个完成才能执行</li><li>比如: 浏览器可以打开多个页面, 每一个页面就是一个子线程</li></ul></li><li>线程的执行可以概括为：开始、顺序执行和结束。线程的运行通过指令指针（Instruction Pointer，IP）来记录当前执行到哪一条指令。线程在执行过程中可能会被抢占（中断）或被挂起（睡眠），从而让其他线程运行，这种行为称为线程的让步</li></ol><ul><li><strong>线程</strong>：员工</li><li><strong>开始</strong>：员工开始上班</li><li><strong>顺序执行</strong>：按照固定步骤做奶茶</li><li><strong>结束</strong>：完成一杯奶茶</li><li><strong>指令指针</strong>：员工记住自己做到哪一步了</li><li><strong>抢占</strong>：店长强制让员工离开操作台，换另一个员工上</li><li><strong>挂起</strong>：员工主动等待某个事件（如等水烧开）而让出操作台</li><li><strong>让步</strong>：员工主动让出操作台给其他员工</li></ul><ol start="4"><li>在单CPU中，每个线程只运行一小会儿(各个任务交替执行，CPU执行速度太快，感觉像所有任务都在同时执行)，就是让步</li></ol><ul><li>单核CPU就像 <strong>&quot;1个厨师快速在3个锅之间切换&quot;</strong><ul><li>虽然每次只能炒1个菜，但切换太快了</li><li>看起来就像3个菜同时在炒</li></ul></li><li>通过极速的时间，让单个CPU核心&quot;看起来&quot;能同时处理多个任务！</li></ul><h2 id="多线程和多进程" tabindex="-1"><a class="header-anchor" href="#多线程和多进程"><span><strong>多线程和多进程</strong></span></a></h2><ul><li>多进程: 在操作系统中，一个任务就是一个进程, 开启多个任务即多进程</li><li>多线程: 在一个进程内部，同时做多件事，就需要运行多个线程</li></ul><blockquote><p>多任务</p></blockquote><p>同时运行多个任务--比如一边用浏览器上网，一边听歌，一边用Word赶作业。还有很多任务悄悄地在后台同时运行，只是桌面没显示</p><ul><li>一个任务就是一个进程，开启多个任务就是多进程</li></ul><h3 id="多线程优点" tabindex="-1"><a class="header-anchor" href="#多线程优点"><span>多线程优点</span></a></h3><ul><li>把耗时任务放到后台处理，保持用户界面流畅 <ul><li>顾客点完单后，前台线程（员工A）继续接待下一个顾客，后台线程（员工B）开始制作奶茶。这样，顾客点单不用等待制作奶茶的时间，用户界面（点单交互）保持流畅</li></ul></li><li>用户界面更吸引人，可以显示进度 <ul><li>顾客点了一杯复杂的奶茶，他想要知道制作进度。如果只有一个员工，他忙得不可开交，无法及时告诉顾客进度</li></ul></li><li>程序的运行速度可能加快 <ul><li>有3个顾客，每个顾客都点了一杯奶茶，每杯奶茶制作需要3分钟。如果只有一个员工，总耗时9分钟</li></ul></li></ul><h3 id="线程和进程执行的区别" tabindex="-1"><a class="header-anchor" href="#线程和进程执行的区别"><span>线程和进程执行的区别</span></a></h3><ol><li>每个独立线程有一个程序运行的入口（即线程开始执行的地方）</li><li>线程有顺序执行序列和程序的出口（即线程按顺序执行任务，然后结束）</li><li>线程不能独立执行，必须依存在进程中，由进程提供多个线程执行控制</li></ol><h2 id="并发和并行" tabindex="-1"><a class="header-anchor" href="#并发和并行"><span>并发和并行</span></a></h2><p>核心就是cpu, 一个核心就是单核cpu, cpu是操作线程的</p><p>几核就是有几个工人</p><h3 id="并发" tabindex="-1"><a class="header-anchor" href="#并发"><span>并发</span></a></h3><p>并发( 任务数大于核心数)：</p><p>在同一时刻只能有一条指令执行，但通过快速轮换执行多个任务，使得宏观上看起来是同时执行的 。 但在微观上并不是同时执行的，只是把时间分成若干段，使多个进程快速交替的执行 (ABC三个任务,进行快速轮换)</p><img src="https://api2.mubu.com/v3/document_image/7637318_d80e3634-7fb4-47f9-9263-1ef961daa774.png" referrerpolicy="no-referrer"><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">0ms<span class="token operator">-</span>10ms：执行任务A的指令</span>
<span class="line">10ms<span class="token operator">-</span>20ms：执行任务B的指令  </span>
<span class="line">20ms<span class="token operator">-</span>30ms：执行任务C的指令</span>
<span class="line">30ms<span class="token operator">-</span>40ms：又执行任务A的指令</span>
<span class="line">40ms<span class="token operator">-</span>50ms：又执行任务B的指令</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>比喻：一个厨师（单核CPU）同时照看多个锅（多个任务）。他快速地在各个锅之间切换，每个锅煮一会儿，然后换下一个锅。从顾客的角度看，多个锅都在煮，但实际上厨师每次只在一个锅前操作</p><h3 id="并行" tabindex="-1"><a class="header-anchor" href="#并行"><span>并行</span></a></h3><p>并行(任务数小于或等于核心数), 指在同一时刻，有多条指令在多个处理器上同时执行。所以无论从微观还是从宏观来看，二者都是一起执行的</p><img src="https://api2.mubu.com/v3/document_image/7637318_157a06fc-c09b-4418-fd21-c022f896d1c9.png" referrerpolicy="no-referrer"><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">核心<span class="token number">1</span>：0ms<span class="token operator">-</span>10ms 执行任务A的指令</span>
<span class="line">核心<span class="token number">2</span>：0ms<span class="token operator">-</span>10ms 同时执行任务B的指令  </span>
<span class="line">核心<span class="token number">3</span>：0ms<span class="token operator">-</span>10ms 同时执行任务C的指令</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>并行就像：多个厨师（多核CPU）同时做多道菜（多个任务）</p><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><table><thead><tr><th style="text-align:left;">方面</th><th style="text-align:left;"><strong>并发（Concurrency）</strong></th><th style="text-align:left;"><strong>并行（Parallelism）</strong></th></tr></thead><tbody><tr><td style="text-align:left;"><strong>定义</strong></td><td style="text-align:left;">多个任务交替执行，看起来同时</td><td style="text-align:left;">多个任务真正同时执行</td></tr><tr><td style="text-align:left;"><strong>核心要求</strong></td><td style="text-align:left;">任务数 &gt; 核心数</td><td style="text-align:left;">任务数 ≤ 核心数（理想）</td></tr><tr><td style="text-align:left;"><strong>同时性</strong></td><td style="text-align:left;">宏观同时，微观交替</td><td style="text-align:left;">宏观微观都同时</td></tr><tr><td style="text-align:left;"><strong>硬件基础</strong></td><td style="text-align:left;">单核即可，多核也可并发</td><td style="text-align:left;">必须多核/多CPU</td></tr><tr><td style="text-align:left;"><strong>目标</strong></td><td style="text-align:left;">提高吞吐量，改善响应性</td><td style="text-align:left;">缩短任务执行时间</td></tr></tbody></table><p>无论是并发还是并行，多任务都可以在进程级别或线程级别实现</p><h2 id="多线程" tabindex="-1"><a class="header-anchor" href="#多线程"><span>多线程</span></a></h2><h3 id="全局解释器锁" tabindex="-1"><a class="header-anchor" href="#全局解释器锁"><span>全局解释器锁</span></a></h3><blockquote><p>全局解释器锁(英语:Global Interpreter Lock，缩写 GIL)</p></blockquote><p>全局解释器锁是计算机程序设计语言解释器用于同步线程的一种机制，它使得任何时刻仅有一个线程在执行，即便在多核心处理器 上，使用GIL 的解释器也只允许同一时间执行一个线程。常见的使用GIL的解释器有 CPython与Ruby MRI。</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">GIL比喻 <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;Python解释器&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;一个工厂&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;GIL&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;只有1把大门钥匙&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;多个线程&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;多个工人&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;规则&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;只有拿到钥匙的工人才能进厂工作&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&quot;结果&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;即使工厂有多个车间（CPU核心），但一次只能进1个工人&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="执行过程" tabindex="-1"><a class="header-anchor" href="#执行过程"><span>执行过程</span></a></h4><p>每个线程在执行Python 之前必须先获取GIL, 执行一段时间后释放GIL，这样其他线程才有机会获取GIL并执行</p><ul><li>其他线程没有拿到GIL锁才能进行执行</li></ul><p>强制性让线程排队等待</p><h4 id="gil解决的问题" tabindex="-1"><a class="header-anchor" href="#gil解决的问题"><span>GIL解决的问题</span></a></h4><ul><li>多个线程同时修改某个的数据可能导致会出错</li></ul><h3 id="多线程执行机制过程" tabindex="-1"><a class="header-anchor" href="#多线程执行机制过程"><span>多线程执行机制过程</span></a></h3><ol><li>设置/获取GIL锁 <ul><li>在Python解释器启动时，GIL会被创建。</li><li>当线程想要执行Python时，必须先获取GIL</li></ul></li><li>运行有锁的线程（即当前持有GIL的线程） <ul><li>线程获取GIL后，就可以执行Python代码</li></ul></li><li>运行指定数量的字节码指令或线程主动让出控制</li></ol><ul><li>CPython会记录线程执行的字节码指令数量，当达到一定阈值（例如100条指令）时，当前线程会主动释放GIL。</li><li>或者，当线程遇到I/O操作等阻塞操作时，也会主动释放GIL</li></ul><ol start="4"><li>解锁GIL <ul><li>线程释放GIL，让其他线程有机会获取GIL并执行。</li></ul></li></ol><p>示例:</p><ol><li>创建两个线程(Py thread1、Pythread2) <ul><li>当线程一(pythread1)开始执行时，线程1会去解释器中申请到一个锁，也就是GIL 锁</li></ul></li><li>解释器接收执行请求，申请系统线程</li><li>系统统一执行所有线程; (线程二(pythread2)也会同步运行)</li><li>线程二(py thread2)要执行就需要 GIL锁 <ul><li>没有GIL锁就不能执行(等待状态|卡死)，而此时GIL锁已经被线程一(Pythread1)给拿走了</li><li>线程二(py thread2)要运行，必须等线程一(Pythread1)运行完成之后，释放了GIL锁，才能运行</li></ul></li><li>当线程二(py thread2)拿到这把锁之后就和线程一(Pythread1)的运行过程一样</li></ol><h2 id="多线程使用" tabindex="-1"><a class="header-anchor" href="#多线程使用"><span>多线程使用</span></a></h2><blockquote><p><code>threading</code> 是 Python 标准库中用于创建和管理线程的核心模块</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建线程对象   使用元组进行传递参数</span></span>
<span class="line">t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span> 执行函数 <span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;元组数据类型&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 启动子线程</span></span>
<span class="line">t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>threading.enumerate()</code> 获取当前所有线程对象</li><li><code>threading.current_thread()</code> 获取当前线程对象</li></ul><h3 id="主线程" tabindex="-1"><a class="header-anchor" href="#主线程"><span>主线程</span></a></h3><p>一个进程默认有 <strong>1个主线程</strong>（如 <code>main()</code>函数）</p><p>可以创建 <strong>多个线程</strong>，每个线程执行不同的函数（如一个线程处理网络请求，另一个线程更新数据）</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line"><span class="token comment"># 启动每个一个程序都默认会有一个主线程</span></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span></span>
<span class="line">    start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment"># 主线程就是以前的单线程,从上往下执行</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="多线程-1" tabindex="-1"><a class="header-anchor" href="#多线程-1"><span>多线程</span></a></h3><blockquote><p>单线程 可以设置time停止会更加有效果</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 单线程: 先执行start1函数中的内容,在执行start2循环</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">start1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;nihao&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">start2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;haha&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    start1<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    start2<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">   <span class="token comment"># 必须等待上一个程序执行完成之后 才能执行下一个</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>通过 <code>threading</code> 模块实现多线程编程</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 设置多线程</span></span>
<span class="line"><span class="token keyword">from</span> threading <span class="token keyword">import</span> Thread</span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置多线程执行</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">start1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;nihao&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">start2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;haha&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span> <span class="token comment">#主线程</span></span>
<span class="line">    <span class="token comment"># 创建线程并给线程安排执行函数</span></span>
<span class="line">    t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>start1<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 多线程状态为开始工作状态,具体执行时间由CPU决定</span></span>
<span class="line">    t2 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>start2<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;不会&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line"><span class="token comment"># Thread(target= 执行函数 ,args=(&quot;元组数据类型&quot;,))  传递数据到函数中</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>可以通过交替执行+重叠等待机制让两个任务的总耗时减少</li><li>等待的核心作用就是:让线程释放GIL锁 给其他线程机会</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 也可以对同一个函数进行多线程执行</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">start1</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1115</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> val<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span> <span class="token comment">#主线程</span></span>
<span class="line">    <span class="token comment"># 创建线程并给线程安排执行函数</span></span>
<span class="line">    t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>start1<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;你好&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 多线程状态为开始工作状态,具体执行时间由CPU决定</span></span>
<span class="line">    t2 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>start1<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;不会&quot;</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="多进程使用" tabindex="-1"><a class="header-anchor" href="#多进程使用"><span>多进程使用</span></a></h2><blockquote><p>通过 <code>multiprocessing</code> 模块实现多进程编程</p></blockquote><ul><li>导入Pool类，定义进程池，声明进程数量</li><li>进程池对象调用<code>apply()/apply_async()</code>启动多进程 <ul><li><code>同步进程和异步进程 apply/apply_async</code></li></ul></li><li>进程池对象调用close()方法，关闭进程池，关闭后就不再接受新的请求，</li></ul><img src="https://api2.mubu.com/v3/document_image/7637318_a27e7ebe-e081-4571-cc3f-2d2bb1efecd9.png" referrerpolicy="no-referrer"><p>这样很难直接的看出来, 最好是进行请求网页内容,进行处理, 以下内容会同时请求4个页面的数据</p><ul><li><code>同步和异步 apply/apply_async</code><ul><li>每次循环会将空闲的子进程去池子外获取新的任务执行</li><li>所以异步体现了并发：4个进程都在执行任务，其中一个执行完毕后，下一个会继续补上</li></ul></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">from</span> multiprocessing <span class="token keyword">import</span> Pool  <span class="token comment"># 导入进程池模块</span></span>
<span class="line"><span class="token keyword">import</span> time</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">dwon</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;开始执行</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;结束</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f&quot;返回值</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token comment">#使用apply同步是会阻塞,需要先执行上一个才会执行下一个,一个一个的执行</span></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 创建包含4个工作进程的进程池,由四个进程来处理对应的任务, 每个进程处理完成之后才会处理下一个</span></span>
<span class="line">    po <span class="token operator">=</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 向进程池提交4个任务</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        po<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>dwon<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 异步提交任务</span></span>
<span class="line">    po<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 关闭进程池（禁止继续提交新任务）</span></span>
<span class="line">    po<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 等待所有子进程执行完毕</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="线程与进程补充" tabindex="-1"><a class="header-anchor" href="#线程与进程补充"><span>线程与进程补充:</span></a></h3><p>在任务管理器性能中进行查看</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 进程最好不要大于物理核心数</span></span>
<span class="line">Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>  </span>
<span class="line"></span>
<span class="line"><span class="token comment"># 线程不要大于 逻辑处理数 * 2  </span></span>
<span class="line"><span class="token comment">#  线程在等待的时候,可以交给其他线程处理</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://api2.mubu.com/v3/document_image/7637318_a8411a02-4053-4db0-83e0-fd06a3ef5bd6.png" referrerpolicy="no-referrer"><h2 id="进程与线程使用场景" tabindex="-1"><a class="header-anchor" href="#进程与线程使用场景"><span>进程与线程使用场景</span></a></h2><img src="https://api2.mubu.com/v3/document_image/7637318_89284c21-a34c-414a-bb32-2539ce52de5a.png" referrerpolicy="no-referrer"><table><thead><tr><th style="text-align:center;">特性</th><th style="text-align:left;">线程（Thread）</th><th style="text-align:left;">进程（Process）</th></tr></thead><tbody><tr><td style="text-align:center;"><strong>资源占用</strong></td><td style="text-align:left;">共享进程内存，创建/切换开销小</td><td style="text-align:left;">独立内存空间，创建/切换开销大</td></tr><tr><td style="text-align:center;"><strong>并行能力</strong></td><td style="text-align:left;">受 GIL 限制（Python 中无法真正并行）</td><td style="text-align:left;">可跨 CPU 核心并行</td></tr><tr><td style="text-align:center;"><strong>适用场景</strong></td><td style="text-align:left;">I/O 密集型（网络请求、文件读写,数据库）</td><td style="text-align:left;">CPU 密集型（计算、数据处理）</td></tr><tr><td style="text-align:center;"><strong>通信方式</strong></td><td style="text-align:left;">共享内存（需同步机制）</td><td style="text-align:left;">IPC（队列、管道、共享内存）</td></tr><tr><td style="text-align:center;"><strong>崩溃影响</strong></td><td style="text-align:left;">线程崩溃可能导致整个进程崩溃</td><td style="text-align:left;">进程崩溃不影响其他进程</td></tr></tbody></table><ul><li><strong>threading</strong>：适合&quot;等待型&quot;任务（网络、文件、数据库）</li><li><strong>multiprocessing</strong>：适合&quot;计算型&quot;任务（数学、加密、图像处理）</li></ul><h2 id="练习" tabindex="-1"><a class="header-anchor" href="#练习"><span>练习</span></a></h2><h3 id="线程练习" tabindex="-1"><a class="header-anchor" href="#线程练习"><span>线程练习</span></a></h3><blockquote><p>案例地址: 爬取猪八戒官网信息</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 可以在对应的数据后面进行切片, 让每一个数据少加载一下,从而进行下一页,更好的演示</span></span>
<span class="line"><span class="token comment"># hrefs = xp_dom.xpath(&#39;&#39;)[:6]</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">handler_thread</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>f&quot;第<span class="token punctuation">{</span>i<span class="token punctuation">}</span>页数据</span>
<span class="line">        data <span class="token operator">=</span> spider<span class="token punctuation">(</span></span>
<span class="line">            <span class="token string-interpolation"><span class="token string">f&quot;https://www.zbj.com/fw/?k=%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1&amp;p=</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&amp;osStr=ad-35,np-0,rf-1,sr-59,mb-0,cr-0,ocpc-0,cpc-0,cro-0,lk-0&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        handler_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line">        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 创建线程</span></span>
<span class="line">    t1 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>handler_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    t2 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>handler_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    t3 <span class="token operator">=</span> Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>handler_thread<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 启动线程</span></span>
<span class="line">    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    t3<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意: 使用线程,不要使用递归翻页( 以便于使用线程池处理每一页 )</p><ul><li>使用<code>openpyxl</code>能进行存储 或 mysql存储会完全没有问题</li></ul><h3 id="进程练习" tabindex="-1"><a class="header-anchor" href="#进程练习"><span>进程练习</span></a></h3><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">handler_thread</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;第</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">页数据&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    data <span class="token operator">=</span> spider<span class="token punctuation">(</span></span>
<span class="line">        <span class="token string-interpolation"><span class="token string">f&quot;https://www.zbj.com/fw/?k=%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1&amp;p=</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">&amp;osStr=ad-35,np-0,rf-1,sr-59,mb-0,cr-0,ocpc-0,cpc-0,cro-0,lk-0&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    handler_data<span class="token punctuation">(</span>data<span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    po <span class="token operator">=</span> Pool<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        po<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>handler_thread<span class="token punctuation">,</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 关闭进程 停止继续网进程中添加新任务</span></span>
<span class="line">    po<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    po<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 等待进程执行完成</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意: 使用进程,不要内部使用递归翻页, 一个进程就是一个人,进行翻页就是重复行操作</p><h4 id="注意" tabindex="-1"><a class="header-anchor" href="#注意"><span>注意</span></a></h4><blockquote><p>使用<code>openpyxl</code>能进行存储时会出现问题 (总之有问题)</p></blockquote><ol><li>每个进程之间的数据是不共享的 <ul><li>每个进程都会创建自己的excel对象, 且所有任务结束之后子进程之间不会自己合并数据</li></ul></li><li>openpyxl 是不能处理多进程数据处理</li></ol><h4 id="manager存储" tabindex="-1"><a class="header-anchor" href="#manager存储"><span>Manager存储</span></a></h4><blockquote><p>Pool 中的进程是独立的内存空间，因此不能直接通过全局变量共享数据</p></blockquote><ul><li>需要使用 multiprocessing 提供的共享内存机制或使用管理器（Manager）</li></ul><p>通过 <code>multiprocessing.Manager()</code> 可以创建一个管理器，它支持列表、字典等数据结构，并且可以在多个进程间共享</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">manager <span class="token operator">=</span> Manager<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 创建 Manager</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建共享数据结构</span></span>
<span class="line">shared_dict <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 创建对象</span></span>
<span class="line">shared_list <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 创建列表</span></span>
<span class="line">shared_list <span class="token operator">=</span> manager<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 创建队列 先进先出</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 添加元素</span></span>
<span class="line">q<span class="token punctuation">.</span>put<span class="token punctuation">(</span>item<span class="token punctuation">)</span>          <span class="token comment"># 放入元素，如果队列满则阻塞</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 获取元素</span></span>
<span class="line">item <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>       <span class="token comment"># 取出元素，如果队列空则阻塞</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 其他方法</span></span>
<span class="line">q<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment"># 判断队列是否为空, false为有值 true不存在</span></span>
<span class="line">q<span class="token punctuation">.</span>full<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token comment"># 判断队列是否已满（不一定准确）</span></span>
<span class="line">q<span class="token punctuation">.</span>qsize<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment"># 返回队列大致长度（多进程环境下可能不准确）</span></span>
<span class="line">q<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment"># 关闭队列</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 进行队列存储</span></span>
<span class="line">man_queue<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token punctuation">(</span>title1<span class="token punctuation">,</span> publish_time1<span class="token punctuation">,</span> pic_info1<span class="token punctuation">,</span> id1<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 存储函数</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">save_data</span><span class="token punctuation">(</span>man_queue<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    wb <span class="token operator">=</span> Workbook<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    ws <span class="token operator">=</span> wb<span class="token punctuation">.</span>active</span>
<span class="line">    ws<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">&quot;bukaixin&quot;</span></span>
<span class="line">    ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;序号&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;标题&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;地址&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;图片&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>shared_list<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> false为有值 true不存在<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 判断队列是否为空  </span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token keyword">not</span> shared_list<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            title1<span class="token punctuation">,</span> publish_time1<span class="token punctuation">,</span> pic_info1<span class="token punctuation">,</span> id1 <span class="token operator">=</span> shared_list<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            ws<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>id1<span class="token punctuation">,</span> publish_time1<span class="token punctuation">,</span> title1<span class="token punctuation">,</span> pic_info1<span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">finally</span><span class="token punctuation">:</span></span>
<span class="line">        wb<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">&quot;./1234.xlsx&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;保存成功&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 创建 Manager</span></span>
<span class="line">    manager <span class="token operator">=</span> Manager<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 创建队列存储</span></span>
<span class="line">    man_queue <span class="token operator">=</span> manager<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    po <span class="token operator">=</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        po<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>get_url<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> man_queue<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    po<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    po<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 执行保存函数, 读取manager管理信息,进程存储操作</span></span>
<span class="line">    save_data<span class="token punctuation">(</span>man_queue<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mysql存储" tabindex="-1"><a class="header-anchor" href="#mysql存储"><span>mysql存储</span></a></h4><blockquote><p>不使用manage</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">get_url</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 创建数据库  每次都需要连接</span></span>
<span class="line">    mysql <span class="token operator">=</span> HanderlMysql<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    url <span class="token operator">=</span> <span class="token string">&quot;https://i.news.qq.com/web_feed/getHotModuleList&quot;</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;获取第</span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">页数据&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    payload <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;base_req&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token string">&quot;from&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;pc&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;forward&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;qimei36&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;0_ckHCyBia5mrws&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;device_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;0_ckHCyBia5mrws&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;flush_num&quot;</span><span class="token punctuation">:</span> i<span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;channel_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;news_news_top&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token string">&quot;item_count&quot;</span><span class="token punctuation">:</span> <span class="token number">20</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    result <span class="token operator">=</span> spider<span class="token punctuation">(</span>url<span class="token punctuation">,</span> payload<span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment"># 在handler_data中存储成功之后 需要进行关闭数据库连接</span></span>
<span class="line">    handler_data<span class="token punctuation">(</span>result<span class="token punctuation">,</span> mysql<span class="token punctuation">)</span></span>
<span class="line">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span></span>
<span class="line">    po <span class="token operator">=</span> Pool<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        po<span class="token punctuation">.</span>apply_async<span class="token punctuation">(</span>get_url<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    po<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    po<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>使用manage 会更加的简单</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">def</span> <span class="token function">save_data</span><span class="token punctuation">(</span>shared_list<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    mysql <span class="token operator">=</span> Pysql<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">while</span> <span class="token keyword">not</span> shared_list<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 判断队列是否为空  不</span></span>
<span class="line">            title1<span class="token punctuation">,</span> publish_time1<span class="token punctuation">,</span> pic_info1<span class="token punctuation">,</span> id1 <span class="token operator">=</span> shared_list<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">            mysql<span class="token punctuation">.</span>insert_data<span class="token punctuation">(</span><span class="token string">&quot;insert into zhubajie(name_msg,title_msg,href) values(%s,%s,%s)&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span>title1<span class="token punctuation">,</span> publish_time1<span class="token punctuation">,</span> pic_info1<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">finally</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;保存成功&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">pass</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>使用open进行文件存储</li></ul><h3 id="数据库连接池" tabindex="-1"><a class="header-anchor" href="#数据库连接池"><span>数据库连接池</span></a></h3><blockquote><p>书写在进程中,可以和之前的一样, 主要的区别是连接池在不存在结束后不会断开连接,使用与执行一次,会操作多次数据库</p></blockquote><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># 普通连接（错误方式）</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">save_data_normal</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 每次都要重新连接（开销大）</span></span>
<span class="line">    conn <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>  <span class="token comment"># 创建新连接</span></span>
<span class="line">    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></span>
<span class="line">    conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 完全关闭</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 连接池方式（正确方式）</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">save_data_pool</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token comment"># 从连接池获取（复用连接）</span></span>
<span class="line">    conn <span class="token operator">=</span> pool<span class="token punctuation">.</span>connection<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 从池中获取已有连接</span></span>
<span class="line">    cursor <span class="token operator">=</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></span>
<span class="line">    conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 归还到连接池，不是真正关闭</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>pip install DBUtils 第三方库来实现连接池</p></blockquote><ul><li>DBUtils从连接池中获取连接，使用完毕后归还</li><li>在多线程或多进程中不需要每次创建新连接 <ul><li>只需要调用一次</li></ul></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> pymysql</span>
<span class="line"><span class="token keyword">from</span> dbutils<span class="token punctuation">.</span>pooled_db <span class="token keyword">import</span> PooledDB</span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">SimpleMySQLPool</span><span class="token punctuation">:</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 初始化连接池</span></span>
<span class="line">        self<span class="token punctuation">.</span>pool <span class="token operator">=</span> PooledDB<span class="token punctuation">(</span></span>
<span class="line">            creator<span class="token operator">=</span>pymysql<span class="token punctuation">,</span> <span class="token comment"># 用于建立数据库连接的模块</span></span>
<span class="line">            maxconnections<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment"># 连接池允许的最大连接数</span></span>
<span class="line">            mincached<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># 连接池中空闲连接的最小数量</span></span>
<span class="line">            maxcached<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment"># 连接池中空闲连接的最大数量</span></span>
<span class="line">   <span class="token comment"># 当连接池中的连接已经达到最大连接数时，再次请求连接是否阻塞等待</span></span>
<span class="line">            blocking<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> </span>
<span class="line">            host<span class="token operator">=</span><span class="token string">&#39;localhost&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span></span>
<span class="line">            user<span class="token operator">=</span><span class="token string">&#39;root&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            password<span class="token operator">=</span><span class="token string">&#39;123123&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            db<span class="token operator">=</span><span class="token string">&#39;lol&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            charset<span class="token operator">=</span><span class="token string">&#39;utf8mb4&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            autocommit<span class="token operator">=</span><span class="token boolean">True</span></span>
<span class="line">        <span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 从连接池中获取一个连接。</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">get_conn</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>pool<span class="token punctuation">.</span>connection<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># bol布尔值,表示是否是查询操作</span></span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">execute_sql</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sql<span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> bol<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token comment"># 获取连接</span></span>
<span class="line">        conn <span class="token operator">=</span> self<span class="token punctuation">.</span>get_conn<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 创建游标  通过with自动关闭游标</span></span>
<span class="line">            <span class="token keyword">with</span> conn<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span></span>
<span class="line">                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> params <span class="token keyword">or</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">if</span> bol<span class="token punctuation">:</span></span>
<span class="line">                    <span class="token comment"># 返回查询到的所有数据</span></span>
<span class="line">                    <span class="token keyword">return</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">                     <span class="token comment"># 返回行数</span></span>
<span class="line">                    <span class="token keyword">return</span> cursor<span class="token punctuation">.</span>rowcount</span>
<span class="line">            <span class="token comment"># 检查是否报错</span></span>
<span class="line">        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;SQL执行失败: </span><span class="token interpolation"><span class="token punctuation">{</span>e<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token boolean">False</span></span>
<span class="line">        <span class="token keyword">finally</span><span class="token punctuation">:</span></span>
<span class="line">            <span class="token comment"># 归还连接</span></span>
<span class="line">            conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">create_table</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        self<span class="token punctuation">.</span>execute_sql<span class="token punctuation">(</span>sql<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;数据表已准备就绪&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">def</span> <span class="token function">insert_news</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> self<span class="token punctuation">.</span>execute_sql<span class="token punctuation">(</span>sql<span class="token punctuation">,</span>params<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/book/spider/06-DrissionPage.html" aria-label="06-DrissionPage"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">06-DrissionPage</span></div><!--]--></a><a class="route-link auto-link next" href="/book/spider/07-%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%8D%8F%E7%A8%8B2.html" aria-label="07-进程和线程与协程2"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">07-进程和线程与协程2</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/book/assets/app-hJI7UlmO.js" defer></script>
  </body>
</html>
